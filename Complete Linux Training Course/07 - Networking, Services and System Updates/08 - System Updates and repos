# Linux System Updates, Repos, and Package Management - Complete Guide

## Table of Contents
1. [Package Managers Overview](#package-managers-overview)
2. [System Update vs Upgrade](#system-update-vs-upgrade)
3. [Local Repository Creation](#local-repository-creation)
4. [Advanced Package Management](#advanced-package-management)
5. [Rollback Updates and Patches](#rollback-updates-and-patches)
6. [Daily Use Cases](#daily-use-cases)
7. [Real-Life Scenarios](#real-life-scenarios)

---

## 1. Package Managers Overview

### What are Package Managers?
Package managers are tools that automate the process of installing, upgrading, configuring, and removing software packages on Linux systems.

### Three Main Package Management Tools

#### 1. YUM (Yellowdog Updater Modified)
- Used on: CentOS, RHEL (Red Hat Enterprise Linux), Fedora (older versions)
- Works with: RPM packages
- Repository-based: Downloads from configured repositories
- Automatic dependency resolution

#### 2. APT-GET (Advanced Package Tool)
- Used on: Debian, Ubuntu, Linux Mint
- Works with: DEB packages
- Repository-based: Downloads from configured repositories
- Automatic dependency resolution

#### 3. RPM (Red Hat Package Manager)
- Used on: RHEL, CentOS, Fedora
- Low-level package manager
- Does NOT resolve dependencies automatically
- Direct package installation from .rpm files

### Comparison Table

| Feature | YUM | APT-GET | RPM |
|---------|-----|---------|-----|
| Distribution | RHEL/CentOS | Debian/Ubuntu | RHEL/CentOS |
| Dependency Resolution | Automatic | Automatic | Manual |
| Repository Support | Yes | Yes | No (local files) |
| Package Format | .rpm | .deb | .rpm |
| Internet Required | Yes (usually) | Yes (usually) | No |
| Configuration File | /etc/yum.repos.d/ | /etc/apt/sources.list | N/A |

### Basic Commands Comparison

Installing a Package:
yum install httpd              # RHEL/CentOS
apt-get install apache2        # Debian/Ubuntu
rpm -ivh httpd-2.4.rpm        # RPM (manual, no auto-dependency)

Removing a Package:
yum remove httpd
apt-get remove apache2
rpm -e httpd

Searching for a Package:
yum search keyword
apt-cache search keyword
rpm -qa | grep keyword        # Only searches installed packages

Updating Package List:
yum check-update
apt-get update
rpm -qa                       # List all installed packages

Upgrading All Packages:
yum update
apt-get upgrade
# RPM does not have direct upgrade command for all packages

---

## 2. System Update vs Upgrade

### Two Types of System Changes

#### Major Version Upgrade
- Example: CentOS 7 → CentOS 8, RHEL 5 → RHEL 6
- Significant changes to system architecture
- May require reinstallation
- NOT recommended using yum command alone

#### Minor Version Update (Patch/Security Update)
- Example: RHEL 7.3 → RHEL 7.4
- Security patches, bug fixes
- Safe to apply using yum update
- Recommended practice for system maintenance

### YUM: update vs upgrade

#### yum update
- Updates packages to latest version
- PRESERVES existing packages
- Keeps obsolete packages installed
- Safer option (default choice)
- Recommended for production systems

Command:
yum update

Example output:
Dependencies Resolved
Package                  Arch    Version         Repository    Size
Updating:
 kernel                  x86_64  3.10.0-1160     updates       50M
 openssl                 x86_64  1.0.2k-25       updates       494k
Installing for dependencies:
 kernel-tools            x86_64  3.10.0-1160     updates       8.2M

Transaction Summary
Upgrade  2 Packages (+1 Dependent package)

#### yum upgrade
- Updates packages to latest version
- DELETES obsolete packages
- Removes packages marked obsolete by maintainer
- More aggressive cleanup
- Use with caution

Command:
yum upgrade

Difference visualization:
System before: Package-A v1.0, Package-B v1.0 (obsolete), Package-C v1.0
After yum update: Package-A v2.0, Package-B v1.0 (kept), Package-C v2.0
After yum upgrade: Package-A v2.0, Package-B REMOVED, Package-C v2.0

### Best Practice: Use yum update -y

yum update -y

Flags explained:
-y           = Automatic "yes" to prompts (non-interactive)
--security   = Only install security updates
--bugfix     = Only install bug fixes
--skip-broken = Skip packages with dependency problems

Common update commands:
# Update all packages
yum update -y

# Update specific package
yum update httpd -y

# Update only security patches
yum update --security -y

# Check for available updates without installing
yum check-update

# Update and exclude certain packages
yum update --exclude=kernel* -y

Example output of yum update -y:
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.centos.org
 * extras: mirror.centos.org
 * updates: mirror.centos.org
Resolving Dependencies
--> Running transaction check
---> Package httpd.x86_64 0:2.4.6-97 will be updated
---> Package httpd.x86_64 0:2.4.6-98 will be an update
--> Finished Dependency Resolution

Dependencies Resolved
Package      Arch    Version           Repository    Size
Updating:
 httpd       x86_64  2.4.6-98.el7      updates       1.2M

Transaction Summary
Upgrade  1 Package

Total download size: 1.2 M
Downloading packages:
httpd-2.4.6-98.el7.x86_64.rpm                    | 1.2 MB  00:00:01
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Updating   : httpd-2.4.6-98.el7.x86_64                            1/2
  Cleanup    : httpd-2.4.6-97.el7.x86_64                            2/2
  Verifying  : httpd-2.4.6-98.el7.x86_64                            1/2
  Verifying  : httpd-2.4.6-97.el7.x86_64                            2/2

Updated:
  httpd.x86_64 0:2.4.6-98.el7

Complete!

---

## 3. Create Local Repository from DVD

### What is a Local Repository?

A local repository is a local copy of software packages stored on your system, allowing:
- Package installation without internet connection
- Faster installation (no download needed)
- Consistent package versions across systems
- Air-gapped environments (isolated from internet)

### Visual Understanding

Normal Installation Flow:
Linux Server → Internet → Remote Repository (mirror.centos.org) → Download → Install

Local Repository Flow:
Linux Server → Local Disk/DVD → Local Repository → Install (NO INTERNET NEEDED)

### Why Create Local Repository?

Use Cases:
1. No Internet Access: Servers in secure/isolated environments
2. Bandwidth Conservation: Multiple servers installing same packages
3. Version Control: Maintain specific package versions
4. Faster Deployment: No download time
5. Disaster Recovery: Always have packages available

### Creating Local Repository from DVD

#### Step 1: Mount the DVD/ISO

Insert DVD or have ISO file ready

# Create mount point
mkdir -p /mnt/cdrom

# Mount DVD drive
mount /dev/cdrom /mnt/cdrom

# Or mount ISO file
mount -o loop /path/to/CentOS-7-x86_64-DVD.iso /mnt/cdrom

# Verify mount
ls -l /mnt/cdrom
# Output: Packages/, repodata/, RPM-GPG-KEY-CentOS-7

#### Step 2: Copy DVD Contents to Local Directory (Optional)

# Create repository directory
mkdir -p /local-repo

# Copy all contents
cp -r /mnt/cdrom/* /local-repo/

# Or create hard links (saves space)
cp -al /mnt/cdrom/* /local-repo/

#### Step 3: Install createrepo Tool

The createrepo command creates repository metadata

# Install createrepo
yum install createrepo -y

#### Step 4: Create Repository Metadata

# Navigate to repository directory
cd /local-repo

# Create repository
createrepo .

# Or if updating existing repo
createrepo --update .

Output:
Spawning worker 0 with 1500 pkgs
Workers Finished
Saving Primary metadata
Saving file lists metadata
Saving other metadata
Generating sqlite DBs
Sqlite DBs complete

This creates repodata/ directory with:
- repomd.xml (repository metadata)
- primary.xml.gz (package list)
- filelists.xml.gz (file information)
- other.xml.gz (additional metadata)

#### Step 5: Configure YUM to Use Local Repository

# Create repository configuration file
vim /etc/yum.repos.d/local.repo

Add the following content:
[local-repo]
name=Local Repository from DVD
baseurl=file:///local-repo
enabled=1
gpgcheck=0

Explanation of fields:
[local-repo]        = Repository ID (unique name)
name=               = Human-readable description
baseurl=            = Location of repository (file://, http://, ftp://)
enabled=1           = Enable this repo (1=yes, 0=no)
gpgcheck=0          = Skip GPG signature verification (1=check, 0=skip)

#### Step 6: Disable Other Repositories (Optional)

If you want to ONLY use local repository:

# Backup existing configs
cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup

# Disable all remote repositories
sed -i 's/enabled=1/enabled=0/g' /etc/yum.repos.d/CentOS-Base.repo

Or rename them:
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.disabled

#### Step 7: Clean YUM Cache and Verify

# Clean yum cache
yum clean all

# Verify repository list
yum repolist

Output:
repo id          repo name                           status
local-repo       Local Repository from DVD           4,021

# Test installation
yum install httpd -y

### Creating Network-Accessible Local Repository

If you want to share repository with other servers:

#### Option 1: HTTP Repository (Using Apache)

Step 1: Install Apache
yum install httpd -y

Step 2: Configure Apache
# Create symbolic link
ln -s /local-repo /var/www/html/repo

# Or copy repository
cp -r /local-repo /var/www/html/repo

Step 3: Set permissions
chmod -R 755 /var/www/html/repo
chown -R apache:apache /var/www/html/repo

Step 4: Start Apache
systemctl start httpd
systemctl enable httpd

Step 5: Configure firewall
firewall-cmd --permanent --add-service=http
firewall-cmd --reload

Step 6: Test access
curl http://localhost/repo/repodata/repomd.xml

On client machines, configure:
[network-repo]
name=Network Local Repository
baseurl=http://192.168.1.100/repo
enabled=1
gpgcheck=0

#### Option 2: NFS Repository

Step 1: Install NFS
yum install nfs-utils -y

Step 2: Export directory
echo "/local-repo *(ro,sync,no_root_squash)" >> /etc/exports

Step 3: Start NFS
systemctl start nfs-server
systemctl enable nfs-server
exportfs -a

Step 4: Configure firewall
firewall-cmd --permanent --add-service=nfs
firewall-cmd --reload

On client machines:
# Mount NFS share
mount -t nfs 192.168.1.100:/local-repo /mnt/nfs-repo

# Configure yum
[nfs-repo]
name=NFS Local Repository
baseurl=file:///mnt/nfs-repo
enabled=1
gpgcheck=0

### Advanced: Creating Custom Repository with Your Own Packages

Step 1: Create directory structure
mkdir -p /custom-repo/Packages

Step 2: Copy your RPM files
cp /path/to/custom/*.rpm /custom-repo/Packages/

Step 3: Create repository
createrepo /custom-repo

Step 4: Add new packages and update
cp /path/to/new-package.rpm /custom-repo/Packages/
createrepo --update /custom-repo

Step 5: Configure yum
[custom-repo]
name=Custom Package Repository
baseurl=file:///custom-repo
enabled=1
gpgcheck=0

---

## 4. Advanced Package Management

### Core Package Management Operations

#### 1. Installing Packages

Method 1: Using YUM (with dependencies)
# Install single package
yum install httpd -y

# Install multiple packages
yum install httpd mysql php -y

# Install specific version
yum install httpd-2.4.6 -y

# Install from local RPM file (with dependency resolution)
yum localinstall /path/to/package.rpm -y

Method 2: Using RPM (no automatic dependencies)
# Install package
rpm -ivh package.rpm

# Install with verbose output
rpm -ivh --verbose package.rpm

# Install without dependencies (force)
rpm -ivh --nodeps package.rpm

Flags explained:
-i = install
-v = verbose
-h = hash marks (progress bar)
--nodeps = ignore dependencies (dangerous!)
--force = force installation even if already installed

#### 2. Upgrading Packages

Using YUM:
# Upgrade specific package
yum update httpd -y

# Upgrade all packages
yum update -y

# Upgrade only if package is already installed
yum upgrade package-name -y

Using RPM:
# Upgrade package
rpm -Uvh package-new-version.rpm

# Freshen (only upgrade if older version is installed)
rpm -Fvh package-new-version.rpm

Flags:
-U = upgrade (install if not present, upgrade if present)
-F = freshen (only upgrade if already installed)

#### 3. Deleting/Removing Packages

Using YUM:
# Remove package
yum remove httpd -y

# Remove with dependencies
yum autoremove httpd -y

# Remove multiple packages
yum remove httpd mysql -y

Using RPM:
# Remove package
rpm -e httpd

# Remove without checking dependencies (dangerous!)
rpm -e --nodeps httpd

# Remove with verbose output
rpm -ev httpd

#### 4. View Package Details and Information

Query Installed Packages:
# List all installed packages
rpm -qa

# List all installed packages with yum
yum list installed

# Search for specific package
rpm -qa | grep httpd
yum list installed | grep httpd

# Count installed packages
rpm -qa | wc -l

Package Information:
# Get detailed info about installed package
rpm -qi httpd
yum info httpd

Output example:
Name        : httpd
Version     : 2.4.6
Release     : 98.el7.centos
Architecture: x86_64
Install Date: Thu 21 Nov 2025 10:00:00 AM EST
Group       : System Environment/Daemons
Size        : 9821023
License     : ASL 2.0
Signature   : RSA/SHA256
Source RPM  : httpd-2.4.6-98.el7.centos.src.rpm
Build Date  : Mon 15 Nov 2025 03:00:00 PM EST
Build Host  : x86-01.bsys.centos.org
Summary     : Apache HTTP Server
Description : The Apache HTTP Server is a powerful, efficient, and extensible
              web server.

List Files in Package:
# List all files installed by package
rpm -ql httpd

Output:
/etc/httpd
/etc/httpd/conf
/etc/httpd/conf/httpd.conf
/usr/sbin/httpd
/var/log/httpd
/var/www/html

# Find which package owns a file
rpm -qf /usr/sbin/httpd
Output: httpd-2.4.6-98.el7.centos.x86_64

# List documentation files
rpm -qd httpd

# List configuration files
rpm -qc httpd

#### 5. Identify Source or Location Information

Check Package Source:
# Show which repository provides package
yum info httpd | grep -i repo

Output:
Repo        : updates

# List all available repositories
yum repolist all

# Show packages from specific repository
yum repo-pkgs <repo-name> list

# Show what repository would be used
yum --showduplicates list httpd

# Check if package is available
yum search httpd

Check Package Dependencies:
# Show dependencies for installed package
rpm -qR httpd

Output:
/bin/bash
/bin/sh
/usr/sbin/useradd
config(httpd) = 2.4.6-98.el7.centos
libapr-1.so.0
libssl.so.10

# Show what depends on this package
rpm -q --whatrequires httpd

# Show dependencies before installing
yum deplist httpd

Check Package Download Location:
# Download package without installing
yum install --downloadonly --downloaddir=/tmp httpd

# Show download URLs
yum install httpd --downloadonly -y

# View package cache location
ls /var/cache/yum/x86_64/7/

#### 6. Package Configuration Files

YUM Configuration:
# Main YUM configuration
/etc/yum.conf

Content example:
[main]
cachedir=/var/cache/yum/$basearch/$releasever
keepcache=0
debuglevel=2
logfile=/var/yum.log
exactarch=1
obsoletes=1
gpgcheck=1
plugins=1

# Repository configurations
/etc/yum.repos.d/

Common repository files:
/etc/yum.repos.d/CentOS-Base.repo
/etc/yum.repos.d/epel.repo
/etc/yum.repos.d/custom.repo

RPM Configuration:
# RPM database location
/var/lib/rpm/

# View RPM macros
rpm --showrc

APT Configuration (Debian/Ubuntu):
# Main configuration
/etc/apt/apt.conf

# Repository sources
/etc/apt/sources.list
/etc/apt/sources.list.d/

### Package Groups

View and Install Package Groups:
# List available groups
yum grouplist

# Install group
yum groupinstall "Development Tools" -y

# Remove group
yum groupremove "Development Tools" -y

# View group info
yum groupinfo "Development Tools"

Common Groups:
- Development Tools (gcc, make, etc.)
- Web Server (httpd, php, etc.)
- Database Server (mysql, postgresql, etc.)
- Graphical Administration Tools

---

## 5. Rollback Updates and Patches

### Understanding Rollback Scenarios

Rollback is needed when:
- Update causes system instability
- Application compatibility issues
- Performance degradation
- Critical service failures
- Testing/validation requirements

### Two Types of Rollback

#### 1. Virtual Machine Rollback
- Use VM snapshots
- Instant rollback to previous state
- No data loss
- Complete system restoration

VMware Example:
1. Take snapshot before update: "Before-Update-Nov-21-2025"
2. Apply updates: yum update -y
3. If problems occur: Revert to snapshot
4. System restored to exact state before update

#### 2. Physical Machine Rollback
- Use package management tools
- Selective rollback (specific packages)
- Requires package history
- More complex than VM snapshot

### Rollback a Package or Patch

#### Method 1: Reinstall Specific Package Version

Step 1: Check installed version
rpm -qa | grep httpd
Output: httpd-2.4.6-98.el7.centos.x86_64

Step 2: Check available versions
yum --showduplicates list httpd

Output:
Available Packages
httpd.x86_64    2.4.6-97.el7.centos    base
httpd.x86_64    2.4.6-98.el7.centos    updates

Step 3: Downgrade to specific version
yum downgrade httpd-2.4.6-97.el7.centos -y

Or using specific version:
yum install httpd-2.4.6-97.el7.centos -y

#### Method 2: Using yum history undo

View Transaction History:
yum history

Output:
ID     | Command line             | Date and time    | Action(s)      | Altered
-------------------------------------------------------------------------------
    30 | update                   | 2025-11-21 10:00 | Update         |   15
    29 | install httpd           | 2025-11-20 14:30 | Install        |    5
    28 | remove php              | 2025-11-19 09:15 | Erase          |    8
    27 | update kernel           | 2025-11-18 08:00 | Update         |    3

View Specific Transaction Details:
yum history info 30

Output:
Transaction ID : 30
Begin time     : Thu Nov 21 10:00:00 2025
Begin rpmdb    : 450:a1b2c3d4e5f6
End time       :            10:05:30 2025 (5 minutes)
End rpmdb      : 450:f6e5d4c3b2a1
User           : root <root>
Return-Code    : Success
Command Line   : update
Transaction performed with:
    Installed     rpm-4.11.3-45.el7.x86_64
    Installed     yum-3.4.3-168.el7.centos.noarch
Packages Altered:
    Updated httpd-2.4.6-97.el7.centos.x86_64    @base
    Update         2.4.6-98.el7.centos.x86_64    @updates
    Updated kernel-3.10.0-1160.el7.x86_64      @base
    Update         3.10.0-1161.el7.x86_64      @updates

Undo Specific Transaction:
yum history undo 30 -y

This will:
1. Identify all packages changed in transaction 30
2. Revert httpd from 2.4.6-98 back to 2.4.6-97
3. Revert kernel from 3.10.0-1161 back to 3.10.0-1160
4. Restore all affected packages to previous versions

Alternative: Redo a Transaction:
yum history redo 29 -y
# Re-executes transaction 29 (useful for testing)

Rollback to Specific Transaction:
yum history rollback 28 -y
# Undoes all transactions from current state back to transaction 28

### Rollback an Update (System-Wide)

#### Important Warning About Major Downgrades

Downgrading major versions is NOT recommended:
- RHEL 7.1 → RHEL 7.0: DANGEROUS
- CentOS 8 → CentOS 7: NOT SUPPORTED
- May leave system in unstable/broken state
- Potential data corruption
- Missing dependencies
- Incompatible configurations

Recommendation:
- For major downgrades: Reinstall OS
- For minor updates: Use yum history undo
- Always test in development first

#### yum update vs yum upgrade (Rollback Perspective)

Scenario: Package-X version 1.0 → 2.0, Package-Y is obsolete

After yum update:
- Package-X updated to 2.0
- Package-Y still installed (obsolete but present)
- Rollback: Easy (Package-Y still available)

After yum upgrade:
- Package-X updated to 2.0
- Package-Y removed (deleted)
- Rollback: Difficult (need to reinstall Package-Y manually)

#### Safe Rollback Process

Before Update (Preparation):
# 1. Take system snapshot (if VM)
# 2. Backup critical data
tar -czf /backup/etc-$(date +%F).tar.gz /etc

# 3. Document current state
rpm -qa > /backup/installed-packages-$(date +%F).txt
yum list installed > /backup/yum-installed-$(date +%F).txt

# 4. Note transaction ID before update
yum history | head

Apply Update:
yum update -y
# Note the transaction ID shown at the end

Test System:
# Run application tests
# Check service status
systemctl status httpd
systemctl status mysql

# Check logs
journalctl -xe
tail -f /var/log/messages

If Problems Detected:
# Option 1: Undo last update transaction
LAST_ID=$(yum history | sed -n '3p' | awk '{print $1}')
yum history undo $LAST_ID -y

# Option 2: Revert specific packages
yum downgrade package-name -y

# Option 3: Restore from backup (last resort)
# Revert to VM snapshot or reinstall problematic packages

Verify Rollback:
# Check package versions
rpm -qa | grep package-name

# Verify services
systemctl status service-name

# Test functionality
curl http://localhost

#### Using yum history undo <id>

Complete Example:

Step 1: Before update
yum history
Output:
ID     | Command line             | Date and time    | Action(s)
    45 | install mysql           | 2025-11-20 14:00 | Install

Step 2: Apply update
yum update -y
Output:
Transaction ID: 46
Updated: 15 packages

Step 3: Verify new transaction
yum history
Output:
ID     | Command line             | Date and time    | Action(s)
    46 | update                   | 2025-11-21 10:00 | Update
    45 | install mysql           | 2025-11-20 14:00 | Install

Step 4: Problem detected - rollback
yum history undo 46 -y

Output:
Undoing transaction 46, from Thu Nov 21 10:00:00 2025
    Updated httpd-2.4.6-98.el7    to    2.4.6-97.el7
    Updated kernel-3.10.0-1161    to    3.10.0-1160
Resolving Dependencies
--> Running transaction check
---> Package httpd.x86_64 0:2.4.6-98.el7 will be downgraded
---> Package httpd.x86_64 0:2.4.6-97.el7 will be an update
Complete!

Step 5: Verify rollback
rpm -qa | grep httpd
Output: httpd-2.4.6-97.el7.centos.x86_64  # Back to original version

### Advanced Rollback Scenarios

#### Scenario 1: Kernel Rollback

Problem: New kernel causes boot issues

Solution:
# List installed kernels
rpm -qa | grep kernel

Output:
kernel-3.10.0-1160.el7.x86_64  # Old working kernel
kernel-3.10.0-1161.el7.x86_64  # New problematic kernel

# Option 1: Boot into old kernel
# At boot, select old kernel from GRUB menu

# Option 2: Set old kernel as default
grub2-set-default 1  # Where 1 is the old kernel position
grub2-mkconfig -o /boot/grub2/grub.cfg

# Option 3: Remove new kernel
yum remove kernel-3.10.0-1161.el7 -y

# Verify
grubby --default-kernel
Output: /boot/vmlinuz-3.10.0-1160.el7.x86_64

#### Scenario 2: Multiple Package Rollback

Problem: Update broke multiple interdependent packages

# View what changed in last transaction
yum history info last

# Undo entire transaction
yum history undo last -y

# Or specify transaction ID
yum history undo 46 -y

#### Scenario 3: Database Package Rollback

Problem: MySQL update broke application

# Check current version
rpm -qa | grep mysql

# View available versions
yum --showduplicates list mysql-server

# Downgrade to specific version
yum downgrade mysql-server-5.7.35-1.el7 -y

# Restore database from backup if needed
systemctl stop mysqld
mv /var/lib/mysql /var/lib/mysql.broken
tar -xzf /backup/mysql-data.tar.gz -C /var/lib/
systemctl start mysqld

---

## 6. Daily Use Cases

### Use Case 1: Monthly Security Patching

Scenario: Security team requires monthly patching of production servers

Monthly Patching Procedure:

# Step 1: Pre-patch backup
date=$(date +%Y%m%d)
mkdir -p /backup/pre-patch-$date

# Backup package list
rpm -qa | sort > /backup/pre-patch-$date/installed-packages.txt

# Backup critical configs
tar -czf /backup/pre-patch-$date/etc-backup.tar.gz /etc

# Step 2: Check available updates
yum check-update > /backup/pre-patch-$date/available-updates.txt

# Step 3: Apply security updates only
yum update --security -y

# Step 4: Verify and reboot if needed
needs-restarting
# If kernel updated:
shutdown -r +5 "System reboot for kernel update in 5 minutes"

# Step 5: Post-patch verification
systemctl status httpd
systemctl status mysql
curl http://localhost

Real-Life Example:
- Every 2nd Tuesday (Patch Tuesday)
- Automated via Ansible/cron
- Development → Staging → Production rollout
- Rollback plan ready if issues occur

### Use Case 2: New Application Installation

Scenario: Installing WordPress with all dependencies

# Step 1: Install web server
yum install httpd -y

# Step 2: Install PHP and modules
yum install php php-mysql php-gd php-xml php-mbstring -y

# Step 3: Install MySQL/MariaDB
yum install mariadb-server mariadb -y

# Step 4: Install additional tools
yum install wget unzip -y

# Step 5: Verify installations
rpm -qa | grep -E "httpd|php|mariadb"

# Step 6: Start services
systemctl start httpd
systemctl start mariadb
systemctl enable httpd
systemctl enable mariadb

# Step 7: Download and install WordPress
cd /var/www/html
wget https://wordpress.org/latest.tar.gz
tar -xzf latest.tar.gz
chown -R apache:apache wordpress

Real-Life Example:
- DevOps engineer setting up new web server
- All done from command line
- Automated with configuration management (Ansible/Puppet)

### Use Case 3: Troubleshooting Broken Dependencies

Scenario: Package installation fails due to dependency issues

Problem:
yum install application-x
Error: Package: application-x requires library-y >= 2.0
       Installed: library-y-1.5

Solution Process:

# Step 1: Identify exact issue
yum deplist application-x

# Step 2: Check what's available
yum list library-y
yum --showduplicates list library-y

# Step 3: Update dependency
yum update library-y -y

# Step 4: Retry installation
yum install application-x -y

# Alternative: Install from different repository
yum install application-x --enablerepo=epel -y

Real-Life Example:
- Common when installing third-party software
- May need to enable EPEL repository
- Sometimes requires manual RPM installation

### Use Case 4: Creating Offline Installation Package

Scenario: Need to install software on air-gapped server (no internet)

On Internet-Connected Server:

# Step 1: Download package and all dependencies
mkdir /tmp/offline-packages
cd /tmp/offline-packages

# Download httpd and all dependencies
yum install --downloadonly --downloaddir=/tmp/offline-packages httpd

# Step 2: Create local repository
createrepo /tmp/offline-packages

# Step 3: Package everything
cd /tmp
tar -czf httpd-offline-repo.tar.gz offline-packages/

# Step 4: Transfer to offline server
scp httpd-offline-repo.tar.gz user@offline-server:/tmp/

On Offline Server:

# Step 5: Extract package
cd /tmp
tar -xzf httpd-offline-repo.tar.gz

# Step 6: Create repository config
cat > /etc/yum.repos.d/offline.repo <<EOF
[offline]
name=Offline Repository
baseurl=file:///tmp/offline-packages
enabled=1
gpgcheck=0
EOF

# Step 7: Install from local repo
yum clean all
yum install httpd -y

Real-Life Example:
- Secure/classified environments
- Disconnected data centers
- Compliance requirements
- Network-isolated servers

### Use Case 5: Cloning Server Configuration

Scenario: Need to replicate exact package setup on new server

On Source Server:

# Export installed packages
rpm -qa --qf '%{NAME}\n' | sort > /tmp/installed-packages.txt

# Or with versions
rpm -qa --qf '%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n' | sort > /tmp/installed-packages-versions.txt

# Transfer to new server
scp /tmp/installed-packages.txt user@new-server:/tmp/

On New Server:

# Install all packages from list
cat /tmp/installed-packages.txt | xargs yum install -y

# Or for specific versions
while read package; do
  yum install $package -y
done < /tmp/installed-packages-versions.txt

Real-Life Example:
- Scaling infrastructure (new web server nodes)
- Disaster recovery (rebuild failed server)
- Development environment setup
- Testing environment creation

### Use Case 6: Repository Management for Multiple Servers

Scenario: Managing central repository for entire organization

Central Repository Server Setup:

# Step 1: Create repository directory structure
mkdir -p /var/www/html/repos/centos/7/os/x86_64
mkdir -p /var/www/html/repos/custom/7/x86_64

# Step 2: Sync CentOS repository (mirror)
rsync -avz --delete rsync://mirror.centos.org/centos/7/ \
  /var/www/html/repos/centos/7/ \
  --exclude='iso' --exclude='atomic'

# Step 3: Add custom packages
cp /path/to/custom/*.rpm /var/www/html/repos/custom/7/x86_64/

# Step 4: Create repository metadata
createrepo /var/www/html/repos/custom/7/x86_64/

# Step 5: Set up automated sync
cat > /etc/cron.daily/repo-sync <<'EOF'
#!/bin/bash
rsync -avz --delete rsync://mirror.centos.org/centos/7/ \
  /var/www/html/repos/centos/7/ \
  --exclude='iso' --exclude='atomic'
createrepo --update /var/www/html/repos/custom/7/x86_64/
EOF
chmod +x /etc/cron.daily/repo-sync

# Step 6: Configure Apache
systemctl start httpd
systemctl enable httpd

Client Configuration:

# Create repository config
cat > /etc/yum.repos.d/company.repo <<EOF
[company-base]
name=Company CentOS Base Repository
baseurl=http://repo.company.com/repos/centos/7/os/x86_64
enabled=1
gpgcheck=1

[company-custom]
name=Company Custom Packages
baseurl=http://repo.company.com/repos/custom/7/x86_64
enabled=1
gpgcheck=0
EOF

# Disable default repositories
yum-config-manager --disable base updates extras

# Use only company repository
yum clean all
yum repolist

Real-Life Example:
- Enterprise with 100+ servers
- Controlled update management
- Custom application packages
- Bandwidth optimization
- Compliance and auditing

### Use Case 7: Emergency Rollback After Failed Update

Scenario: Production web server crashed after update

Immediate Response:

# Step 1: Check system status
systemctl status httpd
Output: Failed to start httpd

# Step 2: Check logs
journalctl -u httpd -n 50
Output: Error: libssl.so.10: cannot open shared object file

# Step 3: Identify problematic update
yum history
Output:
ID     | Command line             | Date and time
    52 | update                   | 2025-11-21 10:00  # THIS ONE!
    51 | install mod_ssl         | 2025-11-20 14:00

# Step 4: Review what changed
yum history info 52
Output: Updated openssl, httpd, mod_ssl

# Step 5: Emergency rollback
yum history undo 52 -y

# Step 6: Restart service
systemctl start httpd

# Step 7: Verify
curl http://localhost
Output: HTTP 200 OK

# Step 8: Document incident
echo "$(date): Rolled back transaction 52 due to httpd failure" >> /var/log/emergency-rollbacks.log

Real-Life Example:
- 3 AM production outage
- Website down, customers affected
- Quick rollback restores service
- Full investigation next day
- Staged update testing implemented

### Use Case 8: Audit and Compliance Checking

Scenario: Security audit requires verification of installed packages

# Generate package inventory report
cat > /tmp/package-audit.sh <<'EOF'
#!/bin/bash
OUTPUT_FILE="/tmp/package-audit-$(date +%Y%m%d).html"

cat > $OUTPUT_FILE <<HTML
<html>
<head><title>Package Audit Report</title></head>
<body>
<h1>System Package Audit - $(hostname)</h1>
<h2>Generated: $(date)</h2>

<h3>System Information</h3>
<pre>
OS: $(cat /etc/redhat-release)
Kernel: $(uname -r)
Total Packages: $(rpm -qa | wc -l)
</pre>

<h3>Recently Updated Packages (Last 30 Days)</h3>
<table border="1">
<tr><th>Package</th><th>Version</th><th>Install Date</th></tr>
HTML

rpm -qa --last | head -30 | while read pkg; do
  name=$(echo $pkg | awk '{print $1}')
  date=$(echo $pkg | awk '{print $2,$3,$4,$5}')
  echo "<tr><td>$name</td><td>$date</td></tr>" >> $OUTPUT_FILE
done

cat >> $OUTPUT_FILE <<HTML
</table>

<h3>Security Updates Applied</h3>
<pre>
$(yum history list | grep -i update | head -10)
</pre>

<h3>Packages from Non-Standard Repositories</h3>
<pre>
$(yum list installed | grep -v "@base\|@updates\|@extras")
</pre>

</body>
</html>
HTML

echo "Report generated: $OUTPUT_FILE"
EOF

chmod +x /tmp/package-audit.sh
/tmp/package-audit.sh

Real-Life Example:
- Quarterly security audits
- Compliance reporting (PCI-DSS, HIPAA)
- Change management documentation
- License compliance verification

---

## 7. Real-Life Scenarios

### Scenario 1: Startup Application Migration

Story: You're migrating a web application from Ubuntu to CentOS

Challenge: Different package managers (apt → yum)

Step 1: Document Ubuntu packages
On Ubuntu server:
dpkg -l | grep ^ii | awk '{print $2}' > ubuntu-packages.txt

Step 2: Map to CentOS equivalents
Ubuntu → CentOS package mapping:
apache2 → httpd
mysql-server → mariadb-server
php7.4 → php
php7.4-mysql → php-mysql
libapache2-mod-php → php (included)

Step 3: Install on CentOS
yum install httpd mariadb-server php php-mysql -y

Step 4: Migrate configurations
scp user@ubuntu:/etc/apache2/sites-available/myapp.conf /tmp/
# Convert Apache config from Ubuntu format to CentOS format
# Copy to /etc/httpd/conf.d/

Step 5: Verify and test
systemctl start httpd mariadb
curl http://localhost/myapp

### Scenario 2: Automated Security Hardening

Story: Security team requires automated monthly hardening script

Implementation:
cat > /root/security-hardening.sh <<'EOF'
#!/bin/bash
LOG="/var/log/security-hardening.log"
echo "=== Security Hardening Started: $(date) ===" >> $LOG

# Step 1: Update all packages
echo "Applying security updates..." >> $LOG
yum update --security -y >> $LOG 2>&1

# Step 2: Remove unnecessary packages
echo "Removing unnecessary packages..." >> $LOG
for pkg in telnet rsh-server xinetd; do
  if rpm -q $pkg &>/dev/null; then
    yum remove $pkg -y >> $LOG 2>&1
    echo "Removed: $pkg" >> $LOG
  fi
done

# Step 3: Install security tools
echo "Installing security tools..." >> $LOG
yum install aide fail2ban -y >> $LOG 2>&1

# Step 4: Update package database
echo "Updating package database..." >> $LOG
rpm -Va --nofiles --nodigest >> $LOG 2>&1

# Step 5: Generate report
echo "=== Hardening Completed: $(date) ===" >> $LOG
echo "Current package count: $(rpm -qa | wc -l)" >> $LOG

# Email report
mail -s "Security Hardening Report - $(hostname)" admin@company.com < $LOG
EOF

chmod +x /root/security-hardening.sh

# Schedule monthly
echo "0 2 1 * * /root/security-hardening.sh" | crontab -

### Scenario 3: Disaster Recovery with Package Restoration

Story: Production server hard drive failed, need to rebuild

Recovery Process:

Step 1: From backup, retrieve package list
# Assuming you had backed up
scp backup-server:/backups/server01/installed-packages.txt /tmp/

Step 2: Install base OS
# Fresh CentOS installation

Step 3: Configure repositories
# Copy backed up repo configs
scp backup-server:/backups/server01/etc/yum.repos.d/* /etc/yum.repos.d/

Step 4: Mass install all packages
cat /tmp/installed-packages.txt | xargs yum install -y

Step 5: Restore configurations
scp backup-server:/backups/server01/etc-backup.tar.gz /tmp/
cd /
tar -xzf /tmp/etc-backup.tar.gz

Step 6: Restore application data
rsync -avz backup-server:/backups/server01/var/www/ /var/www/
rsync -avz backup-server:/backups/server01/var/lib/mysql/ /var/lib/mysql/

Step 7: Start services
systemctl start httpd mariadb
systemctl enable httpd mariadb

Step 8: Verify
curl http://localhost
mysql -e "SHOW DATABASES;"

### Scenario 4: Multi-Environment Package Consistency

Story: Maintain identical packages across Dev/Stage/Prod

Solution: Package Version Locking

Step 1: On production (gold standard)
# Export exact package versions
rpm -qa --qf '%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n' | sort > /shared/prod-packages.txt

Step 2: Create version lock file
yum install yum-plugin-versionlock -y

# Lock all packages to current versions
yum versionlock add $(cat /shared/prod-packages.txt | tr '\n' ' ')

# Or lock specific packages
yum versionlock add httpd-2.4.6-97.el7.* mysql-5.7.35-1.el7.*

# View locked packages
yum versionlock list

Step 3: On development/staging servers
# Install same version lock file
scp prod-server:/etc/yum/pluginconf.d/versionlock.list /etc/yum/pluginconf.d/

# Install packages
cat /shared/prod-packages.txt | xargs yum install -y

Step 4: Controlled updates
# When ready to update, unlock, update, re-lock
yum versionlock clear
yum update httpd -y
yum versionlock add httpd

### Scenario 5: Building Custom Application Package

Story: Deploy custom application as RPM package

Creating RPM:

# Step 1: Install RPM build tools
yum install rpm-build rpmdevtools -y

# Step 2: Create build environment
rpmdev-setuptree

# Creates:
# ~/rpmbuild/BUILD
# ~/rpmbuild/RPMS
# ~/rpmbuild/SOURCES
# ~/rpmbuild/SPECS
# ~/rpmbuild/SRPMS

# Step 3: Create spec file
cat > ~/rpmbuild/SPECS/myapp.spec <<EOF
Name:           myapp
Version:        1.0
Release:        1%{?dist}
Summary:        My Custom Application

License:        MIT
Source0:        %{name}-%{version}.tar.gz

%description
My custom application package

%prep
%setup -q

%build
make %{?_smp_mflags}

%install
make install DESTDIR=%{buildroot}

%files
%defattr(-,root,root,-)
/usr/local/bin/myapp
/etc/myapp/config.conf

%changelog
* Thu Nov 21 2025 Your Name <you@company.com> - 1.0-1
- Initial package release
EOF

# Step 4: Build RPM
rpmbuild -ba ~/rpmbuild/SPECS/myapp.spec

# Step 5: Install custom RPM
rpm -ivh ~/rpmbuild/RPMS/x86_64/myapp-1.0-1.el7.x86_64.rpm

# Step 6: Add to custom repository
cp ~/rpmbuild/RPMS/x86_64/myapp-1.0-1.el7.x86_64.rpm /local-repo/
createrepo --update /local-repo/

---

## 8. Troubleshooting Common Issues

### Issue 1: Corrupted RPM Database

Symptoms:
yum install package
Error: rpmdb open failed

Solution:
# Backup database
cp -a /var/lib/rpm /var/lib/rpm.backup

# Rebuild database
rpm --rebuilddb

# Verify
rpm -qa

# If still fails:
cd /var/lib/rpm
rm -f __db*
rpm --rebuilddb

### Issue 2: Dependency Hell

Symptoms:
Error: Package A requires B >= 2.0
       Package C requires B < 2.0

Solution:
# Option 1: Find compatible versions
yum --showduplicates list package-B

# Option 2: Use different repositories
yum install package-A --enablerepo=epel

# Option 3: Exclude conflicting package
yum install package-A --exclude=package-C

# Option 4: Force (last resort, dangerous)
rpm -ivh --nodeps package-A.rpm

### Issue 3: Slow yum Updates

Symptoms:
yum check-update takes 10+ minutes

Solution:
# Clean cache
yum clean all

# Install fastestmirror plugin
yum install yum-plugin-fastestmirror -y

# Disable slow repositories temporarily
yum-config-manager --disable repo-name

# Use specific mirror
yum install package --setopt=baseurl=http://fast-mirror.com/repo

### Issue 4: Repository Metadata Errors

Symptoms:
Error: repomd.xml signature could not be verified

Solution:
# Clean metadata
yum clean metadata

# Or clean all
yum clean all

# Disable GPG check temporarily (not recommended for production)
yum install package --nogpgcheck

# Re-import GPG keys
rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7

### Issue 5: Package Already Installed But Broken

Symptoms:
Package installed but binary doesn't work

Solution:
# Reinstall package
yum reinstall httpd -y

# Or force reinstall with RPM
rpm -e --nodeps httpd
yum install httpd -y

# Verify installation
rpm -V httpd

# If files missing:
yum reinstall httpd -y

---

## 9. Best Practices

### 1. Pre-Update Checklist
- Take snapshot/backup
- Document current state
- Check release notes
- Test in development first
- Schedule maintenance window
- Notify stakeholders

### 2. Update Frequency
Development: Weekly updates
Staging: Bi-weekly, after dev testing
Production: Monthly, with security patches immediately

### 3. Always Use Transactions
# Good practice
yum install httpd mysql php -y

# Bad practice
yum install httpd -y
yum install mysql -y
yum install php -y
# Creates 3 separate transactions, harder to rollback

### 4. Lock Critical Package Versions
yum install yum-plugin-versionlock -y
yum versionlock add kernel-*
# Prevents accidental kernel updates

### 5. Monitor Repository Changes
# Create weekly report
yum check-update | mail -s "Available Updates - $(hostname)" admin@company.com

### 6. Document Everything
# Maintain change log
echo "$(date) - Updated httpd to 2.4.6-98 - Ticket #12345" >> /var/log/package-changes.log

### 7. Automate Safely
# Use idempotent scripts
# Include error handling
# Log everything
# Send notifications

---

## 10. Quick Reference Commands

### YUM Essential Commands
yum install package          # Install package
yum update                   # Update all packages
yum update package           # Update specific package
yum remove package           # Remove package
yum search keyword           # Search for package
yum info package             # Show package info
yum list installed           # List installed packages
yum check-update             # Check for updates
yum history                  # Show transaction history
yum history undo ID          # Rollback transaction
yum clean all                # Clean cache
yum repolist                 # List repositories
yum provides /path/to/file   # Find package providing file

### RPM Essential Commands
rpm -ivh package.rpm         # Install package
rpm -Uvh package.rpm         # Upgrade package
rpm -e package               # Remove package
rpm -qa                      # List all installed
rpm -qi package              # Package information
rpm -ql package              # List files in package
rpm -qf /path/to/file        # Find package owning file
rpm -qR package              # Show dependencies
rpm -Va                      # Verify all packages
rpm --rebuilddb              # Rebuild RPM database

### Repository Management
createrepo /path/to/repo     # Create repository
createrepo --update /repo    # Update repository
yum-config-manager --add-repo http://repo.url
yum-config-manager --enable repo-name
yum-config-manager --disable repo-name

### History and Rollback
yum history list             # Show all transactions
yum history info ID          # Transaction details
yum history undo ID          # Undo transaction
yum history redo ID          # Redo transaction
yum history rollback ID      # Rollback to transaction
yum downgrade package        # Downgrade package

---

## Conclusion

### Key Takeaways

1. **Package Managers**: YUM (repository-based, auto-dependencies) vs RPM (local files, manual dependencies)

2. **Update vs Upgrade**: update preserves packages, upgrade removes obsolete ones

3. **Local Repository**: Essential for offline environments, created with createrepo

4. **Advanced Management**: Install, upgrade, delete, query packages and dependencies

5. **Rollback**: Use yum history undo for safe rollbacks, avoid major version downgrades

6. **Best Practices**: Always backup, test in dev, document changes, automate carefully

7. **Real-World**: Security patching, application deployment, disaster recovery, compliance

### Most Important Commands to Remember

# System updates (most common)
yum update -y

# Install with dependencies
yum install package-name -y

# Rollback last update
yum history undo last -y

# Create local repository
createrepo /path/to/repo

# Check what's installed
rpm -qa | grep package-name

# View package history
yum history

These commands cover 90% of daily package management tasks!

---

## Author Information
Content based on Linux system administration best practices
For enterprise Linux environments (RHEL/CentOS)

Remember: Always test in development before production!
