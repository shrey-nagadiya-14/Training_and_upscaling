# timedatectl Command - Complete Guide

## Table of Contents
1. [What is timedatectl?](#what-is-timedatectl)
2. [timedatectl vs date Command](#timedatectl-vs-date-command)
3. [Command Syntax & Options](#command-syntax-options)
4. [Time Synchronization](#time-synchronization)
5. [Daily Use Cases](#daily-use-cases)
6. [Real-Life Examples](#real-life-examples)
7. [Troubleshooting](#troubleshooting)

---

## 1. What is timedatectl?

### Overview
- **timedatectl** is a modern system utility command for RHEL/CentOS 7/8+ based distributions
- Part of the **systemd** system and service manager
- Replacement for the old traditional **date** command
- Used for managing system date, time, and timezone settings
- Can synchronize time with NTP (Network Time Protocol) servers
- Provides a unified interface for time management

### Key Features
âœ… View current date, time, and timezone
âœ… Change system date and time
âœ… Set timezone
âœ… Enable/disable NTP synchronization
âœ… Query time synchronization status
âœ… List available timezones
âœ… No need for manual hardware clock sync (automatic)

### Why timedatectl?
Old way (before RHEL 7):
- Multiple commands needed: date, hwclock, ntpd
- Manual synchronization between system and hardware clock
- Complex timezone management
- Separate services for time sync

New way (RHEL 7+):
- Single command: timedatectl
- Automatic hardware clock synchronization
- Simplified timezone management
- Integrated with systemd-timesyncd or chronyd

---

## 2. timedatectl vs date Command

### Old Method (date command)

Check current date/time:
date

Set date:
date -s "2025-11-20"

Set time:
date -s "14:30:00"

Set date and time:
date -s "2025-11-20 14:30:00"

Sync hardware clock:
hwclock --systohc

Problems with date command:
âŒ Doesn't automatically sync with hardware clock
âŒ Time changes can cause issues with running services
âŒ No built-in NTP support
âŒ Requires manual intervention for persistence
âŒ Not integrated with system logging

### New Method (timedatectl command)

Check current date/time:
timedatectl

Set date:
timedatectl set-time "2025-11-20"

Set time:
timedatectl set-time "14:30:00"

Set date and time:
timedatectl set-time "2025-11-20 14:30:00"

Hardware clock sync:
Automatic (no manual command needed)

Advantages of timedatectl:
âœ… Automatically syncs hardware clock
âœ… Integrated with systemd
âœ… Built-in NTP support
âœ… Changes are persistent
âœ… Better logging and auditing
âœ… Service-aware (notifies services of time changes)

---

## 3. Command Syntax & Options

### Basic Syntax
timedatectl [OPTIONS] [COMMAND]

### Common Commands

Command: status (default)
Description: Show current time settings
Usage: timedatectl
       timedatectl status

Command: set-time
Description: Set system time
Usage: timedatectl set-time "YYYY-MM-DD HH:MM:SS"
       timedatectl set-time "YYYY-MM-DD"
       timedatectl set-time "HH:MM:SS"

Command: set-timezone
Description: Set system timezone
Usage: timedatectl set-timezone TIMEZONE
Example: timedatectl set-timezone "America/New_York"

Command: list-timezones
Description: List all available timezones
Usage: timedatectl list-timezones

Command: set-local-rtc
Description: Control whether RTC is in local time
Usage: timedatectl set-local-rtc BOOLEAN
Example: timedatectl set-local-rtc 0  # Use UTC
         timedatectl set-local-rtc 1  # Use local time

Command: set-ntp
Description: Enable/disable NTP synchronization
Usage: timedatectl set-ntp BOOLEAN
Example: timedatectl set-ntp true   # Enable NTP
         timedatectl set-ntp false  # Disable NTP

### Understanding timedatectl Output

When you run: timedatectl

Sample Output:
               Local time: Mon 2025-11-24 10:30:45 EST
           Universal time: Mon 2025-11-24 15:30:45 UTC
                 RTC time: Mon 2025-11-24 15:30:45
                Time zone: America/New_York (EST, -0500)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no

Field Explanations:

Local time:
- Current system time in your timezone
- What users see on the system

Universal time:
- UTC time (Coordinated Universal Time)
- Standard reference time, no timezone offset
- Used internally by many applications

RTC time:
- Real-Time Clock (hardware clock) time
- BIOS/UEFI clock time
- Persists across reboots

Time zone:
- Current timezone setting
- Shows timezone name and offset from UTC
- Example: America/New_York (EST, -0500) means 5 hours behind UTC

System clock synchronized:
- yes: Time is synced with NTP server
- no: Time is not synced (manual time or NTP disabled)

NTP service:
- active: NTP synchronization is enabled and running
- inactive: NTP synchronization is disabled

RTC in local TZ:
- no: Hardware clock uses UTC (recommended for Linux)
- yes: Hardware clock uses local time (Windows default)

---

## 4. Time Synchronization

### NTP (Network Time Protocol)

What is NTP?
- Protocol for synchronizing clocks across network
- Ensures all systems have accurate, consistent time
- Critical for:
  * Log correlation across multiple servers
  * Authentication (Kerberos, certificates)
  * Database transactions
  * Distributed systems
  * Security (time-based tokens)

### Two Ways to Synchronize Time

Method 1: Using chronyd (Recommended for RHEL 8+)
# Install chronyd
sudo dnf install chrony

# Start and enable chronyd
sudo systemctl start chronyd
sudo systemctl enable chronyd

# Check chronyd status
sudo systemctl status chronyd

# Enable NTP in timedatectl
timedatectl set-ntp true

# Verify synchronization
chronyc sources
chronyc tracking

Method 2: Using ntpd (Traditional method)
# Install ntpd
sudo yum install ntp

# Start and enable ntpd
sudo systemctl start ntpd
sudo systemctl enable ntpd

# Check ntpd status
sudo systemctl status ntpd

# Enable NTP in timedatectl
timedatectl set-ntp true

# Verify synchronization
ntpq -p

Method 3: Using systemd-timesyncd (Lightweight option)
# Enable systemd-timesyncd
sudo systemctl start systemd-timesyncd
sudo systemctl enable systemd-timesyncd

# Enable NTP in timedatectl
timedatectl set-ntp true

# Check status
timedatectl timesync-status
timedatectl show-timesync --all

### Important Note
- RedHat/CentOS does NOT include systemd-timesyncd by default
- You must install either chronyd or ntpd separately
- chronyd is the recommended and default choice for RHEL 8+
- chronyd is more accurate and better for systems that go offline

### Checking Time Synchronization

Check if NTP is enabled:
timedatectl | grep "NTP service"

Check which NTP daemon is running:
systemctl is-active chronyd
systemctl is-active ntpd
systemctl is-active systemd-timesyncd

View NTP servers (chronyd):
chronyc sources -v

View NTP servers (ntpd):
ntpq -p

Check time sync accuracy (chronyd):
chronyc tracking

---

## 5. Daily Use Cases

### Use Case 1: Check Current System Time

Scenario: Quick check of system date, time, and timezone

Command:
timedatectl

Output:
               Local time: Mon 2025-11-24 10:30:45 EST
           Universal time: Mon 2025-11-24 15:30:45 UTC
                 RTC time: Mon 2025-11-24 15:30:45
                Time zone: America/New_York (EST, -0500)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no

Real-Life Example:
- Login to server, first thing to check is time
- Verify timezone is correct before deployment
- Quick health check during troubleshooting

### Use Case 2: Set Timezone for New Server

Scenario: Just provisioned a new server, need to set correct timezone

Step 1: List available timezones
timedatectl list-timezones

Step 2: Filter for your region (optional)
timedatectl list-timezones | grep America
timedatectl list-timezones | grep Europe
timedatectl list-timezones | grep Asia

Step 3: Set the timezone
timedatectl set-timezone "America/New_York"

Step 4: Verify
timedatectl

Common Timezones:
America/New_York      # Eastern Time (US)
America/Chicago       # Central Time (US)
America/Denver        # Mountain Time (US)
America/Los_Angeles   # Pacific Time (US)
Europe/London         # GMT/BST
Europe/Paris          # Central European Time
Asia/Tokyo            # Japan Standard Time
Asia/Kolkata          # India Standard Time
Asia/Dubai            # Gulf Standard Time
Australia/Sydney      # Australian Eastern Time
UTC                   # Coordinated Universal Time

Real-Life Example:
- New AWS EC2 instance defaults to UTC
- Application requires local timezone
- Set to company headquarters timezone
- Ensures logs have meaningful timestamps

### Use Case 3: Fix Incorrect System Time

Scenario: System time is wrong due to hardware clock drift or manual change

Step 1: Check current time
timedatectl

Step 2: Disable NTP temporarily (if enabled)
timedatectl set-ntp false

Step 3: Set correct date and time
timedatectl set-time "2025-11-24 10:30:00"

Step 4: Re-enable NTP (recommended)
timedatectl set-ntp true

Step 5: Verify
timedatectl

Note: If NTP is enabled, manual time changes may be overridden

Real-Life Example:
- Database server time is 10 minutes fast
- Causing timestamp conflicts in transactions
- Fix time immediately to prevent data issues
- Enable NTP to prevent future drift

### Use Case 4: Enable Time Synchronization

Scenario: Server time is drifting, need to enable NTP sync

Step 1: Check if NTP is available
systemctl status chronyd
# or
systemctl status ntpd

Step 2: If not installed, install chronyd (RHEL 8+)
sudo dnf install chrony
sudo systemctl start chronyd
sudo systemctl enable chronyd

Step 3: Enable NTP synchronization
timedatectl set-ntp true

Step 4: Verify synchronization
timedatectl
chronyc tracking

Real-Life Example:
- Production server clock drifting by 2 seconds per day
- Causing authentication failures with Kerberos
- Enable NTP to maintain accurate time
- Prevents future authentication issues

### Use Case 5: Configure Server in Different Region

Scenario: Application server for European users, set appropriate timezone

Step 1: Check current timezone
timedatectl | grep "Time zone"

Step 2: Find European timezones
timedatectl list-timezones | grep Europe

Step 3: Set timezone
timedatectl set-timezone "Europe/London"

Step 4: Verify
timedatectl

Real-Life Example:
- Global application with regional servers
- US server for American users (America/New_York)
- EU server for European users (Europe/London)
- Asia server for Asian users (Asia/Tokyo)
- Each server has appropriate local time for better log readability

### Use Case 6: Troubleshoot Log Timestamp Issues

Scenario: Logs from multiple servers show different times

Step 1: Check each server's time
ssh server1 "timedatectl"
ssh server2 "timedatectl"
ssh server3 "timedatectl"

Step 2: Check NTP synchronization status
ssh server1 "timedatectl | grep 'synchronized'"

Step 3: Fix servers with wrong time
ssh server1 "sudo timedatectl set-ntp true"

Step 4: Standardize timezone (optional)
# Set all servers to UTC for consistency
ssh server1 "sudo timedatectl set-timezone UTC"
ssh server2 "sudo timedatectl set-timezone UTC"
ssh server3 "sudo timedatectl set-timezone UTC"

Real-Life Example:
- Investigating security incident across multiple servers
- Server1 logs: 10:00 AM EST
- Server2 logs: 07:00 AM PST
- Server3 logs: 15:00 PM UTC
- Solution: Standardize all to UTC for easier correlation

### Use Case 7: Dual-Boot System (Linux + Windows)

Scenario: System dual-boots with Windows, need to adjust RTC settings

Problem:
- Linux expects hardware clock in UTC
- Windows expects hardware clock in local time
- Causes time discrepancy when switching OS

Solution for Linux (recommended):
# Make Linux use local time for RTC (match Windows)
timedatectl set-local-rtc 1

# Verify
timedatectl | grep "RTC in local TZ"

Alternative Solution (Windows):
# Configure Windows to use UTC (requires registry edit)
# Recommended for servers, not typical for desktops

Revert to UTC (best practice for Linux-only):
timedatectl set-local-rtc 0

Real-Life Example:
- Developer workstation with Windows for Office apps
- Linux for development work
- Time changes by timezone offset every reboot
- Configure RTC to use local time for consistency

### Use Case 8: Virtual Machine Time Sync

Scenario: VM time drifts due to host-guest sync issues

Step 1: Disable NTP temporarily
timedatectl set-ntp false

Step 2: Disable VMware Tools time sync (if using VMware)
sudo vmware-toolbox-cmd timesync disable

Step 3: Enable NTP for accurate time
sudo systemctl start chronyd
sudo systemctl enable chronyd
timedatectl set-ntp true

Step 4: Verify
timedatectl
chronyc sources

Real-Life Example:
- VMware guest time drifts by minutes
- Conflict between VMware Tools time sync and NTP
- Disable one, use the other (prefer NTP)
- Ensures consistent, accurate time

---

## 6. Real-Life Examples & Scenarios

### Scenario 1: New Server Deployment Checklist

Task: Configure time settings for new production server

Complete Setup Script:
#!/bin/bash
# Server Time Configuration Script

echo "=== Starting Time Configuration ==="

# Step 1: Check current time settings
echo "Current time settings:"
timedatectl

# Step 2: Install chronyd for time sync
echo "Installing chronyd..."
sudo dnf install -y chrony

# Step 3: Start and enable chronyd
echo "Starting chronyd service..."
sudo systemctl start chronyd
sudo systemctl enable chronyd

# Step 4: Set correct timezone
echo "Setting timezone to America/New_York..."
sudo timedatectl set-timezone "America/New_York"

# Step 5: Enable NTP synchronization
echo "Enabling NTP synchronization..."
sudo timedatectl set-ntp true

# Step 6: Wait for sync
sleep 5

# Step 7: Verify configuration
echo "=== Final Configuration ==="
timedatectl
echo ""
echo "=== Chrony Status ==="
chronyc tracking
echo ""
echo "=== NTP Sources ==="
chronyc sources

echo "=== Time Configuration Complete ==="

Usage:
chmod +x setup_time.sh
sudo ./setup_time.sh

Real-Life Application:
- Infrastructure team deploys 50 new servers
- Run this script on each server
- Ensures consistent time configuration
- Part of server provisioning automation

### Scenario 2: Multi-Region Application Deployment

Task: Configure servers in different geographic regions

US East Server (Virginia):
timedatectl set-timezone "America/New_York"
timedatectl set-ntp true

US West Server (Oregon):
timedatectl set-timezone "America/Los_Angeles"
timedatectl set-ntp true

Europe Server (Ireland):
timedatectl set-timezone "Europe/Dublin"
timedatectl set-ntp true

Asia Server (Tokyo):
timedatectl set-timezone "Asia/Tokyo"
timedatectl set-ntp true

Verification Script:
#!/bin/bash
# Check time across all regions

servers=(
    "us-east-server"
    "us-west-server"
    "eu-server"
    "asia-server"
)

for server in "${servers[@]}"; do
    echo "=== $server ==="
    ssh $server "timedatectl | grep -E 'Local time|Time zone|synchronized'"
    echo ""
done

Real-Life Application:
- Global SaaS application
- Users in different regions
- Logs show local time for easier debugging
- All clocks synced with NTP for consistency
- Compliance with local regulations (GDPR, etc.)

### Scenario 3: Fixing Time Drift Issues

Problem: Database replication failing due to time mismatch

Investigation:
# Primary Database Server
ssh db-primary "timedatectl"
Output:
               Local time: Mon 2025-11-24 10:30:45 EST
System clock synchronized: no
              NTP service: inactive

# Replica Database Server
ssh db-replica "timedatectl"
Output:
               Local time: Mon 2025-11-24 10:25:12 EST
System clock synchronized: yes
              NTP service: active

Problem Identified:
- Primary server: Time is 10:30:45, NTP disabled
- Replica server: Time is 10:25:12, NTP enabled
- Time difference: 5 minutes 33 seconds
- Replication requires synchronized clocks

Solution:
# On Primary Server
ssh db-primary "sudo timedatectl set-ntp true"
ssh db-primary "sudo systemctl restart chronyd"

# Wait for sync
sleep 10

# Verify both servers
ssh db-primary "timedatectl | grep 'synchronized\|Local time'"
ssh db-replica "timedatectl | grep 'synchronized\|Local time'"

# Restart replication
ssh db-replica "sudo systemctl restart mysql"

Real-Life Impact:
- Replication was failing for 2 hours
- Data inconsistency between primary and replica
- Fixed by enabling NTP on primary
- Replication resumed automatically

### Scenario 4: Compliance Audit Requirements

Task: Prove all servers maintain accurate time for audit

Audit Requirements:
- All servers must sync with NTP
- Time drift must be less than 1 second
- Timezone must be documented
- Configuration must be persistent

Compliance Check Script:
#!/bin/bash
# Time Configuration Audit Script

output_file="time_audit_$(date +%Y%m%d).txt"

echo "=== Server Time Audit Report ===" > $output_file
echo "Generated: $(date)" >> $output_file
echo "" >> $output_file

servers=$(cat /etc/ansible/hosts | grep -v "#" | grep -v "^\[")

for server in $servers; do
    echo "Server: $server" >> $output_file
    
    # Get timedatectl output
    ssh $server "timedatectl" >> $output_file 2>&1
    
    # Check NTP sync status
    ntp_status=$(ssh $server "timedatectl | grep 'NTP service' | awk '{print \$3}'")
    sync_status=$(ssh $server "timedatectl | grep 'synchronized' | awk '{print \$4}'")
    
    if [ "$ntp_status" = "active" ] && [ "$sync_status" = "yes" ]; then
        echo "Status: PASS âœ“" >> $output_file
    else
        echo "Status: FAIL âœ—" >> $output_file
        echo "ACTION REQUIRED!" >> $output_file
    fi
    
    echo "---" >> $output_file
    echo "" >> $output_file
done

echo "=== Audit Summary ===" >> $output_file
total=$(echo "$servers" | wc -l)
passed=$(grep "PASS" $output_file | wc -l)
failed=$(grep "FAIL" $output_file | wc -l)

echo "Total Servers: $total" >> $output_file
echo "Passed: $passed" >> $output_file
echo "Failed: $failed" >> $output_file

echo "Audit report saved to: $output_file"

Real-Life Application:
- Annual security audit
- Auditor requires proof of time synchronization
- Script generates report for all 200+ servers
- Identifies non-compliant servers for remediation

### Scenario 5: Docker Container Time Issues

Problem: Docker containers showing wrong time

Investigation:
# Check host time
timedatectl

# Check container time
docker exec myapp date

# Container inherits host timezone by default
docker inspect myapp | grep -A 10 "Mounts" | grep "/etc/localtime"

Solution 1: Fix host time
sudo timedatectl set-timezone "America/New_York"
sudo timedatectl set-ntp true

# Restart containers to inherit new timezone
docker restart myapp

Solution 2: Mount timezone in container
docker run -d \
  --name myapp \
  -v /etc/localtime:/etc/localtime:ro \
  -v /etc/timezone:/etc/timezone:ro \
  myapp:latest

Solution 3: Set timezone in Dockerfile
FROM ubuntu:22.04

# Set timezone
ENV TZ=America/New_York
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

Solution 4: Docker Compose
version: '3.8'
services:
  myapp:
    image: myapp:latest
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
    environment:
      - TZ=America/New_York

Real-Life Example:
- Web application running in Docker
- Log timestamps are in UTC, expected EST
- Users complain timestamps don't match local time
- Fixed by setting timezone in container

### Scenario 6: Kubernetes Cluster Time Sync

Problem: Pods on different nodes have different times

Investigation:
# Check each node's time
kubectl get nodes -o wide
for node in $(kubectl get nodes -o name); do
    echo "=== $node ==="
    kubectl debug $node -it --image=busybox -- date
done

# Check if nodes are syncing time
for node in $(kubectl get nodes -o jsonpath='{.items[*].metadata.name}'); do
    echo "Node: $node"
    ssh $node "timedatectl | grep 'synchronized\|NTP service'"
done

Solution:
# Enable NTP on all nodes
for node in $(kubectl get nodes -o jsonpath='{.items[*].metadata.name}'); do
    echo "Configuring $node..."
    ssh $node "sudo timedatectl set-ntp true"
    ssh $node "sudo systemctl restart chronyd"
done

# Verify synchronization
for node in $(kubectl get nodes -o jsonpath='{.items[*].metadata.name}'); do
    echo "=== $node ==="
    ssh $node "chronyc tracking | grep 'System time'"
done

Real-Life Example:
- Kubernetes cluster with 10 worker nodes
- Some pods logging events at wrong times
- Distributed tracing shows inconsistent timestamps
- Fixed by ensuring all nodes use NTP
- Critical for service mesh and observability

### Scenario 7: Scheduled Job Execution Issues

Problem: Cron jobs running at wrong time

Investigation:
# Check system time
timedatectl

# Check cron daemon
systemctl status crond

# Check specific cron job
crontab -l | grep backup

Example cron:
0 2 * * * /scripts/backup.sh

Expected: Runs at 2:00 AM
Actual: Runs at 7:00 AM

Root Cause Analysis:
# System timezone was changed, but cron wasn't restarted
timedatectl | grep "Time zone"
Output: Time zone: America/Los_Angeles (PST, -0800)

# Cron is still using old timezone (EST)

Solution:
# Restart cron daemon after timezone change
sudo systemctl restart crond

# Verify cron is using correct time
sudo journalctl -u crond | tail -20

# Alternative: Use UTC in crontab
# Edit crontab to use UTC times
# 7 0 * * * /scripts/backup.sh  # 7 AM UTC = 2 AM EST

Real-Life Example:
- Database backup scheduled for 2 AM
- Timezone changed from EST to PST
- Backup now runs at 7 AM (during business hours)
- Causes performance issues
- Fixed by restarting cron daemon

### Scenario 8: Authentication Failures Due to Time Skew

Problem: Kerberos authentication failing

Error Message:
kinit: krb5_get_init_creds: Clock skew too great

Investigation:
# Check local server time
timedatectl

# Check KDC (Kerberos Domain Controller) time
ssh kdc-server "timedatectl"

# Compare times
Local Server: 2025-11-24 10:30:45
KDC Server:   2025-11-24 10:25:12

Time Difference: 5 minutes 33 seconds

Kerberos allows maximum 5 minutes clock skew (default)

Solution:
# Enable NTP on local server
sudo timedatectl set-ntp true

# Force immediate sync with chronyd
sudo chronyc -a makestep

# Verify time is now correct
timedatectl

# Test Kerberos authentication
kinit username@DOMAIN.COM
# Success!

Real-Life Example:
- Users can't login to web application
- Application uses Kerberos SSO
- Server clock was manually set incorrectly
- 5+ minute difference from KDC
- Fixed by enabling NTP, immediate sync
- All users can now login

---

## 7. Troubleshooting

### Problem 1: "Failed to set time" Error

Error:
timedatectl set-time "2025-11-24 10:30:00"
Failed to set time: Automatic time synchronization is enabled

Cause:
NTP synchronization is enabled, preventing manual time changes

Solution:
# Disable NTP temporarily
timedatectl set-ntp false

# Now set time manually
timedatectl set-time "2025-11-24 10:30:00"

# Re-enable NTP (recommended)
timedatectl set-ntp true

### Problem 2: NTP Not Synchronizing

Symptom:
timedatectl
System clock synchronized: no
              NTP service: active

Troubleshooting Steps:

Step 1: Check if chronyd/ntpd is actually running
systemctl status chronyd
systemctl status ntpd

Step 2: Check NTP sources
chronyc sources
# or
ntpq -p

Step 3: Check firewall (NTP uses UDP port 123)
sudo firewall-cmd --list-all | grep ntp
sudo firewall-cmd --add-service=ntp --permanent
sudo firewall-cmd --reload

Step 4: Check network connectivity to NTP servers
ping -c 3 pool.ntp.org

Step 5: Force sync
sudo chronyc -a makestep

Step 6: Check chronyd logs
sudo journalctl -u chronyd -n 50

Common Issues:
- Firewall blocking UDP 123
- NTP servers unreachable
- Wrong NTP server configuration
- SELinux blocking chronyd
- Clock difference too large (>1000 seconds)

### Problem 3: Timezone Not Changing

Error:
timedatectl set-timezone "America/New_York"
# No error, but timezone doesn't change

Troubleshooting:

Step 1: Check if timezone exists
timedatectl list-timezones | grep "America/New_York"

Step 2: Check permissions
ls -l /etc/localtime
# Should be writable by root

Step 3: Manually create symlink
sudo rm /etc/localtime
sudo ln -s /usr/share/zoneinfo/America/New_York /etc/localtime

Step 4: Verify
timedatectl

Step 5: If still not working, check for immutable flag
lsattr /etc/localtime
# If shows 'i' flag, remove it
sudo chattr -i /etc/localtime

### Problem 4: Hardware Clock Out of Sync

Symptom:
System time correct, but after reboot time is wrong

Investigation:
# Check RTC time
timedatectl | grep "RTC time"

# Compare with system time
timedatectl | grep -E "Local time|RTC time"

Solution:
# Ensure RTC is set to UTC
timedatectl set-local-rtc 0

# Sync hardware clock (automatic with timedatectl)
# Or manually with hwclock
sudo hwclock --systohc

# Verify
timedatectl

### Problem 5: Permission Denied Errors

Error:
timedatectl set-time "2025-11-24 10:30:00"
Failed to set time: Access denied

Cause:
Not running as root or sudo

Solution:
sudo timedatectl set-time "2025-11-24 10:30:00"

### Problem 6: Time Jumps After NTP Enable

Symptom:
Enabled NTP, time suddenly jumped by hours

Explanation:
This is normal if system time was very wrong
NTP corrected it to accurate time

Concerns:
- Running applications may be affected
- Logs may have timestamp gaps
- Scheduled jobs might execute immediately

Prevention:
# Before enabling NTP on critical systems
# 1. Check current time
date

# 2. Check what NTP will set it to
chronyd -Q 'server pool.ntp.org iburst'

# 3. If large difference, schedule maintenance window
# 4. Warn application teams
# 5. Then enable NTP
timedatectl set-ntp true

### Problem 7: Slow NTP Convergence

Symptom:
NTP enabled but time still not accurate after 30 minutes

Investigation:
chronyc tracking
Output:
System time     : 120.523 seconds fast of NTP time

Explanation:
chronyd adjusts time gradually to avoid time jumps
May take hours to correct large differences

Solution (force immediate correction):
# Force step adjustment (caution: may disrupt services)
sudo chronyc -a makestep

# Verify
chronyc tracking

### Problem 8: VM Time Sync Conflicts

Symptom:
Time keeps changing on virtual machine

Cause:
Conflict between VM tools time sync and NTP

Solution:

For VMware:
# Disable VMware Tools time sync
sudo vmware-toolbox-cmd timesync disable

# Verify
sudo vmware-toolbox-cmd timesync status

# Enable NTP instead
sudo timedatectl set-ntp true

For Hyper-V:
# Disable Hyper-V time sync
# On Hyper-V host PowerShell:
Get-VMIntegrationService -VMName "YourVM" -Name "Time Synchronization" | Disable-VMIntegrationService

For AWS EC2:
# EC2 uses chrony by default
# Ensure chrony is configured
sudo systemctl status chronyd

Best Practice:
Use one time sync method (prefer NTP)
Disable hypervisor time sync
Exception: Use hypervisor sync for Windows guests

---

## 8. Best Practices

### Best Practice 1: Always Use NTP
# Enable NTP on all servers
timedatectl set-ntp true

Why:
âœ… Prevents time drift
âœ… Ensures consistency across infrastructure
âœ… Required for distributed systems
âœ… Critical for security (authentication, certificates)
âœ… Necessary for log correlation

### Best Practice 2: Use UTC for Server Timezone
# Set all servers to UTC
timedatectl set-timezone UTC

Why:
âœ… No daylight saving time confusion
âœ… Easier log correlation across regions
âœ… Standard for cloud infrastructure
âœ… Convert to local time in application layer
âœ… Avoids twice-a-year time jumps

Exception:
Use local timezone if:
- Single-region application
- Business requirements dictate
- Legacy application limitations

### Best Practice 3: Monitor Time Sync Status
# Create monitoring check
#!/bin/bash
# check_time_sync.sh

ntp_status=$(timedatectl | grep "NTP service" | awk '{print $3}')
sync_status=$(timedatectl | grep "synchronized" | awk '{print $4}')

if [ "$ntp_status" != "active" ] || [ "$sync_status" != "yes" ]; then
    echo "CRITICAL: Time not synchronized!"
    exit 2
else
    echo "OK: Time is synchronized"
    exit 0
fi

# Add to Nagios/Icinga/Zabbix
# Run every 5 minutes

### Best Practice 4: Document Time Configuration
# Create time configuration document for each server

Server: web-server-01
Timezone: America/New_York
NTP Enabled: Yes
NTP Server: pool.ntp.org, time.google.com
RTC Mode: UTC
Last Verified: 2025-11-24

### Best Practice 5: Test Time Changes in Non-Prod First
# Never change production time without testing

# Test in development
dev$ timedatectl set-timezone "America/Chicago"
dev$ # Test applications, monitor logs

# Test in staging
staging$ timedatectl set-timezone "America/Chicago"
staging$ # Full integration testing

# Then production (during maintenance window)
prod$ timedatectl set-timezone "America/Chicago"

### Best Practice 6: Use Reliable NTP Sources
# Configure multiple NTP servers for redundancy

Edit /etc/chrony.conf:
# Public NTP pools
server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst
server 3.pool.ntp.org iburst

# Or use cloud provider NTP (preferred for cloud VMs)
# AWS
server 169.254.169.123 prefer iburst
# Google Cloud
server metadata.google.internal prefer iburst
# Azure
server time.windows.com prefer iburst

### Best Practice 7: Restart Services After Time Change
# Services that may need restart after time change:

sudo systemctl restart crond      # Cron daemon
sudo systemctl restart rsyslog    # Syslog
sudo systemctl restart httpd      # Web server
sudo systemctl restart mysqld     # Database

# Or reboot for major time changes
sudo reboot

### Best Practice 8: Regular Time Audits
# Monthly audit script
#!/bin/bash
# monthly_time_audit.sh

echo "=== Monthly Time Configuration Audit ==="
echo "Date: $(date)"
echo ""

echo "=== Current Time Settings ==="
timedatectl
echo ""

echo "=== NTP Sources ==="
chronyc sources -v
echo ""

echo "=== Time Drift ==="
chronyc tracking | grep "System time"
echo ""

echo "=== Service Status ==="
systemctl status chronyd --no-pager
echo ""

echo "=== Recent Time Changes ==="
journalctl -u chronyd --since "30 days ago" | grep -i "step\|adjust"

# Email report to admins
mail -s "Monthly Time Audit - $(hostname)" sysadmin@company.com < audit_report.txt

---

## 9. Quick Reference

### Common Commands Cheatsheet

# View current time/date/timezone
timedatectl

# List all available timezones
timedatectl list-timezones

# Search for specific timezone
timedatectl list-timezones | grep America

# Set timezone
timedatectl set-timezone "America/New_York"

# Set date only
timedatectl set-time "2025-11-24"

# Set time only
timedatectl set-time "14:30:00"

# Set date and time
timedatectl set-time "2025-11-24 14:30:00"

# Enable NTP synchronization
timedatectl set-ntp true

# Disable NTP synchronization
timedatectl set-ntp false

# Set RTC to local time (for dual-boot)
timedatectl set-local-rtc 1

# Set RTC to UTC (recommended)
timedatectl set-local-rtc 0

### Time Synchronization Commands

# Check chronyd status
systemctl status chronyd

# Start chronyd
systemctl start chronyd

# Enable chronyd at boot
systemctl enable chronyd

# Restart chronyd
systemctl restart chronyd

# Check NTP sources
chronyc sources
chronyc sources -v

# Check synchronization status
chronyc tracking

# Force immediate time sync
chronyc -a makestep

# View chronyd logs
journalctl -u chronyd -f

### Troubleshooting Commands

# Check time-related services
systemctl list-units | grep -E "time|chrony|ntp"

# Check firewall for NTP
firewall-cmd --list-all | grep ntp

# Add NTP to firewall
firewall-cmd --add-service=ntp --permanent
firewall-cmd --reload

# Test NTP server connectivity
chronyc -n activity
ntpdate -q pool.ntp.org

# View hardware clock
hwclock --show

# Sync hardware clock to system time
hwclock --systohc

# Sync system time to hardware clock
hwclock --hctosys

---

## 10. Comparison Table

| Feature | date (old) | timedatectl (new) |
|---------|------------|-------------------|
| Set date/time | âœ… date -s | âœ… timedatectl set-time |
| View time | âœ… date | âœ… timedatectl |
| Set timezone | âŒ Manual symlink | âœ… timedatectl set-timezone |
| List timezones | âŒ Manual browse | âœ… timedatectl list-timezones |
| NTP control | âŒ Separate service | âœ… timedatectl set-ntp |
| Hardware clock sync | âŒ Manual hwclock | âœ… Automatic |
| Systemd integration | âŒ No | âœ… Yes |
| Service notification | âŒ No | âœ… Yes |
| Persistent changes | âš ï¸ Manual | âœ… Automatic |
| User-friendly | âš ï¸ Complex | âœ… Simple |

---

## 11. Summary

### Key Takeaways

1. timedatectl is the modern way to manage time on RHEL/CentOS 7+
2. Replaces old tools: date, hwclock, manual timezone management
3. Integrated with systemd for better service management
4. Always enable NTP for accurate time synchronization
5. Use UTC timezone for servers (convert in application layer)
6. Test time changes in non-production first
7. Monitor time synchronization status continuously
8. Document time configuration for audit purposes

### When to Use timedatectl

âœ… Check current date/time/timezone
âœ… Set system time manually
âœ… Change timezone
âœ… Enable/disable NTP synchronization
âœ… Verify time sync status
âœ… Initial server configuration
âœ… Troubleshooting time-related issues
âœ… Compliance and audit requirements

### Critical for These Services

ðŸ” Kerberos authentication (requires <5 min time difference)
ðŸ” SSL/TLS certificates (time-based validation)
ðŸ” Two-factor authentication (TOTP tokens)
ðŸ“Š Distributed logging and monitoring
ðŸ“Š Database replication
ðŸ“Š Distributed transactions
ðŸ“Š Microservices communication
ðŸ“Š Container orchestration (Kubernetes)
ðŸ“Š Cloud services synchronization

---

## Author Information
Created by: Imran Afzal
Website: www.utclisolutions.com

For more Linux tutorials and DevOps guides, visit the website!
