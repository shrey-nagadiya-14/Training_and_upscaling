# FTP – File Transfer Protocol - Complete Guide

## Table of Contents
1. [What is FTP?](#what-is-ftp)
2. [How FTP Works](#how-ftp-works)
3. [FTP Architecture](#ftp-architecture)
4. [FTP Installation & Configuration](#ftp-installation-configuration)
5. [FTP Commands](#ftp-commands)
6. [FTP vs SFTP vs FTPS](#ftp-vs-sftp-vs-ftps)
7. [Daily Use Cases](#daily-use-cases)
8. [Real-Life Examples](#real-life-examples)
9. [Security Considerations](#security-considerations)
10. [Troubleshooting](#troubleshooting)

---

## 1. What is FTP?

### Definition
**FTP (File Transfer Protocol)** is a standard network protocol used for the transfer of computer files between a client and server on a computer network. FTP is built on a client-server model architecture using separate control and data connections between the client and the server.

### Key Characteristics
- Protocol: Application Layer Protocol (Layer 7 of OSI Model)
- Default Port: Port 21 (Control Connection)
- Data Port: Port 20 (Active Mode) or Dynamic Ports (Passive Mode)
- Architecture: Client-Server Model
- Transport Protocol: TCP (Transmission Control Protocol)
- Authentication: Username and Password (or Anonymous)
- Standard: RFC 959 (defined in 1985)

### FTP Components
1. **FTP Server**: Hosts files and accepts connections from clients
2. **FTP Client**: Connects to server to upload/download files
3. **Control Connection**: Port 21 - for commands and responses
4. **Data Connection**: Port 20 or dynamic - for actual file transfer

### Purpose
- Transfer files between computers over a network
- Upload files to web servers
- Download files from remote servers
- Share large files
- Backup and restore data
- Remote file management

---

## 2. How FTP Works

### FTP Connection Process

Step 1: Client Initiates Connection
- Client sends connection request to FTP server on port 21
- TCP three-way handshake established

Step 2: Authentication
- Server prompts for username and password
- Client provides credentials
- Server validates and grants access

Step 3: Command/Control Channel Established
- Client sends commands (LIST, GET, PUT, etc.)
- Server responds with status codes

Step 4: Data Connection Established
- Separate connection for actual data transfer
- Can be Active or Passive mode

Step 5: File Transfer
- Files transferred through data connection
- Progress displayed to user

Step 6: Connection Termination
- Client sends QUIT command
- Both connections closed

### FTP Connection Modes

#### Active Mode (PORT)
┌─────────┐                           ┌─────────┐
│ Client  │                           │ Server  │
│         │──── Port 21 (Control) ────▶│         │
│  Port   │                           │ Port 21 │
│ >1023   │◀─── Port 20 (Data) ───────│ Port 20 │
└─────────┘                           └─────────┘

Flow:
1. Client connects to server port 21 (control)
2. Client opens random port >1023 and tells server via PORT command
3. Server initiates data connection from port 20 to client's port

Problem: Firewall on client side may block incoming connection from server

#### Passive Mode (PASV)
┌─────────┐                           ┌─────────┐
│ Client  │                           │ Server  │
│         │──── Port 21 (Control) ────▶│         │
│  Port   │                           │ Port 21 │
│ >1023   │──── Random Port (Data) ───▶│ >1023   │
└─────────┘                           └─────────┘

Flow:
1. Client connects to server port 21 (control)
2. Client sends PASV command
3. Server opens random port >1023 and tells client
4. Client initiates data connection to that port

Solution: Client initiates both connections, works better with firewalls

### FTP Response Codes

| Code | Meaning | Example |
|------|---------|---------|
| 1xx | Preliminary positive reply | 150 File status okay |
| 2xx | Positive completion reply | 200 Command okay, 226 Transfer complete |
| 3xx | Positive intermediate reply | 331 Username okay, need password |
| 4xx | Transient negative completion | 421 Service not available |
| 5xx | Permanent negative completion | 530 Login incorrect |

Common Response Codes:
- 150: File status okay; about to open data connection
- 200: Command okay
- 220: Service ready for new user
- 221: Service closing control connection
- 226: Closing data connection; file transfer successful
- 230: User logged in, proceed
- 331: Username okay, need password
- 425: Can't open data connection
- 426: Connection closed; transfer aborted
- 530: Not logged in
- 550: File not found or no permission

---

## 3. FTP Architecture

### Client-Server Model

┌─────────────────────────────────────────────────────────────┐
│                      FTP ARCHITECTURE                        │
└─────────────────────────────────────────────────────────────┘

CLIENT SIDE                              SERVER SIDE
┌──────────────┐                        ┌──────────────┐
│              │                        │              │
│  FTP Client  │                        │  FTP Server  │
│  Software    │                        │  (vsftpd)    │
│              │                        │              │
│  - FileZilla │                        │  - Listens   │
│  - WinSCP    │                        │    on Port21 │
│  - CLI ftp   │                        │  - Manages   │
│  - Cyberduck │                        │    Users     │
│              │                        │  - Serves    │
└──────┬───────┘                        └──────┬───────┘
       │                                       │
       │  ┌─────────────────────────┐         │
       └──│ Control Connection      │─────────┘
          │ Port 21                 │
          │ Commands & Responses    │
          └─────────────────────────┘
       │                                       │
       │  ┌─────────────────────────┐         │
       └──│ Data Connection         │─────────┘
          │ Port 20 or Dynamic      │
          │ File Transfer           │
          └─────────────────────────┘

### Two-Machine Setup (From Your Screenshot)

Machine 1: Client = MyFirstLinuxVM
- Role: FTP Client
- Software: ftp command-line tool
- Function: Upload/Download files
- User: iafzal

Machine 2: Server = LinuxCentOS7
- Role: FTP Server
- Software: vsftpd (Very Secure FTP Daemon)
- Function: Host files and serve clients
- Port: 21 (ftpd = 21)
- IP: 192.168.1.x (example from diagram)

---

## 4. FTP Installation & Configuration

### SERVER SETUP (LinuxCentOS7 / RHEL / CentOS)

#### Step 1: Become Root
# Switch to root user
sudo su -
# Or use sudo for each command

#### Step 2: Check if FTP is Installed
# Check if vsftpd is installed
rpm -qa | grep ftp

# Check if package is available
yum search vsftpd

# Check if FTP port is listening
netstat -tuln | grep :21
# Or
ss -tuln | grep :21

#### Step 3: Test Network Connectivity
# Ensure network is working
ping www.google.com

# If ping fails, check network configuration
ip addr show
ip route show

#### Step 4: Install vsftpd
# Install vsftpd package
yum install vsftpd -y

# Verify installation
rpm -qa | grep vsftpd
# Output: vsftpd-3.0.2-25.el7.x86_64

# Check vsftpd version
vsftpd -v
# Output: vsftpd: version 3.0.2

#### Step 5: Backup Original Configuration
# IMPORTANT: Always backup before editing
cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.backup

# Verify backup
ls -l /etc/vsftpd/vsftpd.conf*
# Output:
# -rw-------. 1 root root 5030 Mar 22  2017 /etc/vsftpd/vsftpd.conf
# -rw-------. 1 root root 5030 Nov 21  2025 /etc/vsftpd/vsftpd.conf.backup

#### Step 6: Edit Configuration File
# Open configuration file
vi /etc/vsftpd/vsftpd.conf

#### Configuration Changes Required

CHANGE 1: Disable Anonymous Login
# Find this line (around line 12):
anonymous_enable=YES

# Change to:
anonymous_enable=NO

Why? Security - prevent anonymous users from accessing files

CHANGE 2: Enable ASCII Upload
# Find this line (around line 82-83):
#ascii_upload_enable=YES

# Uncomment (remove #):
ascii_upload_enable=YES

Why? Allow text file uploads

CHANGE 3: Enable ASCII Download
# Find this line (around line 84-85):
#ascii_download_enable=YES

# Uncomment (remove #):
ascii_download_enable=YES

Why? Allow text file downloads

CHANGE 4: Set Welcome Banner (Optional)
# Find this line (around line 105):
#ftpd_banner=Welcome to blah FTP service.

# Uncomment and customize:
ftpd_banner=Welcome to UNIXMEN FTP service.

Why? Professional appearance, inform users

CHANGE 5: Add Local Time Setting
# Add at the END of the file:
use_localtime=YES

Why? Display correct timestamps in local timezone

#### Complete vsftpd.conf Key Settings

# Anonymous access (set to NO for security)
anonymous_enable=NO

# Allow local users to login
local_enable=YES

# Enable write commands
write_enable=YES

# Default umask for local users
local_umask=022

# Activate directory messages
dirmessage_enable=YES

# Log file transfers
xferlog_enable=YES

# Use port 20 for data connections
connect_from_port_20=YES

# ASCII transfer settings
ascii_upload_enable=YES
ascii_download_enable=YES

# Chroot local users (jail them in home directory)
chroot_local_user=YES
allow_writeable_chroot=YES

# Welcome banner
ftpd_banner=Welcome to UNIXMEN FTP service.

# Use local time
use_localtime=YES

# Passive mode settings (if needed)
pasv_enable=YES
pasv_min_port=10000
pasv_max_port=10100

# Limit connections
max_clients=50
max_per_ip=5

# Security settings
ssl_enable=NO  # Set to YES for FTPS
listen=YES
listen_ipv6=NO

#### Step 7: Start and Enable vsftpd Service
# Start vsftpd service
systemctl start vsftpd

# Check service status
systemctl status vsftpd
# Output:
# ● vsftpd.service - Vsftpd ftp daemon
#    Loaded: loaded (/usr/lib/systemd/system/vsftpd.service; enabled)
#    Active: active (running) since Fri 2025-11-21 10:00:00 UTC

# Enable vsftpd to start on boot
systemctl enable vsftpd

# Verify it's enabled
systemctl is-enabled vsftpd
# Output: enabled

#### Step 8: Configure Firewall
# Check firewall status
systemctl status firewalld

# Stop firewall (for testing only - NOT recommended for production)
systemctl stop firewalld

# Disable firewall (for testing only - NOT recommended for production)
systemctl disable firewalld

# BETTER APPROACH: Open FTP ports in firewall
firewall-cmd --permanent --add-service=ftp
firewall-cmd --permanent --add-port=21/tcp
firewall-cmd --permanent --add-port=20/tcp

# For passive mode, open port range
firewall-cmd --permanent --add-port=10000-10100/tcp

# Reload firewall
firewall-cmd --reload

# Verify rules
firewall-cmd --list-all

#### Step 9: Configure SELinux (if enabled)
# Check SELinux status
sestatus
# Or
getenforce

# Allow FTP home directory access
setsebool -P ftp_home_dir on

# Allow FTP full access
setsebool -P allow_ftpd_full_access on

# Verify SELinux booleans
getsebool -a | grep ftp

#### Step 10: Create FTP User
# Create a new user for FTP access
useradd iafzal

# Set password for the user
passwd iafzal
# Enter password when prompted
# Example: Password123!

# Verify user created
id iafzal
# Output: uid=1001(iafzal) gid=1001(iafzal) groups=1001(iafzal)

# Check user's home directory
ls -ld /home/iafzal
# Output: drwx------. 2 iafzal iafzal 62 Nov 21 10:00 /home/iafzal

# Optionally, create FTP-only user (no shell access)
useradd -s /sbin/nologin ftpuser
passwd ftpuser

#### Step 11: Test FTP Server Locally
# Test from server itself
ftp localhost
# Or
ftp 127.0.0.1

# Enter username and password
# Try commands: ls, pwd, bye

# Check FTP port is listening
netstat -tuln | grep :21
# Output: tcp6       0      0 :::21                   :::*                    LISTEN

# Or using ss
ss -tuln | grep :21

#### Step 12: Find Server IP Address
# Check IP address
ip addr show
# Look for inet address (e.g., 192.168.1.100)

# Or simpler
hostname -I

# Or
ifconfig | grep "inet "

---

### CLIENT SETUP (MyFirstLinuxVM / Any Linux)

#### Step 1: Become Root
# Switch to root user
sudo su -

#### Step 2: Install FTP Client
# Install ftp client package
yum install ftp -y

# For Ubuntu/Debian:
apt-get update
apt-get install ftp -y

# Verify installation
which ftp
# Output: /usr/bin/ftp

# Check ftp version
ftp --version

#### Step 3: Switch to Regular User
# Switch to user account
su - iafzal

# Or if already logged in as user, stay as user
# FTP doesn't require root to connect

#### Step 4: Create Test File
# Create a test file to upload
touch kruger

# Add some content
echo "This is a test file for FTP upload" > kruger

# Verify file created
ls -l kruger
# Output: -rw-rw-r--. 1 iafzal iafzal 35 Nov 21 10:30 kruger

# Check file content
cat kruger

---

## 5. FTP Commands

### Connecting to FTP Server

#### Method 1: Interactive Connection
# Connect to FTP server by IP
ftp 192.168.1.x

# Or by hostname
ftp server.example.com

# System prompts:
Connected to 192.168.1.x.
220 Welcome to UNIXMEN FTP service.
Name (192.168.1.x:user): iafzal
331 Please specify the password.
Password: [enter password]
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp>

#### Method 2: Command Line with Username
# Connect with username specified
ftp iafzal@192.168.1.x

# Or
ftp -u iafzal 192.168.1.x

#### Method 3: Non-Interactive (Scripting)
# Create .netrc file for automated login
vi ~/.netrc

# Add content:
machine 192.168.1.x
login iafzal
password YourPassword123

# Secure the file
chmod 600 ~/.netrc

# Now connect without prompts
ftp 192.168.1.x

### FTP Command Reference

#### Navigation Commands

Command: pwd
Description: Print working directory (current directory on server)
Example:
ftp> pwd
257 "/home/iafzal" is the current directory

Command: lpwd
Description: Print local working directory (current directory on client)
Example:
ftp> lpwd
Local directory: /home/iafzal

Command: cd [directory]
Description: Change directory on server
Example:
ftp> cd documents
250 Directory successfully changed.

Command: lcd [directory]
Description: Change local directory on client
Example:
ftp> lcd /tmp
Local directory now: /tmp

Command: ls
Description: List files in current server directory
Example:
ftp> ls
227 Entering Passive Mode (192,168,1,100,39,16).
150 Here comes the directory listing.
-rw-r--r--    1 1001     1001           35 Nov 21 10:30 kruger
drwxr-xr-x    2 1001     1001         4096 Nov 21 10:00 documents
226 Directory send OK.

Command: ls -la
Description: List files with detailed information
Example:
ftp> ls -la
227 Entering Passive Mode (192,168,1,100,39,17).
150 Here comes the directory listing.
drwxr-xr-x    3 1001     1001         4096 Nov 21 10:30 .
drwxr-xr-x    3 0        0            4096 Nov 21 09:00 ..
-rw-------    1 1001     1001           18 Nov 21 10:00 .bash_logout
-rw-r--r--    1 1001     1001           35 Nov 21 10:30 kruger
226 Directory send OK.

Command: !ls
Description: List files in current local directory
Example:
ftp> !ls
kruger  test.txt  documents

Command: dir
Description: List directory contents (similar to ls but more detailed)
Example:
ftp> dir
227 Entering Passive Mode (192,168,1,100,39,18).
150 Here comes the directory listing.
-rw-r--r--    1 1001     1001           35 Nov 21 10:30 kruger
226 Directory send OK.

#### File Transfer Commands

Command: put [local-file] [remote-file]
Description: Upload file from client to server
Example:
ftp> put kruger
local: kruger remote: kruger
227 Entering Passive Mode (192,168,1,100,39,19).
150 Ok to send data.
226 Transfer complete.
35 bytes sent in 0.00 secs (350.00 Kbytes/sec)

Command: mput [files]
Description: Upload multiple files
Example:
ftp> mput *.txt
mput file1.txt [y/n]? y
227 Entering Passive Mode (192,168,1,100,39,20).
150 Ok to send data.
226 Transfer complete.
mput file2.txt [y/n]? y
227 Entering Passive Mode (192,168,1,100,39,21).
150 Ok to send data.
226 Transfer complete.

Command: get [remote-file] [local-file]
Description: Download file from server to client
Example:
ftp> get kruger
local: kruger remote: kruger
227 Entering Passive Mode (192,168,1,100,39,22).
150 Opening BINARY mode data connection for kruger (35 bytes).
226 Transfer complete.
35 bytes received in 0.00 secs (350.00 Kbytes/sec)

Command: mget [files]
Description: Download multiple files
Example:
ftp> mget *.pdf
mget report1.pdf [y/n]? y
227 Entering Passive Mode (192,168,1,100,39,23).
150 Opening BINARY mode data connection for report1.pdf.
226 Transfer complete.
mget report2.pdf [y/n]? y
227 Entering Passive Mode (192,168,1,100,39,24).
150 Opening BINARY mode data connection for report2.pdf.
226 Transfer complete.

Command: delete [file]
Description: Delete file on server
Example:
ftp> delete oldfile.txt
250 Delete operation successful.

Command: mdelete [files]
Description: Delete multiple files on server
Example:
ftp> mdelete *.tmp
mdelete temp1.tmp [y/n]? y
250 Delete operation successful.
mdelete temp2.tmp [y/n]? y
250 Delete operation successful.

Command: rename [old-name] [new-name]
Description: Rename file on server
Example:
ftp> rename kruger kruger_backup
350 Ready for RNTO.
250 Rename successful.

#### Directory Management Commands

Command: mkdir [directory]
Description: Create directory on server
Example:
ftp> mkdir backups
257 "/home/iafzal/backups" created

Command: rmdir [directory]
Description: Remove directory on server (must be empty)
Example:
ftp> rmdir oldbackups
250 Remove directory operation successful.

#### Transfer Mode Commands

Command: binary
Description: Set transfer mode to binary (for images, executables, archives)
Example:
ftp> binary
200 Switching to Binary mode.

Command: ascii
Description: Set transfer mode to ASCII (for text files)
Example:
ftp> ascii
200 Switching to ASCII mode.

Command: hash
Description: Toggle hash mark printing (# for each data block transferred)
Example:
ftp> hash
Hash mark printing on (1024 bytes/hash mark).
ftp> get largefile.zip
################
226 Transfer complete.

Command: prompt
Description: Toggle interactive prompting for multiple file transfers
Example:
ftp> prompt
Interactive mode off.
ftp> mget *.txt
# Now downloads all .txt files without prompting

#### Information Commands

Command: status
Description: Show current status of FTP connection
Example:
ftp> status
Connected to 192.168.1.x.
Mode: stream; Type: binary; Form: non-print; Structure: file
Verbose: on; Bell: off; Prompting: on; Globbing: on
Store unique: off; Receive unique: off
Case: off; CR stripping: on
Ntrans: off
Nmap: off
Hash mark printing: off; Use of PORT cmds: on

Command: system
Description: Show remote system type
Example:
ftp> system
215 UNIX Type: L8

Command: help [command]
Description: Display help for FTP commands
Example:
ftp> help
Commands may be abbreviated.  Commands are:

!               debug           mdir            qc              site
$               dir             mget            sendport        size
account         disconnect      mkdir           put             status
append          exit            mls             pwd             struct
ascii           form            mode            quit            system
bell            get             modtime         quote           sunique
binary          glob            mput            recv            tenex
bye             hash            newer           reget           trace
case            help            nmap            rstatus         type
cd              idle            nlist           rhelp           user
cdup            image           ntrans          rename          umask
chmod           lcd             open            reset           verbose
close           ls              prompt          restart         ?
cr              macdef          passive         rmdir
delete          mdelete         proxy           runique

Command: size [file]
Description: Show size of file on server
Example:
ftp> size largefile.zip
213 104857600

#### Connection Commands

Command: open [host]
Description: Open connection to FTP server
Example:
ftp> open 192.168.1.x
Connected to 192.168.1.x.

Command: close
Description: Close connection but remain in FTP program
Example:
ftp> close
221 Goodbye.
ftp>

Command: disconnect
Description: Same as close
Example:
ftp> disconnect
221 Goodbye.
ftp>

Command: bye
Description: Exit FTP program (closes connection first)
Example:
ftp> bye
221 Goodbye.
[user@client ~]$

Command: quit
Description: Same as bye
Example:
ftp> quit
221 Goodbye.
[user@client ~]$

Command: user [username]
Description: Send new username to server
Example:
ftp> user admin
331 Please specify the password.
Password:
230 Login successful.

#### Shell Commands

Command: ! [command]
Description: Execute shell command on local machine
Example:
ftp> !pwd
/home/iafzal

ftp> !ls -l
total 12
-rw-rw-r--. 1 iafzal iafzal 35 Nov 21 10:30 kruger

ftp> !date
Fri Nov 21 10:45:00 UTC 2025

### Complete FTP Session Example

# Connect to FTP server
$ ftp 192.168.1.100
Connected to 192.168.1.100.
220 Welcome to UNIXMEN FTP service.
Name (192.168.1.100:iafzal): iafzal
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.

# Check current directory on server
ftp> pwd
257 "/home/iafzal" is the current directory

# List files on server
ftp> ls
227 Entering Passive Mode (192,168,1,100,39,25).
150 Here comes the directory listing.
226 Directory send OK.

# Check local directory
ftp> lpwd
Local directory: /home/iafzal

# Enable hash marks for upload progress
ftp> hash
Hash mark printing on (1024 bytes/hash mark).

# Set binary mode (recommended for all file types)
ftp> binary
200 Switching to Binary mode.

# Upload a file
ftp> put kruger
local: kruger remote: kruger
227 Entering Passive Mode (192,168,1,100,39,26).
150 Ok to send data.
226 Transfer complete.
35 bytes sent in 0.00 secs (350.00 Kbytes/sec)

# Verify file was uploaded
ftp> ls
227 Entering Passive Mode (192,168,1,100,39,27).
150 Here comes the directory listing.
-rw-r--r--    1 1001     1001           35 Nov 21 10:30 kruger
226 Directory send OK.

# Download the file to verify
ftp> get kruger kruger_downloaded
local: kruger_downloaded remote: kruger
227 Entering Passive Mode (192,168,1,100,39,28).
150 Opening BINARY mode data connection for kruger (35 bytes).
226 Transfer complete.
35 bytes received in 0.00 secs (350.00 Kbytes/sec)

# Exit FTP
ftp> bye
221 Goodbye.
$

---

## 6. FTP vs SFTP vs FTPS

### Comparison Table

| Feature | FTP | FTPS | SFTP |
|---------|-----|------|------|
| **Full Name** | File Transfer Protocol | FTP Secure / FTP-SSL | SSH File Transfer Protocol |
| **Security** | No encryption | SSL/TLS encryption | SSH encryption |
| **Port(s)** | 21 (control), 20 (data) | 21 (control), 990 (implicit), various for data | 22 (SSH) |
| **Authentication** | Plain text username/password | Encrypted username/password | SSH keys or password (encrypted) |
| **Firewall Friendly** | No (active mode), Partially (passive mode) | No (similar to FTP) | Yes (single port 22) |
| **Protocol Base** | Custom protocol | FTP + SSL/TLS | SSH protocol |
| **Certificate Required** | No | Yes (SSL/TLS certificate) | No (uses SSH keys) |
| **Data Encryption** | None | Yes | Yes |
| **Command Encryption** | None | Yes | Yes |
| **Best Use Case** | Internal networks only | Public internet with SSL | Public internet, secure transfers |
| **Speed** | Fastest (no encryption overhead) | Medium (encryption overhead) | Medium (encryption overhead) |
| **Configuration Complexity** | Simple | Medium | Medium |
| **Client Software** | ftp, FileZilla, WinSCP | FileZilla, WinSCP | sftp, scp, FileZilla, WinSCP |
| **Standard** | RFC 959 (1985) | RFC 4217 (2005) | SSH File Transfer Protocol |

### Detailed Comparison

#### FTP (File Transfer Protocol)
Pros:
✅ Simple to set up and configure
✅ Fast transfers (no encryption overhead)
✅ Widely supported
✅ Good for internal networks
✅ Low resource usage

Cons:
❌ No encryption - data transmitted in plain text
❌ Passwords transmitted in clear text
❌ Vulnerable to packet sniffing
❌ Vulnerable to man-in-the-middle attacks
❌ Complex firewall configuration (active mode)
❌ Not suitable for public internet

When to Use FTP:
- Internal network transfers only
- Behind VPN or secure network
- Speed is critical and security is less important
- Legacy systems that don't support SFTP/FTPS

Example Use Case:
- Transferring files between servers in a private data center
- Local development environment
- Internal backup systems

#### FTPS (FTP Secure / FTP over SSL/TLS)
Pros:
✅ Encrypted data transmission
✅ Encrypted authentication
✅ Based on proven SSL/TLS technology
✅ Two modes: Explicit and Implicit
✅ Compatible with FTP commands

Cons:
❌ Requires SSL/TLS certificate management
❌ More complex than FTP
❌ Firewall configuration can be challenging
❌ Requires multiple ports
❌ Not all clients support FTPS

When to Use FTPS:
- Need encryption but must use FTP protocol
- Existing FTP infrastructure to upgrade
- Prefer SSL/TLS over SSH
- Certificate-based authentication required

Example Use Case:
- E-commerce file uploads (product catalogs)
- Healthcare data transfer (HIPAA compliance)
- Financial data transfers

FTPS Modes:

Explicit FTPS (FTPES):
- Connects on port 21 (standard FTP port)
- Client requests encryption via AUTH TLS command
- If server supports it, connection is upgraded to encrypted
- Backward compatible with regular FTP clients

Implicit FTPS:
- Connects on port 990
- Encryption required from the start
- No plain text communication at all
- Not backward compatible with regular FTP

#### SFTP (SSH File Transfer Protocol)
Pros:
✅ Strong encryption (SSH-based)
✅ Single port (22) - firewall friendly
✅ Supports SSH key authentication
✅ No certificate management needed
✅ File permission management
✅ Resume interrupted transfers
✅ Directory operations

Cons:
❌ Not compatible with FTP clients (different protocol)
❌ Requires SSH server
❌ Slightly more complex setup than FTP
❌ May be slower than FTP on fast networks

When to Use SFTP:
- Public internet file transfers
- Security is critical
- Need strong authentication
- Want simple firewall configuration
- Modern systems with SSH support

Example Use Case:
- Web hosting file uploads
- Remote server management
- Automated secure backups
- DevOps deployments
- Cloud storage transfers

### Security Comparison

Plain FTP Session (Intercepted):
USER iafzal
PASS MyPassword123
STOR confidential_document.pdf
[All data visible to attacker]

FTPS Session (Intercepted):
[Encrypted gibberish]
ENCRYPTED DATA: 0x4d7f3b9a2c8e1f5d...
[Attacker cannot read data]

SFTP Session (Intercepted):
[Encrypted gibberish]
SSH-2.0-OpenSSH_7.4
[Attacker cannot read data]

### Port Requirements

FTP:
- Port 21: Control/Command channel
- Port 20: Data channel (active mode)
- Random high ports: Data channel (passive mode)
- Firewall rules: Complex, need to open multiple ports

FTPS:
- Port 21: Control (explicit FTPS)
- Port 990: Control (implicit FTPS)
- Port 989: Data (implicit FTPS)
- Random high ports: Data channel (passive mode)
- Firewall rules: Complex, similar to FTP

SFTP:
- Port 22: Everything (control + data)
- Firewall rules: Simple, just open port 22

### Migration Path

Current: FTP (Insecure)
    ↓
Option 1: Upgrade to FTPS
    - Add SSL/TLS to existing FTP
    - Minimal configuration changes
    - Keep familiar FTP commands

Option 2: Switch to SFTP
    - Install/enable SSH server
    - More secure and firewall-friendly
    - Different commands and clients

Recommendation for Modern Systems:
1st Choice: SFTP (best security and firewall compatibility)
2nd Choice: FTPS (if FTP infrastructure must be maintained)
3rd Choice: FTP (only for internal, trusted networks)

---

## 7. Daily Use Cases

### Use Case 1: Web Developer - Upload Website Files

Scenario: You've developed a website locally and need to upload it to your web hosting server.

Setup:
- Local: /home/developer/mywebsite/
- Remote: /var/www/html/ on hosting server
- FTP Server: ftp.example.com

Steps:

# Step 1: Connect to hosting provider's FTP server
ftp ftp.example.com
# Or for SFTP:
sftp username@ftp.example.com

# Enter credentials
Name: webuser
Password: ********

# Step 2: Navigate to web root
ftp> cd /var/www/html

# Step 3: Change local directory to your project
ftp> lcd /home/developer/mywebsite

# Step 4: Set binary mode (important for images, CSS, JS)
ftp> binary

# Step 5: Turn off prompting for multiple files
ftp> prompt

# Step 6: Upload all files
ftp> mput *

# Step 7: Upload directories
ftp> mkdir css
ftp> cd css
ftp> lcd css
ftp> mput *

ftp> cd ..
ftp> mkdir js
ftp> cd js
ftp> lcd ../js
ftp> mput *

# Step 8: Verify upload
ftp> cd /var/www/html
ftp> ls -la

# Step 9: Exit
ftp> bye

Real-World Alternative (More Common Today):
# Using SFTP with recursive directory upload
sftp username@ftp.example.com
sftp> cd /var/www/html
sftp> put -r /home/developer/mywebsite/*

# Or using scp (even simpler)
scp -r /home/developer/mywebsite/* username@ftp.example.com:/var/www/html/

# Or using rsync (best for synchronization)
rsync -avz /home/developer/mywebsite/ username@ftp.example.com:/var/www/html/

Benefits:
- Upload entire website in minutes
- Update only changed files (with rsync)
- Maintain file permissions
- No need for GUI FTP clients

### Use Case 2: System Administrator - Automated Backups

Scenario: Daily backup of important files from application server to backup server.

Setup:
- Source: /var/www/application/ on app-server
- Destination: /backups/daily/ on backup-server
- Schedule: Every night at 2:00 AM

Automated FTP Backup Script:

#!/bin/bash
# File: /scripts/ftp_backup.sh
# Purpose: Automated daily backup via FTP

# Configuration
FTP_SERVER="backup-server.example.com"
FTP_USER="backupuser"
FTP_PASS="SecurePassword123"
BACKUP_DIR="/var/www/application"
REMOTE_DIR="/backups/daily"
DATE=$(date +%Y%m%d)
LOG_FILE="/var/log/ftp_backup.log"

# Create backup archive
echo "[$(date)] Creating backup archive..." | tee -a $LOG_FILE
cd /tmp
tar -czf backup_${DATE}.tar.gz -C /var/www application/

if [ $? -eq 0 ]; then
    echo "[$(date)] Archive created successfully" | tee -a $LOG_FILE
else
    echo "[$(date)] ERROR: Archive creation failed" | tee -a $LOG_FILE
    exit 1
fi

# Upload via FTP
echo "[$(date)] Uploading to FTP server..." | tee -a $LOG_FILE

ftp -n $FTP_SERVER <<EOF
user $FTP_USER $FTP_PASS
binary
cd $REMOTE_DIR
put backup_${DATE}.tar.gz
bye
EOF

if [ $? -eq 0 ]; then
    echo "[$(date)] Upload successful" | tee -a $LOG_FILE
    
    # Clean up local file
    rm /tmp/backup_${DATE}.tar.gz
    
    # Delete backups older than 30 days from FTP server
    ftp -n $FTP_SERVER <<EOF
user $FTP_USER $FTP_PASS
cd $REMOTE_DIR
mdelete backup_$(date -d '30 days ago' +%Y%m%d)*.tar.gz
bye
EOF
    
    echo "[$(date)] Backup completed successfully" | tee -a $LOG_FILE
else
    echo "[$(date)] ERROR: Upload failed" | tee -a $LOG_FILE
    exit 1
fi

# Make script executable
chmod +x /scripts/ftp_backup.sh

# Add to crontab
crontab -e
# Add line:
0 2 * * * /scripts/ftp_backup.sh

Better Approach Using SFTP (More Secure):

#!/bin/bash
# File: /scripts/sftp_backup.sh
# Purpose: Automated daily backup via SFTP (more secure)

SFTP_SERVER="backup-server.example.com"
SFTP_USER="backupuser"
SFTP_KEY="/root/.ssh/backup_key"
BACKUP_DIR="/var/www/application"
REMOTE_DIR="/backups/daily"
DATE=$(date +%Y%m%d)
LOG_FILE="/var/log/sftp_backup.log"

# Create backup archive
echo "[$(date)] Creating backup archive..." | tee -a $LOG_FILE
tar -czf /tmp/backup_${DATE}.tar.gz -C /var/www application/

# Upload via SFTP using SSH key
echo "[$(date)] Uploading to SFTP server..." | tee -a $LOG_FILE

sftp -i $SFTP_KEY $SFTP_USER@$SFTP_SERVER <<EOF
cd $REMOTE_DIR
put /tmp/backup_${DATE}.tar.gz
bye
EOF

if [ $? -eq 0 ]; then
    echo "[$(date)] Backup completed successfully" | tee -a $LOG_FILE
    rm /tmp/backup_${DATE}.tar.gz
else
    echo "[$(date)] ERROR: Backup failed" | tee -a $LOG_FILE
    exit 1
fi

Benefits:
- Automated daily backups
- No manual intervention required
- Email alerts on failure
- Retention policy (30 days)
- Logs for audit trail

### Use Case 3: Data Analyst - Download Log Files for Analysis

Scenario: You need to download application log files from production server for analysis.

Setup:
- Server: production-server.example.com
- Log Location: /var/log/application/
- Need: Last 7 days of logs

Manual Approach:

# Step 1: Connect to server
sftp analyst@production-server.example.com

# Step 2: Navigate to log directory
sftp> cd /var/log/application

# Step 3: List available logs
sftp> ls -lt
-rw-r--r--    1 root     root      52428800 Nov 21 10:00 app.log.2025-11-21
-rw-r--r--    1 root     root      52428800 Nov 20 10:00 app.log.2025-11-20
-rw-r--r--    1 root     root      52428800 Nov 19 10:00 app.log.2025-11-19
...

# Step 4: Change local directory
sftp> lcd /home/analyst/logs

# Step 5: Download specific logs
sftp> get app.log.2025-11-21
sftp> get app.log.2025-11-20
sftp> get app.log.2025-11-19

# Or download multiple files with pattern
sftp> mget app.log.2025-11-*

# Step 6: Exit
sftp> bye

# Step 7: Analyze logs locally
cd /home/analyst/logs
grep "ERROR" app.log.2025-11-21 | wc -l
grep "WARN" app.log.2025-11-21 | wc -l

Automated Script:

#!/bin/bash
# File: download_logs.sh
# Purpose: Download last 7 days of logs for analysis

SERVER="production-server.example.com"
USER="analyst"
REMOTE_DIR="/var/log/application"
LOCAL_DIR="/home/analyst/logs/$(date +%Y%m%d)"

# Create local directory
mkdir -p $LOCAL_DIR

# Download logs
for i in {0..6}; do
    DATE=$(date -d "$i days ago" +%Y-%m-%d)
    echo "Downloading logs for $DATE..."
    
    sftp $USER@$SERVER <<EOF
cd $REMOTE_DIR
get app.log.$DATE $LOCAL_DIR/
bye
EOF
done

echo "Download completed. Logs saved to: $LOCAL_DIR"

# Generate summary report
cd $LOCAL_DIR
echo "=== Log Analysis Summary ===" > summary.txt
for logfile in app.log.*; do
    echo "File: $logfile" >> summary.txt
    echo "  Errors: $(grep -c "ERROR" $logfile)" >> summary.txt
    echo "  Warnings: $(grep -c "WARN" $logfile)" >> summary.txt
    echo "" >> summary.txt
done

cat summary.txt

Benefits:
- Quick access to production logs
- No need for server access to analyze
- Can use local tools for analysis
- Automated report generation

### Use Case 4: DevOps - Deploy Application Artifacts

Scenario: CI/CD pipeline builds application artifacts that need to be deployed to multiple servers.

Setup:
- Build Server: Generates WAR/JAR files
- Application Servers: app01, app02, app03
- Deploy Location: /opt/applications/

Deployment Script:

#!/bin/bash
# File: deploy_artifacts.sh
# Purpose: Deploy application artifacts to multiple servers

ARTIFACT="myapp-v1.2.3.war"
ARTIFACT_PATH="/jenkins/builds/myapp/target/$ARTIFACT"
DEPLOY_DIR="/opt/applications"
SERVERS=("app01.example.com" "app02.example.com" "app03.example.com")
DEPLOY_USER="deployer"

# Verify artifact exists
if [ ! -f "$ARTIFACT_PATH" ]; then
    echo "ERROR: Artifact not found: $ARTIFACT_PATH"
    exit 1
fi

# Deploy to each server
for server in "${SERVERS[@]}"; do
    echo "================================"
    echo "Deploying to: $server"
    echo "================================"
    
    # Upload artifact
    sftp $DEPLOY_USER@$server <<EOF
cd $DEPLOY_DIR
put $ARTIFACT_PATH
bye
EOF
    
    if [ $? -eq 0 ]; then
        echo "✓ Deployment to $server successful"
        
        # Restart application (via SSH)
        ssh $DEPLOY_USER@$server "sudo systemctl restart myapp"
        
        # Wait for service to start
        sleep 10
        
        # Health check
        HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://$server:8080/health)
        if [ "$HTTP_CODE" == "200" ]; then
            echo "✓ Health check passed for $server"
        else
            echo "✗ Health check failed for $server (HTTP $HTTP_CODE)"
        fi
    else
        echo "✗ Deployment to $server failed"
    fi
    
    echo ""
done

echo "Deployment completed!"

Benefits:
- Automated multi-server deployment
- Consistent deployment process
- Health checks after deployment
- Rollback capability if needed

### Use Case 5: Content Manager - Bulk Media Upload

Scenario: You have 500 product images that need to be uploaded to your e-commerce site.

Setup:
- Local: /home/content/product_images/ (500 images, 2GB total)
- Remote: /var/www/ecommerce/images/products/
- Server: ftp.ecommerce.com

Efficient Upload Script:

#!/bin/bash
# File: bulk_upload_images.sh
# Purpose: Upload hundreds of images efficiently

FTP_SERVER="ftp.ecommerce.com"
FTP_USER="content_manager"
LOCAL_DIR="/home/content/product_images"
REMOTE_DIR="/var/www/ecommerce/images/products"

# Count total files
TOTAL=$(find $LOCAL_DIR -type f -name "*.jpg" -o -name "*.png" | wc -l)
echo "Total images to upload: $TOTAL"

# Create file list
find $LOCAL_DIR -type f \( -name "*.jpg" -o -name "*.png" \) > /tmp/upload_list.txt

# Upload using SFTP batch mode
echo "Uploading images..."
sftp -b - $FTP_USER@$FTP_SERVER <<EOF
cd $REMOTE_DIR
lcd $LOCAL_DIR
$(cat /tmp/upload_list.txt | while read file; do echo "put $(basename $file)"; done)
bye
EOF

echo "Upload completed!"

# Generate upload report
echo "=== Upload Report ===" > upload_report.txt
echo "Date: $(date)" >> upload_report.txt
echo "Total files: $TOTAL" >> upload_report.txt
echo "Source: $LOCAL_DIR" >> upload_report.txt
echo "Destination: $FTP_SERVER:$REMOTE_DIR" >> upload_report.txt

Benefits:
- Bulk upload of large number of files
- Progress tracking
- Upload report for documentation
- Resume capability if interrupted

### Use Case 6: Database Administrator - Backup Database Dumps

Scenario: Nightly database dumps need to be transferred to secure backup server.

Setup:
- Database Server: db-prod.example.com
- Backup Server: backup.example.com
- Schedule: Every night at 3:00 AM

Complete Backup Workflow:

#!/bin/bash
# File: database_ftp_backup.sh
# Purpose: Dump database and transfer to backup server

# Database configuration
DB_HOST="localhost"
DB_USER="backup_user"
DB_PASS="DBPassword123"
DB_NAME="production_db"

# FTP configuration
FTP_SERVER="backup.example.com"
FTP_USER="dbbackup"
FTP_PASS="BackupPassword123"
REMOTE_DIR="/backups/database"

# Local configuration
BACKUP_DIR="/tmp/db_backups"
DATE=$(date +%Y%m%d_%H%M%S)
DUMP_FILE="${DB_NAME}_${DATE}.sql"
COMPRESSED_FILE="${DUMP_FILE}.gz"
LOG_FILE="/var/log/db_ftp_backup.log"

# Step 1: Create backup directory
mkdir -p $BACKUP_DIR
cd $BACKUP_DIR

# Step 2: Dump database
echo "[$(date)] Starting database dump..." | tee -a $LOG_FILE
mysqldump -h $DB_HOST -u $DB_USER -p$DB_PASS \
    --single-transaction \
    --routines \
    --triggers \
    --events \
    $DB_NAME > $DUMP_FILE

if [ $? -eq 0 ]; then
    echo "[$(date)] Database dump successful" | tee -a $LOG_FILE
    
    # Step 3: Compress dump
    echo "[$(date)] Compressing dump..." | tee -a $LOG_FILE
    gzip $DUMP_FILE
    
    SIZE=$(du -h $COMPRESSED_FILE | cut -f1)
    echo "[$(date)] Compressed size: $SIZE" | tee -a $LOG_FILE
    
    # Step 4: Upload to FTP server
    echo "[$(date)] Uploading to FTP server..." | tee -a $LOG_FILE
    
    ftp -n $FTP_SERVER <<EOF
user $FTP_USER $FTP_PASS
binary
cd $REMOTE_DIR
put $COMPRESSED_FILE
bye
EOF
    
    if [ $? -eq 0 ]; then
        echo "[$(date)] Upload successful" | tee -a $LOG_FILE
        
        # Step 5: Verify upload
        REMOTE_SIZE=$(ftp -n $FTP_SERVER <<EOF | grep $COMPRESSED_FILE | awk '{print $5}'
user $FTP_USER $FTP_PASS
cd $REMOTE_DIR
ls -l $COMPRESSED_FILE
bye
EOF
)
        
        LOCAL_SIZE=$(stat -c%s $COMPRESSED_FILE)
        
        if [ "$REMOTE_SIZE" == "$LOCAL_SIZE" ]; then
            echo "[$(date)] Verification successful" | tee -a $LOG_FILE
            
            # Clean up local file
            rm $COMPRESSED_FILE
            
            # Send success notification
            echo "Database backup completed successfully at $(date)" | \
                mail -s "DB Backup Success" dba@example.com
        else
            echo "[$(date)] ERROR: File size mismatch" | tee -a $LOG_FILE
            echo "Database backup verification failed" | \
                mail -s "DB Backup WARNING" dba@example.com
        fi
    else
        echo "[$(date)] ERROR: Upload failed" | tee -a $LOG_FILE
        echo "Database backup upload failed" | \
            mail -s "DB Backup FAILURE" dba@example.com
        exit 1
    fi
else
    echo "[$(date)] ERROR: Database dump failed" | tee -a $LOG_FILE
    echo "Database dump failed" | \
        mail -s "DB Backup FAILURE" dba@example.com
    exit 1
fi

echo "[$(date)] Backup process completed" | tee -a $LOG_FILE

# Add to crontab
# 0 3 * * * /scripts/database_ftp_backup.sh

Benefits:
- Automated nightly backups
- Compression saves storage space
- Verification ensures integrity
- Email notifications for monitoring
- Disaster recovery capability

### Use Case 7: IT Support - Distribute Software Updates

Scenario: New software version needs to be distributed to all client computers.

Setup:
- Central FTP Server: updates.company.com
- Clients: 200+ workstations
- Software: company_app_v2.5.exe (250MB)

Server Side (Host Software):

# Step 1: Create updates directory
mkdir -p /ftp_root/software_updates/2025-11

# Step 2: Copy new version to FTP server
cp /builds/company_app_v2.5.exe /ftp_root/software_updates/2025-11/

# Step 3: Create checksum file
cd /ftp_root/software_updates/2025-11
md5sum company_app_v2.5.exe > company_app_v2.5.exe.md5
sha256sum company_app_v2.5.exe > company_app_v2.5.exe.sha256

# Step 4: Create version info file
cat > version_info.txt <<EOF
Version: 2.5.0
Release Date: 2025-11-21
File: company_app_v2.5.exe
Size: 262144000 bytes (250 MB)
MD5: $(cat company_app_v2.5.exe.md5 | cut -d' ' -f1)
SHA256: $(cat company_app_v2.5.exe.sha256 | cut -d' ' -f1)
Minimum OS: Windows 10
Installation: Run as Administrator
Release Notes: https://company.com/releases/v2.5
EOF

Client Side (Download and Install):

@echo off
REM File: update_software.bat
REM Purpose: Download and install software update from FTP

set FTP_SERVER=updates.company.com
set FTP_USER=update_client
set FTP_PASS=ClientPassword123
set REMOTE_DIR=/software_updates/2025-11
set LOCAL_DIR=C:\Temp\Updates
set INSTALLER=company_app_v2.5.exe

REM Create local directory
if not exist %LOCAL_DIR% mkdir %LOCAL_DIR%
cd /d %LOCAL_DIR%

REM Download installer via FTP
echo user %FTP_USER%> ftp_script.txt
echo %FTP_PASS%>> ftp_script.txt
echo binary>> ftp_script.txt
echo cd %REMOTE_DIR%>> ftp_script.txt
echo get %INSTALLER%>> ftp_script.txt
echo get %INSTALLER%.md5>> ftp_script.txt
echo bye>> ftp_script.txt

ftp -n -s:ftp_script.txt %FTP_SERVER%

REM Verify download
if not exist %INSTALLER% (
    echo ERROR: Download failed
    exit /b 1
)

REM Verify checksum (requires md5sum utility)
REM md5sum -c %INSTALLER%.md5

REM Install software
echo Installing %INSTALLER%...
%INSTALLER% /S /v/qn

REM Clean up
del ftp_script.txt
del %INSTALLER%
del %INSTALLER%.md5

echo Update completed successfully

REM Deploy via Group Policy or SCCM to all workstations

Benefits:
- Centralized software distribution
- Bandwidth efficient (FTP optimized for large files)
- Checksum verification ensures integrity
- Automated installation
- Scalable to hundreds of machines

### Use Case 8: Photographer - Client Photo Delivery

Scenario: Professional photographer needs to deliver 2GB of edited photos to client.

Setup:
- Photos: 150 high-resolution images (2GB total)
- Client: Non-technical user
- Need: Simple download process

Solution Using FTP:

# Server Side (Photographer)

# Step 1: Create client-specific directory
sudo mkdir -p /var/ftp/clients/johnson_wedding
sudo chown ftpuser:ftpuser /var/ftp/clients/johnson_wedding

# Step 2: Copy photos
cp -r /home/photographer/edited/johnson_wedding/* /var/ftp/clients/johnson_wedding/

# Step 3: Create README file
cat > /var/ftp/clients/johnson_wedding/README.txt <<EOF
Johnson Wedding Photos - November 21, 2025

Total Images: 150
Format: JPEG, High Resolution (300 DPI)
Size: 2 GB

To download all photos:
1. Right-click each folder
2. Select "Download"
3. Wait for download to complete

Copyright © 2025 Professional Photography Studio
All rights reserved.

Questions? Contact: photographer@example.com
EOF

# Step 4: Create temporary FTP user for client
sudo useradd -d /var/ftp/clients/johnson_wedding -s /sbin/nologin johnson_wedding
sudo passwd johnson_wedding
# Set password: WeddingPhotos2025

# Step 5: Email client with instructions
cat > client_email.txt <<EOF
Subject: Your Wedding Photos Are Ready!

Dear Mr. & Mrs. Johnson,

Your wedding photos are ready for download!

Access Details:
- Server: ftp.photographystudio.com
- Username: johnson_wedding
- Password: WeddingPhotos2025

Instructions:
1. Download FileZilla (free): https://filezilla-project.org/
2. Open FileZilla
3. Enter the server, username, and password above
4. Click "Quickconnect"
5. Download all folders to your computer

Files will be available for 30 days.

Best regards,
Professional Photography Studio
EOF

# Step 6: Set up automatic deletion after 30 days
echo "sudo userdel -r johnson_wedding" | at now + 30 days
echo "sudo rm -rf /var/ftp/clients/johnson_wedding" | at now + 30 days

Benefits:
- Large file transfer without email limitations
- Client can download at their convenience
- Organized delivery
- Automatic cleanup after 30 days
- Professional presentation

---

## 8. Real-Life Examples & Scenarios

### Example 1: "FTP Connection Refused" - Complete Troubleshooting

Problem: User cannot connect to FTP server

# Symptom:
$ ftp 192.168.1.100
ftp: connect: Connection refused
ftp>

# Step-by-Step Troubleshooting:

# Step 1: Verify FTP service is running on server
ssh admin@192.168.1.100
sudo systemctl status vsftpd

# If not running:
sudo systemctl start vsftpd
sudo systemctl enable vsftpd

# Step 2: Check if port 21 is listening
sudo netstat -tuln | grep :21
# Or
sudo ss -tuln | grep :21

# Expected output:
# tcp6       0      0 :::21                   :::*                    LISTEN

# Step 3: Test connectivity from client
ping 192.168.1.100
# If ping fails: Network issue

telnet 192.168.1.100 21
# If connection refused: Firewall blocking or service not listening

# Step 4: Check firewall on server
sudo firewall-cmd --list-all

# If FTP not allowed:
sudo firewall-cmd --permanent --add-service=ftp
sudo firewall-cmd --reload

# Step 5: Check SELinux (if enabled)
sudo getenforce

# If Enforcing, check SELinux booleans:
sudo getsebool -a | grep ftp

# Enable required booleans:
sudo setsebool -P ftp_home_dir on

# Step 6: Check vsftpd configuration
sudo grep -v "^#" /etc/vsftpd/vsftpd.conf | grep -v "^$"

# Ensure:
# listen=YES
# listen_ipv6=NO

# Step 7: Check logs for errors
sudo tail -f /var/log/messages
# Or
sudo journalctl -u vsftpd -f

# Step 8: Test again
ftp 192.168.1.100

Solution Found: Firewall was blocking port 21. After adding FTP service to firewall, connection successful.

### Example 2: "Login Incorrect" - Authentication Issues

Problem: FTP connection works but login fails

# Symptom:
$ ftp 192.168.1.100
Connected to 192.168.1.100.
220 Welcome to UNIXMEN FTP service.
Name (192.168.1.100:user): testuser
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.

# Troubleshooting:

# Step 1: Verify user exists on server
ssh admin@192.168.1.100
grep testuser /etc/passwd

# If user doesn't exist:
sudo useradd testuser
sudo passwd testuser

# Step 2: Verify password is correct
# Try SSH login with same credentials
ssh testuser@192.168.1.100

# If SSH works but FTP doesn't: FTP-specific issue

# Step 3: Check vsftpd user access
sudo cat /etc/vsftpd/vsftpd.conf | grep userlist

# If userlist_enable=YES:
sudo cat /etc/vsftpd/user_list
# Ensure testuser is not in deny list
# Or add to allow list if userlist_deny=NO

# Step 4: Check for chroot errors
sudo tail -f /var/log/secure

# Common error: "500 OOPS: vsftpd: refusing to run with writable root inside chroot()"

# Solution:
sudo chmod 555 /home/testuser
# Or add to vsftpd.conf:
allow_writeable_chroot=YES

# Step 5: Check PAM configuration
sudo cat /etc/pam.d/vsftpd

# Ensure proper authentication modules are configured

# Step 6: Test with verbose logging
# Edit /etc/vsftpd/vsftpd.conf:
log_ftp_protocol=YES
debug_ssl=YES

# Restart vsftpd:
sudo systemctl restart vsftpd

# Check logs:
sudo tail -f /var/log/xferlog

# Step 7: Try FTP login again
ftp 192.168.1.100

Solution Found: User's home directory had wrong permissions. After chmod 555 /home/testuser and adding allow_writeable_chroot=YES, login successful.

### Example 3: Slow FTP Transfer Speeds

Problem: FTP transfers are extremely slow (10 KB/s instead of expected 10 MB/s)

# Scenario:
ftp> put large_file.zip
local: large_file.zip remote: large_file.zip
227 Entering Passive Mode (192,168,1,100,39,30).
150 Ok to send data.
######################## (stuck here for a long time)

# Troubleshooting:

# Step 1: Test network speed
# From client:
ping -c 10 192.168.1.100
# Check for high latency or packet loss

# Step 2: Test bandwidth
# Install iperf on both client and server
# Server:
iperf -s

# Client:
iperf -c 192.168.1.100
# Note: This shows available bandwidth

# Step 3: Check FTP mode (Active vs Passive)
# In FTP session:
ftp> passive
Passive mode on.
# Or
ftp> passive
Passive mode off.

# Try transfer again after toggling

# Step 4: Check for firewall interference
# Passive mode uses dynamic ports
# On server firewall:
sudo firewall-cmd --permanent --add-port=10000-10100/tcp
sudo firewall-cmd --reload

# Configure vsftpd for passive ports:
# Edit /etc/vsftpd/vsftpd.conf:
pasv_enable=YES
pasv_min_port=10000
pasv_max_port=10100
pasv_address=192.168.1.100  # Server's public IP

# Restart vsftpd:
sudo systemctl restart vsftpd

# Step 5: Check for bandwidth throttling
# Check vsftpd.conf for:
local_max_rate=0  # 0 = unlimited
anon_max_rate=0

# Step 6: Use binary mode (not ASCII)
ftp> binary
200 Switching to Binary mode.

# Step 7: Compare with other transfer methods
# Try SFTP:
sftp user@192.168.1.100
sftp> put large_file.zip
# Note the transfer speed

# Try SCP:
scp large_file.zip user@192.168.1.100:/home/user/
# Note the transfer speed

# Step 8: Check server load
# On server:
top
iostat -x 1
# High CPU or disk I/O can slow transfers

# Step 9: Try alternative FTP client
# Instead of command-line ftp, try FileZilla
filezilla

# Step 10: Check MTU settings
# On both client and server:
ip link show
# Look for MTU value (should be 1500)

# Test with different MTU:
sudo ip link set eth0 mtu 1450

Solution Found: Passive mode ports were blocked by firewall. After configuring pasv_min_port, pasv_max_port in vsftpd.conf and opening those ports in firewall, transfer speed improved from 10 KB/s to 15 MB/s.

### Example 4: FTP Works Internally But Not From Internet

Problem: FTP works on local network but fails from external/internet

# Scenario:
# From internal network (192.168.1.x):
$ ftp 192.168.1.100
Connected to 192.168.1.100.
220 Welcome to FTP service.
# Works fine!

# From internet (using public IP):
$ ftp 203.0.113.50
ftp: connect: Connection timed out

# Troubleshooting:

# Step 1: Identify public IP
# On server:
curl ifconfig.me
# Output: 203.0.113.50

# Step 2: Check if port forwarding is configured
# On router/firewall, verify NAT rules:
# External Port 21 → Internal 192.168.1.100:21
# External Port 20 → Internal 192.168.1.100:20
# External Ports 10000-10100 → Internal 192.168.1.100:10000-10100

# Step 3: Configure passive mode with public IP
# Edit /etc/vsftpd/vsftpd.conf:
pasv_address=203.0.113.50  # Public IP
pasv_enable=YES
pasv_min_port=10000
pasv_max_port=10100

# Restart vsftpd:
sudo systemctl restart vsftpd

# Step 4: Test from external network
# From internet:
ftp 203.0.113.50

# Step 5: Check logs
# On server:
sudo tail -f /var/log/vsftpd.log
sudo tail -f /var/log/secure

# Step 6: Test with external tool
# Use online FTP tester: http://www.ftptest.net/
# Enter: 203.0.113.50, username, password

# Step 7: Verify firewall allows incoming connections
# On server:
sudo firewall-cmd --list-all
# Should show ftp service and passive ports

# On router:
# Check that WAN firewall allows port 21 inbound

# Step 8: Check ISP restrictions
# Some ISPs block common ports
# Test with alternative port:
# Edit /etc/vsftpd/vsftpd.conf:
listen_port=2121

# Restart vsftpd:
sudo systemctl restart vsftpd

# Test:
ftp -p 2121 203.0.113.50

Solution Found: Router had port forwarding for port 21, but not for passive mode ports (10000-10100). After adding port forwarding rules for passive ports, external FTP connections worked.

### Example 5: Permission Denied When Uploading Files

Problem: User can login but cannot upload files

# Scenario:
ftp> put test.txt
local: test.txt remote: test.txt
227 Entering Passive Mode (192,168,1,100,39,31).
550 Permission denied.

# Troubleshooting:

# Step 1: Check vsftpd write permission
# Edit /etc/vsftpd/vsftpd.conf:
write_enable=YES  # Must be YES

# Restart vsftpd:
sudo systemctl restart vsftpd

# Step 2: Check user's home directory permissions
# On server:
ls -ld /home/ftpuser
# Output: drwx------. 2 ftpuser ftpuser 62 Nov 21 10:00 /home/ftpuser

# If permissions are wrong:
sudo chown ftpuser:ftpuser /home/ftpuser
sudo chmod 755 /home/ftpuser

# Step 3: Check if chroot is enabled
# In /etc/vsftpd/vsftpd.conf:
chroot_local_user=YES
allow_writeable_chroot=YES  # Important!

# Without allow_writeable_chroot=YES, you'll get permission errors

# Step 4: Create writable directory inside chroot
# If chroot is enabled:
sudo mkdir /home/ftpuser/uploads
sudo chown ftpuser:ftpuser /home/ftpuser/uploads
sudo chmod 755 /home/ftpuser/uploads

# User should upload to uploads/ directory:
ftp> cd uploads
ftp> put test.txt

# Step 5: Check SELinux context
# If SELinux is enabled:
sudo ls -Z /home/ftpuser
# Should show: unconfined_u:object_r:user_home_dir_t:s0

# If incorrect:
sudo restorecon -Rv /home/ftpuser

# Or:
sudo chcon -R -t public_content_rw_t /home/ftpuser/uploads
sudo setsebool -P allow_ftpd_anon_write on

# Step 6: Check disk space
df -h /home
# If disk is full, uploads will fail

# Step 7: Check user quotas (if enabled)
quota ftpuser

# Step 8: Test permissions manually
# SSH to server as the FTP user:
ssh ftpuser@192.168.1.100
cd ~
touch test_write.txt
# If this fails, it's a permission issue

# Step 9: Check vsftpd logs
sudo tail -f /var/log/vsftpd.log
# Look for specific error messages

Solution Found: chroot_local_user was set to YES but allow_writeable_chroot was not set. After adding allow_writeable_chroot=YES to vsftpd.conf, uploads worked successfully.

---

## 9. Security Considerations

### Security Risks of Plain FTP

#### Risk 1: Unencrypted Credentials
Problem: Usernames and passwords transmitted in clear text

Example: Attacker sniffing network traffic:
$ sudo tcpdump -i eth0 -A port 21
USER iafzal
PASS MyPassword123  ← Visible to attacker!

Impact: Account compromise
Mitigation: Use SFTP or FTPS

#### Risk 2: Unencrypted Data
Problem: File contents transmitted in clear text

Example: Sensitive document intercepted:
$ sudo tcpdump -i eth0 -w ftp_capture.pcap port 20
# Attacker can read file contents from packet capture

Impact: Data breach, compliance violations
Mitigation: Use SFTP or FTPS

#### Risk 3: Anonymous Access
Problem: Default configuration may allow anonymous login

Example:
# /etc/vsftpd/vsftpd.conf
anonymous_enable=YES  ← Dangerous!

# Anyone can login:
$ ftp server.example.com
Name: anonymous
Password: [any email]
230 Login successful.

Impact: Unauthorized access to files
Mitigation: Set anonymous_enable=NO

#### Risk 4: Bounce Attack
Problem: FTP bounce attack allows attacker to proxy through FTP server

Example:
ftp> PORT 192,168,1,50,0,23
# Attacker connects to third-party server through your FTP server

Impact: Your server used for attacks, IP reputation damage
Mitigation: Disable PORT command or restrict to same network

#### Risk 5: Brute Force Attacks
Problem: FTP servers exposed to internet face constant brute force attempts

Example:
# /var/log/secure shows:
Nov 21 10:01:23 server vsftpd[1234]: pam_unix(vsftpd:auth): authentication failure; user=admin
Nov 21 10:01:25 server vsftpd[1235]: pam_unix(vsftpd:auth): authentication failure; user=root
Nov 21 10:01:27 server vsftpd[1236]: pam_unix(vsftpd:auth): authentication failure; user=admin
# ... thousands of attempts

Impact: Account compromise if weak password, DoS
Mitigation: fail2ban, strong passwords, rate limiting

### Security Best Practices

#### Practice 1: Use SFTP Instead of FTP
Why: Complete encryption of data and credentials

# Install OpenSSH server (usually installed by default)
sudo yum install openssh-server

# Start SSH service
sudo systemctl start sshd
sudo systemctl enable sshd

# Users can now use SFTP
sftp user@server.example.com

Configuration:
# /etc/ssh/sshd_config

# Enable SFTP subsystem
Subsystem sftp /usr/libexec/openssh/sftp-server

# Disable SSH shell for FTP-only users
Match User ftpuser
    ForceCommand internal-sftp
    ChrootDirectory /home/ftpuser
    PermitTunnel no
    AllowAgentForwarding no
    AllowTcpForwarding no
    X11Forwarding no

# Restart SSH
sudo systemctl restart sshd

#### Practice 2: Disable Anonymous Access
# /etc/vsftpd/vsftpd.conf
anonymous_enable=NO
anon_upload_enable=NO
anon_mkdir_write_enable=NO

#### Practice 3: Use Strong Authentication
# Require strong passwords
# Install libpam-pwquality
sudo yum install libpwquality

# Configure PAM
# /etc/pam.d/vsftpd
password requisite pam_pwquality.so retry=3 minlen=12 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1

# Or use SSH key authentication for SFTP
ssh-keygen -t rsa -b 4096 -C "ftpuser@example.com"
ssh-copy-id ftpuser@server.example.com

#### Practice 4: Implement Chroot Jail
# Restrict users to their home directory
# /etc/vsftpd/vsftpd.conf
chroot_local_user=YES
allow_writeable_chroot=YES

# Or chroot specific users only
chroot_local_user=NO
chroot_list_enable=YES
chroot_list_file=/etc/vsftpd/chroot_list

# Create chroot_list
echo "ftpuser1" | sudo tee -a /etc/vsftpd/chroot_list
echo "ftpuser2" | sudo tee -a /etc/vsftpd/chroot_list

#### Practice 5: Implement fail2ban
# Install fail2ban
sudo yum install fail2ban

# Configure for vsftpd
# /etc/fail2ban/jail.local
[vsftpd]
enabled = true
port = ftp,ftp-data,ftps,ftps-data
logpath = /var/log/vsftpd.log
maxretry = 3
bantime = 3600
findtime = 600

# Start fail2ban
sudo systemctl start fail2ban
sudo systemctl enable fail2ban

# Check banned IPs
sudo fail2ban-client status vsftpd

#### Practice 6: Rate Limiting
# /etc/vsftpd/vsftpd.conf

# Limit connection rate per IP
max_per_ip=5

# Limit total connections
max_clients=50

# Limit login rate
delay_failed_login=5
delay_successful_login=0

#### Practice 7: Disable Unnecessary Features
# /etc/vsftpd/vsftpd.conf

# Disable PORT command (prevent bounce attacks)
port_enable=NO
pasv_enable=YES

# Disable anonymous access
anonymous_enable=NO

# Disable directory listing for anonymous
anon_world_readable_only=YES

# Enable logging
xferlog_enable=YES
log_ftp_protocol=YES

#### Practice 8: Use Firewall Rules
# Allow FTP only from specific IPs
sudo firewall-cmd --permanent --add-rich-rule='
  rule family="ipv4"
  source address="192.168.1.0/24"
  port port="21" protocol="tcp" accept'

# Or use iptables
sudo iptables -A INPUT -p tcp --dport 21 -s 192.168.1.0/24 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 21 -j DROP

#### Practice 9: Regular Security Audits
# Check for unauthorized users
sudo cat /etc/passwd | grep /bin/bash

# Check FTP logs for suspicious activity
sudo grep "FAIL LOGIN" /var/log/vsftpd.log

# Check for unusual file transfers
sudo grep "UPLOAD" /var/log/xferlog | tail -20
sudo grep "DOWNLOAD" /var/log/xferlog | tail -20

# Monitor active FTP connections
sudo netstat -anp | grep :21

#### Practice 10: Keep Software Updated
# Update vsftpd regularly
sudo yum update vsftpd

# Check version
vsftpd -v

# Subscribe to security mailing lists
# https://security.centos.org/

### Compliance Considerations

#### PCI-DSS Compliance
Requirements for handling credit card data:
- FTP must use strong encryption (SFTP or FTPS)
- Plain FTP is NOT compliant
- Require strong authentication
- Log all file transfers
- Implement access controls

#### HIPAA Compliance
Requirements for healthcare data:
- Encryption in transit (SFTP/FTPS required)
- Encryption at rest
- Access logging and auditing
- User authentication and authorization
- Automatic session timeout

#### GDPR Compliance
Requirements for EU personal data:
- Secure transmission (encrypted)
- Access controls
- Data minimization
- Audit trails
- Right to erasure (ability to delete user data)

### Secure FTP Checklist

✅ Use SFTP or FTPS instead of plain FTP
✅ Disable anonymous access
✅ Implement strong password policies
✅ Use SSH key authentication (for SFTP)
✅ Enable chroot jail for users
✅ Install and configure fail2ban
✅ Implement rate limiting
✅ Configure firewall rules
✅ Enable detailed logging
✅ Regular security audits
✅ Keep software updated
✅ Disable unnecessary features
✅ Use secure file permissions
✅ Implement session timeouts
✅ Monitor logs for suspicious activity
✅ Regular backup of configurations

---

## 10. Troubleshooting Guide

### Common Issues & Solutions

#### Issue 1: "Connection Refused"
Symptoms:
ftp: connect: Connection refused

Causes & Solutions:

1. FTP service not running
   Check: systemctl status vsftpd
   Fix: systemctl start vsftpd

2. Firewall blocking port 21
   Check: firewall-cmd --list-all
   Fix: firewall-cmd --permanent --add-service=ftp
        firewall-cmd --reload

3. Wrong IP address or hostname
   Check: ping server.example.com
   Fix: Verify correct address

4. SELinux blocking
   Check: getenforce
   Fix: setsebool -P ftp_home_dir on

#### Issue 2: "Login Incorrect"
Symptoms:
530 Login incorrect.
Login failed.

Causes & Solutions:

1. Wrong username or password
   Check: ssh user@server (test credentials)
   Fix: Reset password: passwd username

2. User not in allowed list
   Check: cat /etc/vsftpd/user_list
   Fix: Add user or modify userlist_deny setting

3. Chroot permission issue
   Check: ls -ld /home/username
   Fix: chmod 555 /home/username
        Or add: allow_writeable_chroot=YES

4. PAM configuration issue
   Check: cat /etc/pam.d/vsftpd
   Fix: Verify PAM modules are correct

#### Issue 3: "Permission Denied" on Upload
Symptoms:
550 Permission denied.

Causes & Solutions:

1. Write not enabled
   Check: grep write_enable /etc/vsftpd/vsftpd.conf
   Fix: Set write_enable=YES

2. Directory permissions
   Check: ls -ld /home/user/uploads
   Fix: chown user:user /home/user/uploads
        chmod 755 /home/user/uploads

3. Chroot without writable option
   Fix: Add allow_writeable_chroot=YES

4. SELinux context
   Check: ls -Z /home/user
   Fix: chcon -R -t public_content_rw_t /home/user/uploads

5. Disk full
   Check: df -h
   Fix: Free up disk space

#### Issue 4: Slow Transfer Speeds
Symptoms:
Transfer takes hours instead of minutes

Causes & Solutions:

1. Using ASCII mode instead of binary
   Fix: ftp> binary

2. Passive mode port blocked
   Check: firewall-cmd --list-all
   Fix: Open ports 10000-10100
        Configure pasv_min_port and pasv_max_port

3. Network latency
   Check: ping -c 10 server.example.com
   Fix: Use closer server or CDN

4. Server overloaded
   Check: top, iostat
   Fix: Reduce load or upgrade server

5. MTU mismatch
   Check: ip link show
   Fix: Adjust MTU: ip link set eth0 mtu 1450

#### Issue 5: "Failed to Retrieve Directory Listing"
Symptoms:
227 Entering Passive Mode
Failed to retrieve directory listing

Causes & Solutions:

1. Passive mode ports blocked by firewall
   Check: netstat -tuln | grep LISTEN
   Fix: firewall-cmd --permanent --add-port=10000-10100/tcp
        firewall-cmd --reload
        Add to vsftpd.conf:
        pasv_min_port=10000
        pasv_max_port=10100

2. Wrong passive IP address
   Check: grep pasv_address /etc/vsftpd/vsftpd.conf
   Fix: Set pasv_address to public IP

3. NAT/Router issue
   Fix: Configure port forwarding on router

4. Try active mode instead
   Fix: ftp> passive (toggle off)

#### Issue 6: "500 OOPS: vsftpd: refusing to run with writable root"
Symptoms:
500 OOPS: vsftpd: refusing to run with writable root inside chroot()

Causes & Solutions:

1. Home directory writable with chroot enabled
   Check: ls -ld /home/username
   Fix: chmod 555 /home/username
        Or add to vsftpd.conf:
        allow_writeable_chroot=YES

#### Issue 7: Can't Connect from Internet (Only Works Locally)
Symptoms:
Works: ftp 192.168.1.100
Fails: ftp public-ip.example.com

Causes & Solutions:

1. No port forwarding on router
   Fix: Configure router to forward port 21 to internal IP

2. ISP blocking port 21
   Check: Test from external network
   Fix: Use alternative port (2121)
        listen_port=2121

3. Wrong pasv_address
   Fix: Set pasv_address to public IP

4. Firewall on router/server
   Fix: Open required ports

#### Issue 8: "425 Can't Open Data Connection"
Symptoms:
425 Can't open data connection.

Causes & Solutions:

1. Firewall blocking data connection
   Fix: Open passive ports or use active mode

2. NAT issues
   Fix: Configure pasv_address correctly

3. Client firewall blocking
   Fix: Allow FTP client through firewall
        Use passive mode

---

## 11. FTP Alternatives & Modern Solutions

### Modern File Transfer Solutions

#### 1. SFTP (Recommended)
Advantages over FTP:
- Encrypted (SSH-based)
- Single port (22)
- Firewall-friendly
- Better security

Usage:
sftp user@server.example.com
sftp> put file.txt
sftp> get remotefile.txt
sftp> bye

#### 2. SCP (Secure Copy)
Simple file copying over SSH:

# Upload file
scp local_file.txt user@server.example.com:/remote/path/

# Download file
scp user@server.example.com:/remote/file.txt /local/path/

# Upload directory
scp -r local_directory/ user@server.example.com:/remote/path/

# Download directory
scp -r user@server.example.com:/remote/directory/ /local/path/

#### 3. rsync (Best for Synchronization)
Efficient file synchronization:

# Sync directory to remote
rsync -avz /local/dir/ user@server.example.com:/remote/dir/

# Sync from remote to local
rsync -avz user@server.example.com:/remote/dir/ /local/dir/

# Sync with delete (mirror)
rsync -avz --delete /local/dir/ user@server.example.com:/remote/dir/

# Sync with progress
rsync -avz --progress large_file.zip user@server.example.com:/backup/

Advantages:
- Only transfers changed files
- Compression during transfer
- Resume capability
- Bandwidth limiting
- Preserve permissions and timestamps

#### 4. Cloud Storage Solutions
Modern alternatives:

AWS S3:
aws s3 cp file.txt s3://mybucket/
aws s3 sync /local/dir/ s3://mybucket/backup/

Google Cloud Storage:
gsutil cp file.txt gs://mybucket/
gsutil rsync -r /local/dir gs://mybucket/backup/

Azure Blob Storage:
az storage blob upload --file file.txt --container mycontainer

#### 5. Web-Based File Transfer
Solutions:
- Nextcloud (self-hosted)
- ownCloud (self-hosted)
- Seafile (self-hosted)
- Dropbox, Google Drive (cloud)

Advantages:
- Web interface (no special client needed)
- Sharing links
- Collaboration features
- Version control
- Mobile apps

#### 6. API-Based Transfer
For automation:

# Using curl to upload via REST API
curl -X POST https://api.example.com/upload \
  -H "Authorization: Bearer TOKEN" \
  -F "file=@document.pdf"

# Using Python requests
import requests
files = {'file': open('document.pdf', 'rb')}
response = requests.post('https://api.example.com/upload', 
                        files=files,
                        headers={'Authorization': 'Bearer TOKEN'})

---

## 12. Quick Reference Guide

### Essential FTP Commands Quick Reference

Connection:
ftp hostname                  # Connect to FTP server
ftp user@hostname            # Connect with username
bye / quit                   # Exit FTP

Navigation:
pwd                          # Print working directory (remote)
lpwd                         # Print working directory (local)
ls                           # List files (remote)
!ls                          # List files (local)
cd directory                 # Change directory (remote)
lcd directory                # Change directory (local)

Transfer:
get file                     # Download file
put file                     # Upload file
mget *.txt                   # Download multiple files
mput *.txt                   # Upload multiple files

Transfer Mode:
binary                       # Set binary mode (recommended)
ascii                        # Set ASCII mode (text only)
hash                         # Show progress with # marks
prompt                       # Toggle prompting for multiple files

File Management:
delete file                  # Delete remote file
mdelete *.tmp               # Delete multiple remote files
mkdir directory             # Create remote directory
rmdir directory             # Remove remote directory
rename old new              # Rename remote file

Information:
status                       # Show connection status
system                       # Show remote system type
size file                    # Show file size
help                         # Show help

### vsftpd.conf Essential Settings

# Access Control
anonymous_enable=NO          # Disable anonymous access
local_enable=YES             # Allow local user login
write_enable=YES             # Allow uploads/modifications

# Security
chroot_local_user=YES        # Jail users in home directory
allow_writeable_chroot=YES   # Allow writable chroot
ssl_enable=YES               # Enable FTPS (if using SSL)

# Passive Mode
pasv_enable=YES              # Enable passive mode
pasv_min_port=10000          # Passive mode min port
pasv_max_port=10100          # Passive mode max port
pasv_address=203.0.113.50    # Public IP for passive mode

# Limits
max_clients=50               # Max simultaneous connections
max_per_ip=5                 # Max connections per IP

# Logging
xferlog_enable=YES           # Enable transfer logging
log_ftp_protocol=YES         # Log FTP commands

# Banner
ftpd_banner=Welcome to FTP   # Custom welcome message

# Timeouts
idle_session_timeout=600     # Idle timeout (seconds)
data_connection_timeout=120  # Data timeout (seconds)

### Common Port Numbers

Port 21  - FTP Control Connection
Port 20  - FTP Data Connection (Active Mode)
Port 22  - SSH/SFTP
Port 990 - FTPS (Implicit SSL)
Ports 10000-10100 - FTP Passive Mode (configurable)

### Firewall Configuration Quick Commands

CentOS/RHEL (firewalld):
sudo firewall-cmd --permanent --add-service=ftp
sudo firewall-cmd --permanent --add-port=10000-10100/tcp
sudo firewall-cmd --reload

Ubuntu (ufw):
sudo ufw allow 21/tcp
sudo ufw allow 10000:10100/tcp
sudo ufw reload

iptables:
sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 10000:10100 -j ACCEPT
sudo iptables-save > /etc/iptables/rules.v4

### Troubleshooting Quick Commands

Check if FTP service is running:
systemctl status vsftpd

Check if port 21 is listening:
netstat -tuln | grep :21
ss -tuln | grep :21

Test FTP connection:
telnet server.example.com 21
curl ftp://server.example.com

Check logs:
tail -f /var/log/vsftpd.log
tail -f /var/log/secure
journalctl -u vsftpd -f

Check firewall:
firewall-cmd --list-all
iptables -L -n -v

Check SELinux:
getenforce
getsebool -a | grep ftp

Test network connectivity:
ping server.example.com
traceroute server.example.com

---

## 13. Summary & Best Practices

### FTP Summary

What is FTP?
- File Transfer Protocol
- Standard network protocol for transferring files
- Client-server architecture
- Uses port 21 (control) and port 20 (data)
- Invented in 1971, still widely used today

FTP Components:
1. FTP Server (vsftpd, ProFTPD, etc.)
2. FTP Client (command-line, FileZilla, WinSCP)
3. Control Connection (commands)
4. Data Connection (file transfer)

FTP Modes:
- Active Mode: Server initiates data connection to client
- Passive Mode: Client initiates both connections (firewall-friendly)

### When to Use FTP

✅ Use FTP When:
- Internal network file transfers (behind firewall)
- Legacy system compatibility required
- Maximum transfer speed needed (no encryption overhead)
- Simple file sharing within trusted network

❌ DON'T Use FTP When:
- Transferring over public internet (use SFTP/FTPS)
- Handling sensitive data (use SFTP/FTPS)
- Compliance required (PCI-DSS, HIPAA, GDPR)
- Security is a concern (use SFTP/FTPS)

### Key Takeaways

1. **FTP is NOT secure** - use SFTP or FTPS for internet transfers
2. **Passive mode is more firewall-friendly** than active mode
3. **Always use binary mode** for reliable transfers
4. **Disable anonymous access** unless specifically needed
5. **Implement chroot jails** to restrict user access
6. **Enable logging** for security audits
7. **Use fail2ban** to prevent brute force attacks
8. **Keep software updated** for security patches
9. **Test from both internal and external networks**
10. **Monitor logs regularly** for suspicious activity

### Evolution of File Transfer

1971-1985: FTP invented and standardized
1995-2005: FTP widely used for web hosting, file sharing
1999: SFTP introduced (SSH File Transfer Protocol)
2005: FTPS standardized (FTP over SSL/TLS)
2010-Present: Cloud storage solutions emerge (Dropbox, Google Drive, S3)
2015-Present: API-based transfers become common
2020-Present: SFTP preferred, FTP declining

### Modern Recommendations

For New Implementations:
1st Choice: SFTP (secure, simple, firewall-friendly)
2nd Choice: HTTPS/REST API (web-based, modern)
3rd Choice: Cloud Storage (S3, Google Cloud Storage, Azure Blob)
4th Choice: FTPS (if FTP compatibility required)
Last Resort: FTP (only for internal trusted networks)

### Final Checklist

Before Deploying FTP Server:
□ Disable anonymous access
□ Enable chroot jail
□ Configure strong passwords
□ Set up fail2ban
□ Configure firewall rules
□ Enable detailed logging
□ Test from multiple networks
□ Document configuration
□ Set up monitoring/alerts
□ Plan backup strategy
□ Review security compliance
□ Train users on proper usage

---

## Conclusion

FTP (File Transfer Protocol) has been a cornerstone of internet file transfers for over 50 years. While it's simple and efficient, its lack of security makes it unsuitable for modern internet use.

Key Points to Remember:
✓ FTP = Simple but insecure (use internally only)
✓ SFTP = Secure, recommended for internet transfers
✓ FTPS = FTP with SSL/TLS encryption
✓ Always use binary mode for reliable transfers
✓ Passive mode is more firewall-friendly
✓ Security should be your top priority

For modern deployments, consider SFTP, cloud storage solutions, or API-based transfers instead of plain FTP. If you must use FTP, implement it only on internal trusted networks behind a VPN or firewall.

Remember: Security is not optional - it's essential!

---

## Additional Resources

Official Documentation:
- vsftpd: https://security.appspot.com/vsftpd.html
- OpenSSH/SFTP: https://www.openssh.com/
- RFC 959 (FTP): https://tools.ietf.org/html/rfc959

Recommended Tools:
- FileZilla (GUI FTP/SFTP client): https://filezilla-project.org/
- WinSCP (Windows SFTP client): https://winscp.net/
- Cyberduck (Mac/Windows): https://cyberduck.io/

Security Tools:
- fail2ban: https://www.fail2ban.org/
- OpenSSL: https://www.openssl.org/
- Let's Encrypt (Free SSL): https://letsencrypt.org/

Learning Resources:
- Linux Academy: https://linuxacademy.com/
- Red Hat Documentation: https://access.redhat.com/
- DigitalOcean Tutorials: https://www.digitalocean.com/community/tutorials

---

## Author Information
Based on tutorial by: Imran Afzal
Website: www.utclisolutions.com

This comprehensive guide covers FTP from basic concepts to advanced troubleshooting. Use it as a reference for daily operations, security hardening, and problem-solving.

For questions, updates, or additional tutorials, visit the website!

---
END OF FTP GUIDE
---
