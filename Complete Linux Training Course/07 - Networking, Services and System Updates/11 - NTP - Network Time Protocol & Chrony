# NTP and chronyd - Complete Guide to Time Synchronization

## Table of Contents
1. [Introduction to Time Synchronization](#introduction)
2. [NTP (Network Time Protocol)](#ntp)
3. [chronyd (Chrony)](#chronyd)
4. [NTP vs chronyd Comparison](#comparison)
5. [Daily Use Cases](#daily-use-cases)
6. [Real-Life Examples](#real-life-examples)
7. [Configuration Examples](#configuration-examples)
8. [Troubleshooting](#troubleshooting)
9. [Best Practices](#best-practices)

---

## 1. Introduction to Time Synchronization

### Why is Time Synchronization Important?

Time synchronization ensures all computers in a network have the same accurate time. This is critical for:

1. **Log File Analysis**: Correlate events across multiple servers
2. **Security**: SSL/TLS certificates have validity periods
3. **Authentication**: Kerberos requires time sync (max 5 min difference)
4. **Database Transactions**: Timestamp accuracy for data integrity
5. **Distributed Systems**: Coordination between microservices
6. **Compliance**: Legal and audit requirements
7. **Scheduled Tasks**: Cron jobs running at correct times
8. **File Systems**: Accurate file modification times

### What Happens When Time is Wrong?

Problem Examples:
- SSL/TLS handshake failures (certificate not valid yet/expired)
- Kerberos authentication fails
- Database replication issues
- Logs show events in wrong order
- Scheduled backups run at wrong time
- Two-factor authentication codes don't work
- Email timestamps are incorrect
- Cloud services reject API requests

---

## 2. NTP (Network Time Protocol)

### What is NTP?

- **NTP** = Network Time Protocol
- Internet protocol for time synchronization
- Synchronizes computer clocks over packet-switched networks
- RFC 5905 standard
- Uses UDP port 123
- Can achieve millisecond accuracy over internet
- Microsecond accuracy on LANs
- First developed in 1985, still widely used

### How NTP Works

1. **Client sends request** to NTP server with timestamp
2. **Server receives request**, records receive time
3. **Server sends reply** with:
   - Original client timestamp (t1)
   - Server receive timestamp (t2)
   - Server transmit timestamp (t3)
4. **Client receives reply**, records receive time (t4)
5. **Client calculates**:
   - Offset: Time difference between client and server
   - Delay: Round-trip network delay
6. **Client adjusts** system clock gradually (slewing)

### NTP Components

Package Name: ntp (older systems)
Daemon: ntpd
Configuration File: /etc/ntp.conf
Service Control: systemctl restart ntpd
Query Command: ntpq
Status Command: ntpstat
Date Command: ntpdate (deprecated, use ntpd -q)

### NTP Configuration File: /etc/ntp.conf

Basic configuration structure:

# NTP Servers (pool of servers for redundancy)
server 0.centos.pool.ntp.org iburst
server 1.centos.pool.ntp.org iburst
server 2.centos.pool.ntp.org iburst
server 3.centos.pool.ntp.org iburst

# Allow only time queries from localhost
restrict default nomodify notrap nopeer noquery
restrict 127.0.0.1
restrict ::1

# Drift file (tracks clock drift over time)
driftfile /var/lib/ntp/drift

# Log file
logfile /var/log/ntp.log

Configuration Options Explained:

iburst: Send burst of 8 packets initially (faster sync)
server: Specify NTP server to sync with
pool: Use pool of servers (round-robin)
restrict: Access control rules
driftfile: Stores frequency offset (helps maintain accuracy)
nomodify: Don't allow time/config changes
notrap: Disable trap service (remote logging)
nopeer: Don't allow peering
noquery: Don't allow status queries

### NTP Commands

#### 1. Install NTP
# RHEL/CentOS 6 and older
sudo yum install ntp

# Check if installed
rpm -qa | grep ntp

#### 2. Start/Stop/Restart NTP Service
# Start NTP daemon
sudo systemctl start ntpd

# Stop NTP daemon
sudo systemctl stop ntpd

# Restart NTP daemon
sudo systemctl restart ntpd

# Enable at boot
sudo systemctl enable ntpd

# Check status
sudo systemctl status ntpd

#### 3. Check NTP Synchronization Status
# Query NTP daemon
ntpq -p

Output explanation:
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
*time.server.com .GPS.            1 u   64   64  377    12.345   -0.123   0.456

* = Currently synced to this server
+ = Good server, alternative candidate
- = Server discarded by clustering algorithm
x = Server discarded as false ticker
. = Server discarded due to high stratum

remote: NTP server hostname
refid: Reference ID (upstream server)
st: Stratum (distance from reference clock)
t: Type (u=unicast, b=broadcast, l=local)
when: Seconds since last response
poll: Polling interval (seconds)
reach: Octal bitmask of success/failures (377 = all successful)
delay: Round-trip time (milliseconds)
offset: Time difference (milliseconds)
jitter: Dispersion (variability in offset)

#### 4. Check Detailed NTP Status
# Verbose query
ntpq -c associations
ntpq -c peers
ntpq -c sysinfo

# Check synchronization status
ntpstat

Output:
synchronised to NTP server (10.0.0.1) at stratum 3
   time correct to within 42 ms
   polling server every 64 s

#### 5. Force Immediate Sync (one-time)
# Stop ntpd first
sudo systemctl stop ntpd

# One-time sync
sudo ntpdate -u time.nist.gov

# Start ntpd again
sudo systemctl start ntpd

#### 6. Check Current System Time
# Display current date and time
date

# Display in UTC
date -u

# Check hardware clock
hwclock --show

# Sync system time to hardware clock
sudo hwclock --systohc

#### 7. Monitor NTP in Real-Time
# Watch NTP status (updates every 2 seconds)
watch -n 2 'ntpq -p'

#### 8. Check NTP Logs
# View NTP log file
sudo tail -f /var/log/ntp.log

# Check system log for NTP messages
sudo journalctl -u ntpd -f

### NTP Stratum Levels

Stratum 0: Reference clock (atomic clock, GPS)
Stratum 1: Primary time servers (directly connected to stratum 0)
Stratum 2: Secondary time servers (sync from stratum 1)
Stratum 3: Tertiary servers (sync from stratum 2)
...
Stratum 16: Unsynchronized

Best Practice: Use Stratum 2 or 3 servers for most applications

---

## 3. chronyd (Chrony)

### What is chronyd?

- **chronyd** = Modern replacement for NTP
- Developed for systems with intermittent network
- Better performance than traditional NTP
- Default time sync tool in RHEL/CentOS 7+
- Faster synchronization (especially after long offline periods)
- Lower resource usage
- Better handling of time jumps
- Works well in virtual machines

### Advantages of chronyd over NTP

1. **Faster Sync**: Typically syncs in minutes vs hours for NTP
2. **Better for Laptops**: Handles suspend/resume gracefully
3. **Virtual Machine Friendly**: Adapts to VM time changes
4. **Intermittent Network**: Works well with occasional connectivity
5. **Lower Jitter**: More stable timekeeping
6. **Simpler Configuration**: Easier to set up
7. **Less Resources**: Lower CPU and memory usage

### chronyd Components

Package Name: chrony
Daemon: chronyd
Configuration File: /etc/chronyd.conf (or /etc/chrony.conf)
Log File: /var/log/chrony
Service Control: systemctl start/restart chronyd
Client Command: chronyc

### chronyd Configuration File: /etc/chronyd.conf

Basic configuration:

# NTP Servers
server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst
server 3.pool.ntp.org iburst

# Or use pool (recommended)
pool pool.ntp.org iburst maxsources 4

# Record drift to file
driftfile /var/lib/chrony/drift

# Allow system clock to be stepped in first three updates
makestep 1.0 3

# Enable kernel synchronization of RTC
rtcsync

# Specify directory for log files
logdir /var/log/chrony

# Select which IPs/subnets can access
allow 192.168.1.0/24

# Serve time even if not synchronized
local stratum 10

Configuration Options Explained:

server: Single NTP server
pool: Pool of NTP servers (better redundancy)
iburst: Start with burst of 4 packets (faster sync)
maxsources: Max number of servers from pool to use
driftfile: Stores clock drift rate
makestep: Step clock if off by more than X seconds in first Y updates
rtcsync: Keep RTC (hardware clock) in sync
allow: Allow NTP clients from this network
deny: Deny NTP clients from this network
local: Act as local reference (even if no upstream sync)
stratumweight: How much to prefer lower stratum servers

### chronyd Commands

#### 1. Install chronyd
# RHEL/CentOS 7+
sudo yum install chrony

# Ubuntu/Debian
sudo apt install chrony

# Check if installed
rpm -qa | grep chrony

#### 2. Start/Stop/Restart chronyd Service
# Start chronyd
sudo systemctl start chronyd

# Stop chronyd
sudo systemctl stop chronyd

# Restart chronyd
sudo systemctl restart chronyd

# Enable at boot
sudo systemctl enable chronyd

# Check status
sudo systemctl status chronyd

Output:
● chronyd.service - NTP client/server
   Loaded: loaded (/usr/lib/systemd/system/chronyd.service; enabled)
   Active: active (running) since Mon 2025-11-24 10:00:00 UTC; 2h ago
   Main PID: 1234 (chronyd)
   CGroup: /system.slice/chronyd.service
           └─1234 /usr/sbin/chronyd

#### 3. Check chronyd Status (using chronyc)
# Access chronyc interactive mode
chronyc

# Or run single command
chronyc tracking

Output:
Reference ID    : A29FC87B (time.server.com)
Stratum         : 3
Ref time (UTC)  : Mon Nov 24 10:30:15 2025
System time     : 0.000012345 seconds fast of NTP time
Last offset     : +0.000001234 seconds
RMS offset      : 0.000123456 seconds
Frequency       : 5.432 ppm slow
Residual freq   : +0.001 ppm
Skew            : 0.123 ppm
Root delay      : 0.012345678 seconds
Root dispersion : 0.001234567 seconds
Update interval : 64.5 seconds
Leap status     : Normal

Explanation:
Reference ID: Current NTP server being used
Stratum: Distance from reference clock
System time: How far off from true time
Last offset: Last correction made
RMS offset: Root Mean Square offset (accuracy indicator)
Frequency: Rate at which system clock gains/loses time
Update interval: How often checking with server

#### 4. View NTP Sources
# Show all time sources
chronyc sources

Output:
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^* time1.google.com              1   6   377    32   +123us[ +456us] +/-   12ms
^- time2.google.com              1   6   377    33   -234us[ -567us] +/-   15ms
^+ time3.google.com              1   6   377    34   +345us[ +678us] +/-   13ms

Symbols:
* = Current best source
+ = Good and combined with best source
- = Not combined (excluded by algorithm)
? = Lost connectivity
x = False ticker (time is wrong)
~ = Too variable

Columns:
Stratum: Distance from reference clock
Poll: Polling interval (log2 seconds, 6 = 64 seconds)
Reach: Reachability register (octal, 377 = all 8 attempts succeeded)
LastRx: Time since last response (seconds)
Last sample: Offset between local and remote clock

#### 5. View Detailed Source Information
# Verbose source info
chronyc sourcestats

Output:
Name/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev
===============================================================================
time1.google.com           18  10   276     +0.123      0.456  +123us   234us
time2.google.com           16   8   245     -0.234      0.567  -234us   345us

NP: Number of sample points
NR: Number of runs of residuals
Span: Interval between first and last sample
Frequency: Estimated drift rate (ppm)
Freq Skew: Estimated error in frequency
Offset: Current estimated offset
Std Dev: Standard deviation of offset

#### 6. Force Immediate Synchronization
# Force sync (requires restart)
sudo chronyc -a makestep

# Or burst mode (send extra packets)
sudo chronyc -a burst 4/4

#### 7. Check if chronyd is Active
# Check activity
chronyc activity

Output:
200 OK
6 sources online
0 sources offline
0 sources doing burst (return to online)
0 sources doing burst (return to offline)
0 sources with unknown address

#### 8. Monitor Real-Time Tracking
# Watch tracking info (updates)
watch -n 1 'chronyc tracking'

#### 9. Check chronyd Logs
# View log file
sudo tail -f /var/log/chrony/tracking.log

# Check system journal
sudo journalctl -u chronyd -f

# Check last sync
sudo journalctl -u chronyd | grep "Selected source"

#### 10. Configure chronyd as NTP Server
# Edit config to allow clients
sudo vi /etc/chronyd.conf

# Add these lines:
allow 192.168.1.0/24
local stratum 10

# Restart service
sudo systemctl restart chronyd

# Open firewall
sudo firewall-cmd --add-service=ntp --permanent
sudo firewall-cmd --reload

#### 11. Test NTP Server from Client
# From client machine
chronyc -h your-server-ip -n tracking

#### 12. Manual Time Commands
# Set system time manually (if needed)
sudo timedatectl set-time '2025-11-24 10:30:00'

# Disable NTP (to set manual time)
sudo timedatectl set-ntp false

# Enable NTP
sudo timedatectl set-ntp true

# Check time settings
timedatectl

Output:
               Local time: Mon 2025-11-24 10:30:00 UTC
           Universal time: Mon 2025-11-24 10:30:00 UTC
                 RTC time: Mon 2025-11-24 10:30:00
                Time zone: UTC (UTC, +0000)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no

---

## 4. NTP vs chronyd Comparison

| Feature | NTP (ntpd) | chronyd |
|---------|-----------|---------|
| **Age** | Older, since 1985 | Newer, since 2003 |
| **Default in** | RHEL/CentOS 6 and older | RHEL/CentOS 7+ |
| **Sync Speed** | Slower (hours) | Faster (minutes) |
| **Accuracy** | High | Higher |
| **Resource Usage** | Moderate | Low |
| **VM Support** | Poor | Excellent |
| **Laptops** | Poor (needs constant connection) | Excellent (handles suspend) |
| **Complex Config** | More options | Simpler |
| **Community** | Larger (older) | Growing |
| **Use Case** | Servers with constant internet | Modern systems, VMs, laptops |

### When to Use NTP (ntpd)?
- Legacy systems (RHEL/CentOS 6 or older)
- Strict compliance requirements for ntpd
- Need ntpd-specific features
- Large existing ntpd infrastructure

### When to Use chronyd?
- RHEL/CentOS 7 or newer (default)
- Virtual machines
- Laptops or intermittent connectivity
- Need faster synchronization
- Modern deployments (recommended)

---

## 5. Daily Use Cases

### Use Case 1: Server Time Synchronization

Scenario: You have 50 production servers that need accurate time

Solution using chronyd:

# On all servers, install chronyd
sudo yum install chrony -y

# Configure to use company NTP server
sudo vi /etc/chronyd.conf
# Add:
pool company-ntp.internal.com iburst maxsources 2
pool pool.ntp.org iburst maxsources 2

# Start and enable
sudo systemctl enable chronyd --now

# Verify synchronization
chronyc tracking
chronyc sources

# Automate verification (monitoring script)
#!/bin/bash
# check-time-sync.sh
OFFSET=$(chronyc tracking | grep "System time" | awk '{print $4}')
if (( $(echo "$OFFSET > 0.1" | bc -l) )); then
  echo "WARNING: Time offset is $OFFSET seconds" | mail -s "Time Sync Alert" admin@company.com
fi

# Add to cron (check every hour)
0 * * * * /usr/local/bin/check-time-sync.sh

Real-Life Benefit:
- All log timestamps match across servers
- Database replication works correctly
- SSL certificates validate properly
- Troubleshooting is easier

### Use Case 2: Kerberos Authentication

Scenario: Active Directory authentication failing

Problem:
$ kinit user@DOMAIN.COM
kinit: Clock skew too great while getting initial credentials

Diagnosis:
# Check time difference
date && ssh ad-server.com date

Output shows 10 minute difference!

Solution:
# Sync time immediately
sudo systemctl stop chronyd
sudo chronyd -q 'server ad-server.com iburst'
sudo systemctl start chronyd

# Verify sync
chronyc tracking

# Configure permanent sync to AD servers
sudo vi /etc/chronyd.conf
server ad-server1.company.com iburst
server ad-server2.company.com iburst
server ad-server3.company.com iburst

sudo systemctl restart chronyd

# Test Kerberos again
kinit user@DOMAIN.COM
# Success!

Real-Life Impact:
- Users can log in again
- SSO (Single Sign-On) works
- File shares accessible
- Email clients authenticate

### Use Case 3: Certificate Validation Issues

Scenario: HTTPS website showing certificate errors

Problem:
$ curl https://your-website.com
curl: (60) SSL certificate problem: certificate is not yet valid

Diagnosis:
# Check system time
date
Output: Wed Nov 20 10:00:00 UTC 2025

# Certificate valid from Nov 24, 2025
# System clock is 4 days behind!

Solution:
# Check NTP sync status
chronyc tracking
Output: Not synchronized

# Check sources
chronyc sources
Output: All sources show '?' (lost connectivity)

# Check network to NTP servers
ping pool.ntp.org
# Not reachable - firewall blocking!

# Update firewall
sudo firewall-cmd --add-service=ntp --permanent
sudo firewall-cmd --reload

# Force sync
sudo chronyc -a makestep
sudo systemctl restart chronyd

# Verify
chronyc tracking
date
Output: Mon Nov 24 10:00:00 UTC 2025

# Test website again
curl https://your-website.com
# Success!

Real-Life Impact:
- Website accessible
- API calls work
- Mobile apps connect
- Business operations resume

### Use Case 4: Multi-Region Database Replication

Scenario: Database replication showing conflicts

Problem: Database replication between US and EU data centers has conflicts

Diagnosis:
# Check time on US server
ssh us-db-server date
Mon Nov 24 10:00:00 EST 2025

# Check time on EU server
ssh eu-db-server date
Mon Nov 24 15:05:00 GMT 2025
# Should be 15:00:00 (5 hour difference)
# 5 minutes ahead!

Solution:
# On EU server
ssh eu-db-server

# Check chronyd status
chronyc tracking
Output: System time: 5.123 seconds fast of NTP time
# Way out of sync!

# Check why not correcting
chronyc sources
Output: All sources marked with 'x' (false ticker)

# Issue: Local server was set as reference, overriding NTP
vi /etc/chronyd.conf
# Remove or comment out:
# local stratum 10

# Add proper NTP sources
pool pool.ntp.org iburst maxsources 4
makestep 1 3

# Restart and force correction
systemctl restart chronyd
chronyc -a makestep

# Verify
date
Mon Nov 24 15:00:00 GMT 2025
# Correct!

# Check replication status
mysql -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master"
Seconds_Behind_Master: 0
# Replication healthy!

Real-Life Impact:
- Data consistency restored
- No more conflict resolution needed
- Reports show correct data
- Business decisions based on accurate data

### Use Case 5: Log Aggregation and Analysis

Scenario: Troubleshooting distributed application issue

Problem: Trying to trace a failed transaction across microservices

Without Time Sync:
# Web Server Log (time: 10:00:30)
2025-11-24 10:00:30 [INFO] Request received: transaction_id=12345

# API Server Log (time: 10:02:15 - 2 min ahead!)
2025-11-24 10:02:15 [INFO] Processing transaction_id=12345
2025-11-24 10:02:16 [ERROR] Database timeout

# Database Server Log (time: 09:58:45 - 2 min behind!)
2025-11-24 09:58:45 [WARN] Connection pool exhausted

Analysis Challenge: Which event happened first? Impossible to determine!

Solution: Sync all servers

# Deploy chronyd to all microservices
ansible all -m yum -a "name=chrony state=present"
ansible all -m systemd -a "name=chronyd state=started enabled=yes"

# Verify sync on all servers
ansible all -m shell -a "chronyc tracking | grep 'System time'"

With Time Sync:
# Web Server Log
2025-11-24 10:00:30.123 [INFO] Request received: transaction_id=12345

# Database Server Log
2025-11-24 10:00:31.456 [WARN] Connection pool exhausted

# API Server Log
2025-11-24 10:00:32.789 [INFO] Processing transaction_id=12345
2025-11-24 10:00:35.012 [ERROR] Database timeout

Analysis: Clear sequence!
1. Request arrives (10:00:30.123)
2. Database pool exhausted BEFORE API tries to connect (10:00:31.456)
3. API attempts processing (10:00:32.789)
4. API times out due to no DB connections (10:00:35.012)

Root Cause: Database connection pool too small, not API issue!

Real-Life Impact:
- Correct root cause identified
- Fix applied to database config, not API
- Saves hours of debugging
- Prevents wrong solution

### Use Case 6: Scheduled Backups Coordination

Scenario: Distributed backup system

Problem: Backups running at wrong times, causing performance issues

Current Situation:
# Backup script runs at 2:00 AM
0 2 * * * /usr/local/bin/backup.sh

# Server 1 (time: 02:00:00) - Correct
[2025-11-24 02:00:00] Backup started

# Server 2 (time: 02:15:00) - 15 minutes ahead!
[2025-11-24 02:15:00] Backup started (during business hours in Asia!)

# Server 3 (time: 01:45:00) - 15 minutes behind!
[2025-11-24 01:45:00] Backup started (before daily processing completes!)

Impact: Inconsistent backups, performance issues

Solution:
# Implement chronyd on all backup servers
for server in backup-server-{1..20}; do
  ssh $server "
    yum install -y chrony
    cat > /etc/chronyd.conf <<EOF
pool pool.ntp.org iburst maxsources 4
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync
EOF
    systemctl enable chronyd --now
  "
done

# Verify all servers synced
for server in backup-server-{1..20}; do
  echo -n "$server: "
  ssh $server "date -u"
done

# All show same time!
backup-server-1: Mon Nov 24 02:00:00 UTC 2025
backup-server-2: Mon Nov 24 02:00:00 UTC 2025
backup-server-3: Mon Nov 24 02:00:00 UTC 2025

Real-Life Impact:
- Backups run at correct time
- No business hour interruptions
- Complete data capture
- Coordinated backup workflow

### Use Case 7: Security Event Correlation

Scenario: Security incident investigation

Problem: Potential security breach, need to correlate firewall, IDS, and application logs

Without Time Sync:
# Firewall Log (time drift: +30 seconds)
2025-11-24 03:15:30 ALERT: Multiple failed SSH attempts from 203.0.113.50

# IDS Log (time drift: -45 seconds)
2025-11-24 03:14:15 WARNING: Port scan detected from 203.0.113.50

# Application Log (time drift: +10 seconds)
2025-11-24 03:15:10 ERROR: Authentication failure for user 'admin'

Timeline Analysis: Confusing! Did port scan happen before or after SSH attempts?

Solution: Implement chronyd on all security infrastructure

# Security servers config
sudo vi /etc/chronyd.conf
# Use multiple reliable sources for critical systems
server time.nist.gov iburst
server time.google.com iburst
server time.cloudflare.com iburst
pool pool.ntp.org iburst maxsources 2

# Strict time accuracy
makestep 0.1 1
maxdistance 0.05

sudo systemctl restart chronyd

# Monitor time accuracy strictly
# /usr/local/bin/security-time-monitor.sh
#!/bin/bash
OFFSET=$(chronyc tracking | grep "System time" | awk '{print $4}')
if (( $(echo "$OFFSET > 0.01" | bc -l) )); then
  logger -p security.alert "CRITICAL: Time drift $OFFSET seconds on $(hostname)"
  echo "CRITICAL: Time drift on $(hostname)" | mail -s "Time Sync Security Alert" security@company.com
fi

# Run every 5 minutes
*/5 * * * * /usr/local/bin/security-time-monitor.sh

With Time Sync:
# IDS Log
2025-11-24 03:15:00.123 WARNING: Port scan detected from 203.0.113.50

# Firewall Log
2025-11-24 03:15:05.456 ALERT: Multiple failed SSH attempts from 203.0.113.50

# Application Log
2025-11-24 03:15:08.789 ERROR: Authentication failure for user 'admin'

Timeline Analysis: Clear attack sequence!
1. Port scan to find open ports (03:15:00)
2. SSH brute force attempt (03:15:05)
3. Application login attempt (03:15:08)

Real-Life Impact:
- Accurate incident timeline
- Proper forensic analysis
- Legal evidence validity
- Effective security response

### Use Case 8: Financial Transaction Processing

Scenario: Stock trading platform

Problem: Transaction timestamps must be exact for regulatory compliance

Requirements:
- Timestamps accurate to milliseconds
- All servers synchronized
- Audit trail for compliance
- No time jumps during trading hours

Solution: High-accuracy chronyd configuration

# Install chrony on all trading servers
sudo yum install -y chrony

# High-accuracy configuration
sudo vi /etc/chronyd.conf

# Use Stratum 1 servers (most accurate)
server time.nist.gov iburst minpoll 4 maxpoll 6
server time.google.com iburst minpoll 4 maxpoll 6
server ntp1.your-exchange.com iburst minpoll 4 maxpoll 6
server ntp2.your-exchange.com iburst minpoll 4 maxpoll 6

# Aggressive sync for accuracy
minpoll 4    # Poll every 16 seconds
maxpoll 6    # Maximum 64 seconds

# Don't step clock during trading hours
# Use script to only allow stepping outside market hours

# Strict logging
log tracking measurements statistics

# Enable RTC sync
rtcsync

# Low jitter tolerance
maxdistance 0.01

sudo systemctl restart chronyd

# Monitor accuracy continuously
watch -n 1 'chronyc tracking | grep -E "System time|RMS offset"'

# Automated compliance report
#!/bin/bash
# /usr/local/bin/time-compliance-report.sh
DATE=$(date +%Y-%m-%d)
REPORT="/var/log/time-compliance-$DATE.log"

echo "Time Synchronization Compliance Report - $DATE" > $REPORT
echo "================================================" >> $REPORT
echo "" >> $REPORT

for server in trading-{1..10}; do
  echo "Server: $server" >> $REPORT
  ssh $server "chronyc tracking" >> $REPORT
  echo "" >> $REPORT
done

# Email to compliance team
mail -s "Daily Time Sync Compliance Report" compliance@company.com < $REPORT

# Run daily at midnight
0 0 * * * /usr/local/bin/time-compliance-report.sh

Real-Life Impact:
- Regulatory compliance maintained
- Accurate trade execution timestamps
- Legal protection
- Customer trust
- Avoid millions in fines

---

## 6. Real-Life Examples & Scenarios

### Example 1: Startup - Small Team

Scenario: 5-person startup, 3 servers (web, api, database)

Simple chronyd Setup:

# On all 3 servers
sudo yum install -y chrony

# Use default public pools (simple, reliable)
sudo vi /etc/chronyd.conf
pool pool.ntp.org iburst maxsources 4
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

# Start service
sudo systemctl enable chronyd --now

# Verify (takes 1-2 minutes)
chronyc tracking

That's it! Simple and effective.

### Example 2: Medium Company - Internal NTP Server

Scenario: 200 servers, want internal time source

Architecture:
- 2 internal NTP servers (redundancy)
- All other servers sync to internal NTP
- Internal NTP syncs to internet NTP

Setup NTP Server (on 2 designated servers):

# Install chronyd on ntp1.company.com and ntp2.company.com
sudo yum install -y chrony

# Configure as NTP server
sudo vi /etc/chronyd.conf

# Sync to public pools
pool pool.ntp.org iburst maxsources 4
pool time.google.com iburst maxsources 2

# Allow clients from internal network
allow 10.0.0.0/8

# Serve time even if upstream is lost (become authoritative)
local stratum 10

# Logging
log tracking measurements statistics
logdir /var/log/chrony

# High availability
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

sudo systemctl enable chronyd --now

# Open firewall
sudo firewall-cmd --add-service=ntp --permanent
sudo firewall-cmd --reload

Setup Clients (on 198 other servers):

# Configure clients to use internal NTP
sudo vi /etc/chronyd.conf

# Use internal NTP servers
server ntp1.company.com iburst
server ntp2.company.com iburst

# Fallback to public if internal fails
pool pool.ntp.org iburst maxsources 2

driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

sudo systemctl restart chronyd

# Verify
chronyc sources -v

Benefits:
- Reduced internet bandwidth
- Faster sync (LAN vs WAN)
- Consistent time source
- Works if internet is down
- Better control and monitoring

### Example 3: Enterprise - Global Infrastructure

Scenario: Multinational company, 5000+ servers, multiple data centers

Architecture:
- Stratum 1: GPS/Atomic clock in each datacenter
- Stratum 2: 4 NTP servers per datacenter (sync to Stratum 1)
- Stratum 3: All other servers (sync to Stratum 2)

Datacenter 1 (Primary):

# Stratum 1 (GPS-based NTP appliance)
# IP: 10.1.1.10 (hardware appliance, pre-configured)

# Stratum 2 Servers (ntp1-4.dc1.company.com)
sudo vi /etc/chronyd.conf

# Primary: Internal GPS clock
server 10.1.1.10 iburst prefer
# Backup: Other datacenter Stratum 1
server 10.2.1.10 iburst
server 10.3.1.10 iburst
# External backup
pool pool.ntp.org iburst maxsources 2

# Allow datacenter network
allow 10.1.0.0/16

# Local reference if all upstream fail
local stratum 5

driftfile /var/lib/chrony/drift
makestep 0.1 1
rtcsync

log tracking measurements statistics
logdir /var/log/chrony

# Stratum 3 (All application servers)
sudo vi /etc/chronyd.conf

# Use local datacenter NTP servers
pool ntp.dc1.company.com iburst maxsources 4

# Backup: Another datacenter
pool ntp.dc2.company.com iburst maxsources 2

driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

# Automated deployment via Ansible
# /etc/ansible/playbooks/deploy-chrony.yml

---
- name: Deploy chronyd to all servers
  hosts: all
  tasks:
    - name: Install chrony
      yum:
        name: chrony
        state: present

    - name: Deploy chrony config
      template:
        src: chronyd.conf.j2
        dest: /etc/chronyd.conf
      notify: restart chronyd

    - name: Enable and start chronyd
      systemd:
        name: chronyd
        state: started
        enabled: yes

  handlers:
    - name: restart chronyd
      systemd:
        name: chronyd
        state: restarted

# Template: /etc/ansible/templates/chronyd.conf.j2
{% if inventory_hostname in groups['ntp_servers'] %}
# NTP Server configuration
server 10.{{ datacenter }}.1.10 iburst prefer
pool pool.ntp.org iburst maxsources 4
allow 10.{{ datacenter }}.0.0/16
local stratum 5
{% else %}
# NTP Client configuration
pool ntp.dc{{ datacenter }}.company.com iburst maxsources 4
{% endif %}

driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync
logdir /var/log/chrony

# Deploy to all servers
ansible-playbook deploy-chrony.yml

# Monitoring with Nagios/Zabbix
# /usr/local/bin/check_chrony_offset.sh
#!/bin/bash
OFFSET=$(chronyc tracking | grep "System time" | awk '{print $4}' | tr -d '-')

if (( $(echo "$OFFSET > 1.0" | bc -l) )); then
  echo "CRITICAL: Time offset $OFFSET seconds"
  exit 2
elif (( $(echo "$OFFSET > 0.1" | bc -l) )); then
  echo "WARNING: Time offset $OFFSET seconds"
  exit 1
else
  echo "OK: Time offset $OFFSET seconds"
  exit 0
fi

Benefits:
- High accuracy (Stratum 1 GPS)
- Redundancy at every level
- Geographic distribution
- Automated deployment
- Centralized monitoring
- Scalable architecture

### Example 4: Cloud Environment (AWS/Azure)

Scenario: Cloud-based infrastructure

AWS Approach:

# AWS provides NTP service (Amazon Time Sync Service)
# IP: 169.254.169.123 (link-local, always accessible)

# Configure chronyd on EC2 instances
sudo vi /etc/chronyd.conf

# Use AWS Time Sync Service (Stratum 3)
server 169.254.169.123 iburst prefer

# Backup: Public pools
pool pool.ntp.org iburst maxsources 2

driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

sudo systemctl restart chronyd

# Verify
chronyc sources -v
# Should show 169.254.169.123 with * (selected)

Azure Approach:

# Azure provides time sync at host level
# Often better to use Azure's built-in sync

# Check if Azure host time sync is enabled
timedatectl

# If you need custom NTP (for compliance)
sudo vi /etc/chronyd.conf

# Use Azure-optimized public NTP
server time.windows.com iburst
pool pool.ntp.org iburst maxsources 4

driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

Google Cloud Approach:

# GCP provides metadata server for time
# IP: metadata.google.internal

sudo vi /etc/chronyd.conf

server metadata.google.internal iburst prefer
pool pool.ntp.org iburst maxsources 2

driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

# User data script (auto-configure at launch)
#!/bin/bash
yum install -y chrony
cat > /etc/chronyd.conf <<EOF
server 169.254.169.123 iburst prefer
pool pool.ntp.org iburst maxsources 2
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync
EOF
systemctl enable chronyd --now

Benefits:
- Low latency (cloud provider NTP)
- Free service
- Highly available
- Minimal configuration
- Works with auto-scaling

---

## 7. Configuration Examples

### Basic Configuration (Home Lab/Small Office)

# /etc/chronyd.conf - Simple configuration

# Use public NTP pool
pool pool.ntp.org iburst maxsources 4

# Record clock drift
driftfile /var/lib/chrony/drift

# Allow clock to be stepped on first 3 updates if off by more than 1 second
makestep 1.0 3

# Sync hardware clock
rtcsync

# Log directory
logdir /var/log/chrony

### Medium Configuration (Small Business)

# /etc/chronyd.conf - Small business configuration

# Use multiple pools for redundancy
pool pool.ntp.org iburst maxsources 2
pool time.google.com iburst maxsources 2

# Clock drift file
driftfile /var/lib/chrony/drift

# Step clock if needed in first updates
makestep 1.0 3

# Sync RTC
rtcsync

# Enable kernel RTC synchronization every 11 minutes
rtconutc

# Log files
log tracking measurements statistics
logdir /var/log/chrony

# Allow NTP clients from local network (if acting as server)
allow 192.168.1.0/24

# Fallback: serve time even if not synchronized
# (only if this is the office NTP server)
# local stratum 10

### Advanced Configuration (Enterprise)

# /etc/chronyd.conf - Enterprise NTP server configuration

# Primary time sources (mix of Stratum 1 and 2)
server time1.google.com iburst minpoll 4 maxpoll 6
server time2.google.com iburst minpoll 4 maxpoll 6
server time.nist.gov iburst minpoll 4 maxpoll 6
server time.cloudflare.com iburst minpoll 4 maxpoll 6

# Internal GPS/Atomic clock (if available)
server 10.0.0.10 iburst prefer minpoll 4 maxpoll 4

# Drift file
driftfile /var/lib/chrony/drift

# Allow stepping only on first update, only if off by more than 0.1 seconds
makestep 0.1 1

# RTC sync
rtcsync
rtconutc

# Comprehensive logging
log tracking measurements statistics refclocks
logdir /var/log/chrony
logchange 0.01

# Serve time to internal networks
allow 10.0.0.0/8
allow 172.16.0.0/12
allow 192.168.0.0/16

# Deny everyone else
deny all

# Local reference (continue serving time even if upstream fails)
local stratum 5 distance 0.1

# Rate limiting (prevent abuse)
ratelimit interval 3 burst 8

# Command port access control
bindcmdaddress 127.0.0.1
cmdallow 127.0.0.1
cmdallow 10.0.1.0/24

# Smoothing (spread leap second adjustment)
leapsecmode slew
maxslewrate 1000
smoothtime 400 0.001

### Virtual Machine Configuration

# /etc/chronyd.conf - Optimized for VMs

# VM hosts can have time jumps, chronyd handles this well
# Use quick adaptation

# NTP sources
pool pool.ntp.org iburst maxsources 4

# Drift file
driftfile /var/lib/chrony/drift

# Allow large initial correction
makestep 1.0 -1

# Sync RTC
rtcsync

# Log
logdir /var/log/chrony

### Laptop/Workstation Configuration

# /etc/chronyd.conf - Optimized for mobile devices

# Multiple pools for redundancy
pool pool.ntp.org iburst maxsources 4

# Drift file
driftfile /var/lib/chrony/drift

# Allow stepping when waking from sleep
makestep 1.0 -1

# Sync RTC
rtcsync

# Log
logdir /var/log/chrony

### High-Security Configuration (Financial/Healthcare)

# /etc/chronyd.conf - High-security configuration

# Use authenticated NTP (if available)
server secure-ntp1.company.com iburst minpoll 4 maxpoll 6 key 1
server secure-ntp2.company.com iburst minpoll 4 maxpoll 6 key 1
server secure-ntp3.company.com iburst minpoll 4 maxpoll 6 key 1

# Key file for authentication
keyfile /etc/chrony.keys
# /etc/chrony.keys format:
# 1 SHA256 HEX:0123456789ABCDEF...

# Drift file
driftfile /var/lib/chrony/drift

# Strict stepping (never allow large jumps after boot)
makestep 0.01 1

# RTC sync
rtcsync
rtconutc

# Comprehensive audit logging
log tracking measurements statistics refclocks
logdir /var/log/chrony
logchange 0.001

# No serving (client only)
deny all

# Command access (local only, specific user)
bindcmdaddress 127.0.0.1
cmdallow 127.0.0.1

# Additional security
noclientlog
clientloglimit 0

---

## 8. Troubleshooting

### Problem 1: chronyd Not Syncing

Symptoms:
chronyc tracking
# Output: Reference ID: 7F7F0101 (127.127.1.1)
# This means using local reference, not actually synced!

Diagnosis Steps:

# Step 1: Check service status
sudo systemctl status chronyd
# Is it running?

# Step 2: Check sources
chronyc sources -v
# Are any sources showing '?' or 'x'?

# Step 3: Check network connectivity
ping pool.ntp.org
# Can you reach NTP servers?

# Step 4: Check firewall
sudo firewall-cmd --list-all | grep ntp
# Is NTP traffic allowed?

# Step 5: Check NTP port
sudo netstat -tulpn | grep 123
# Or
sudo ss -tulpn | grep 123
# Should show chronyd listening on port 123

# Step 6: Test NTP manually
sudo chronyd -q 'server pool.ntp.org iburst'
# Does manual sync work?

# Step 7: Check logs
sudo journalctl -u chronyd -n 50
# Any error messages?

Solutions:

# Solution A: Network/Firewall Issue
sudo firewall-cmd --add-service=ntp --permanent
sudo firewall-cmd --reload

# Solution B: Wrong Configuration
sudo vi /etc/chronyd.conf
# Remove 'local stratum' line if present (unless you're NTP server)
# Ensure valid server/pool lines exist

sudo systemctl restart chronyd

# Solution C: Force Initial Sync
sudo systemctl stop chronyd
sudo chronyd -q 'server pool.ntp.org iburst'
sudo systemctl start chronyd

# Solution D: SELinux Blocking
sudo ausearch -m AVC -ts recent | grep chronyd
# If SELinux denials found:
sudo setsebool -P chronyd_enable_allow_online_update 1

### Problem 2: High Offset / Clock Drift

Symptoms:
chronyc tracking
# System time: 5.123 seconds fast of NTP time
# Way too much!

Diagnosis:

# Check offset trend
chronyc tracking
# Note "System time" value

# Wait 5 minutes, check again
chronyc tracking
# Is it improving or getting worse?

# Check source quality
chronyc sourcestats
# High Std Dev or Freq Skew = poor quality sources

Solutions:

# Solution A: Force Correction
sudo chronyc -a makestep

# Solution B: Better Sources
sudo vi /etc/chronyd.conf
# Replace unreliable sources
# Use pool instead of single server
pool pool.ntp.org iburst maxsources 4

# Solution C: Hardware Issue
# Check if RTC (hardware clock) is wrong
hwclock --show
date
# Big difference? Hardware clock issue

# Sync hardware clock from system time
sudo hwclock --systohc

# Or sync system time from hardware clock
sudo hwclock --hctosys

### Problem 3: chronyd Stops Working After Reboot

Symptoms: chronyd works until reboot, then fails to start

Diagnosis:

# Check if enabled
sudo systemctl is-enabled chronyd
# Should show 'enabled'

# Check boot-time errors
sudo journalctl -b | grep chronyd

# Check dependencies
sudo systemctl show chronyd | grep After
# What must start before chronyd?

Solutions:

# Solution A: Enable service
sudo systemctl enable chronyd

# Solution B: Dependency Issue
# If network not ready at chronyd start time
sudo vi /etc/systemd/system/chronyd.service.d/wait-for-network.conf
[Unit]
After=network-online.target
Wants=network-online.target

sudo systemctl daemon-reload
sudo systemctl restart chronyd

### Problem 4: "No Suitable Source" Error

Symptoms:
chronyc sources
# All sources show '?' in first column

Diagnosis:

# Check if can reach NTP servers at all
chronyc activity
# 0 sources online = problem

# Test connectivity
for server in 0.pool.ntp.org 1.pool.ntp.org 2.pool.ntp.org; do
  echo -n "Testing $server: "
  nc -vzu $server 123 2>&1 | tail -1
done

# Check DNS
nslookup pool.ntp.org

Solutions:

# Solution A: DNS Problem
# Add to /etc/hosts temporarily
echo "216.239.35.0 time.google.com" | sudo tee -a /etc/hosts

# Or use IP addresses in config
sudo vi /etc/chronyd.conf
server 216.239.35.0 iburst
server 216.239.35.4 iburst

# Solution B: Corporate Firewall
# Use internal NTP server instead
sudo vi /etc/chronyd.conf
server ntp.company.local iburst

# Solution C: Proxy Environment
# NTP doesn't work through HTTP proxy
# Need direct UDP access or internal NTP server

### Problem 5: Time Jumping/Stepping

Symptoms: System time suddenly jumps forward or backward

Diagnosis:

# Check logs for step events
sudo journalctl -u chronyd | grep -i step
# Shows when and why clock was stepped

# Check current sync status
chronyc tracking

# Check if VM host time sync is interfering
# (Common in virtual machines)
vmware-toolbox-cmd timesync status
# Or for Hyper-V/KVM, check hypervisor settings

Solutions:

# Solution A: Disable VM Host Time Sync
# VMware
vmware-toolbox-cmd timesync disable

# Hyper-V (Windows host)
# Disable "Time Synchronization" in VM settings

# KVM
# Edit VM XML, remove time sync

# Solution B: Configure Graceful Slewing
sudo vi /etc/chronyd.conf
# Don't step after boot
makestep 1.0 1
# Only step on first update if off by more than 1 second

# Use slewing for smaller adjustments
maxslewrate 1000

sudo systemctl restart chronyd

# Solution C: External Time Source Interfering
# Check if ntpd is also running (conflict!)
sudo systemctl status ntpd
# If running, disable it:
sudo systemctl stop ntpd
sudo systemctl disable ntpd

### Problem 6: Authentication Failure (NTP Servers)

Symptoms:
sudo journalctl -u chronyd | grep -i auth
# Authentication failed for NTP message

Diagnosis:

# Check if keys configured
sudo cat /etc/chrony.keys
# Should contain key definitions

# Check server requires authentication
# Most public NTP servers DON'T use authentication
# Only needed for internal corporate NTP

Solutions:

# Solution A: Remove Authentication (public servers)
sudo vi /etc/chronyd.conf
# Remove "key X" from server lines
server pool.ntp.org iburst
# NOT: server pool.ntp.org iburst key 1

# Solution B: Configure Proper Keys (internal servers)
# Get correct key from NTP server administrator
sudo vi /etc/chrony.keys
1 SHA256 HEX:CORRECT_KEY_HERE

sudo chmod 640 /etc/chrony.keys
sudo chown root:chrony /etc/chrony.keys

sudo systemctl restart chronyd

### Problem 7: High CPU Usage

Symptoms: chronyd using excessive CPU

Diagnosis:

# Check CPU usage
top -p $(pgrep chronyd)

# Check polling frequency
chronyc sourcestats
# Span column shows how often polling

# Check number of sources
chronyc sources | wc -l

Solutions:

# Solution A: Too Many Sources
sudo vi /etc/chronyd.conf
# Limit maxsources
pool pool.ntp.org iburst maxsources 4
# NOT 10+ sources

# Solution B: Polling Too Frequently
sudo vi /etc/chronyd.conf
# Increase poll intervals
server time.google.com iburst minpoll 6 maxpoll 10
# minpoll 6 = 64 seconds
# maxpoll 10 = 1024 seconds

sudo systemctl restart chronyd

### Problem 8: Time Sync on Air-Gapped Systems

Symptoms: No internet access, can't reach public NTP

Solutions:

# Solution A: Internal NTP Server
# Set up one system with GPS or atomic clock
# Configure as internal NTP server (see earlier example)

# Solution B: Manual Time Setting (not recommended)
sudo timedatectl set-ntp false
sudo timedatectl set-time '2025-11-24 10:30:00'

# Solution C: Sync from Nearby Network Device
# If you have a network device with NTP
sudo vi /etc/chronyd.conf
server router.local iburst
server switch.local iburst

---

## 9. Best Practices

### Best Practice 1: Use Multiple Time Sources

Why: Redundancy and accuracy through voting

Bad:
server time.google.com iburst

Good:
pool pool.ntp.org iburst maxsources 4

Best:
pool pool.ntp.org iburst maxsources 2
pool time.google.com iburst maxsources 2
server time.cloudflare.com iburst

Reason: chronyd uses voting algorithm. With multiple sources, if one is wrong, others override it.

### Best Practice 2: Use Pools Instead of Single Servers

Bad:
server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst

Good:
pool pool.ntp.org iburst maxsources 4

Reason: Pool automatically selects best servers, handles server failures gracefully.

### Best Practice 3: Enable chronyd at Boot

Always:
sudo systemctl enable chronyd

Never leave it manual. Time sync must start automatically.

### Best Practice 4: Monitor Time Sync Status

Implement monitoring:

# Nagios/Zabbix check
# /usr/local/bin/check_chrony.sh
#!/bin/bash
if ! systemctl is-active --quiet chronyd; then
  echo "CRITICAL: chronyd not running"
  exit 2
fi

OFFSET=$(chronyc tracking 2>/dev/null | grep "System time" | awk '{print $4}' | tr -d '-')
if [ -z "$OFFSET" ]; then
  echo "UNKNOWN: Cannot get offset"
  exit 3
fi

if (( $(echo "$OFFSET > 1.0" | bc -l) )); then
  echo "CRITICAL: Time offset ${OFFSET}s"
  exit 2
elif (( $(echo "$OFFSET > 0.1" | bc -l) )); then
  echo "WARNING: Time offset ${OFFSET}s"
  exit 1
else
  echo "OK: Time offset ${OFFSET}s"
  exit 0
fi

### Best Practice 5: Use iburst Option

Always:
server time.google.com iburst

Never:
server time.google.com

Reason: iburst sends burst of packets at startup for faster initial synchronization.

### Best Practice 6: Configure Appropriate Stepping

For servers (stable network):
makestep 1.0 3
# Step if off by 1+ seconds in first 3 updates only

For laptops/VMs:
makestep 1.0 -1
# Always allow stepping (handle sleep/suspend)

### Best Practice 7: Enable RTC Sync

Always include:
rtcsync

Reason: Keeps hardware clock in sync, helps maintain accuracy across reboots.

### Best Practice 8: Use Internal NTP for Large Deployments

If you have 50+ servers:
- Set up 2+ internal NTP servers
- Point all clients to internal servers
- Reduces internet bandwidth
- Faster sync times
- Better control

### Best Practice 9: Document Your Time Infrastructure

Maintain documentation:
- Which servers are NTP servers
- Which stratum they operate at
- Time source hierarchy
- Firewall rules for NTP
- Emergency procedures

### Best Practice 10: Regular Audits

Monthly:
- Check all servers synchronized
- Verify offset within acceptable range
- Review chronyd logs for issues
- Test NTP server failover

# Audit script
#!/bin/bash
# /usr/local/bin/ntp-audit.sh
echo "NTP Synchronization Audit - $(date)"
echo "======================================="

ansible all -m shell -a "chronyc tracking" | grep -A 5 "SUCCESS\|FAILED"

echo ""
echo "Servers not synchronized:"
ansible all -m shell -a "chronyc tracking | grep -q 'Reference ID.*7F7F0101' && echo 'NOT SYNCED' || echo 'SYNCED'" | grep "NOT SYNCED" -B 1

---

## 10. Quick Reference

### chronyd Quick Commands

# Install
sudo yum install chrony

# Start/Stop/Restart
sudo systemctl start chronyd
sudo systemctl stop chronyd
sudo systemctl restart chronyd
sudo systemctl enable chronyd

# Check status
chronyc tracking           # Current sync status
chronyc sources            # List time sources
chronyc sourcestats        # Detailed source statistics
chronyc activity           # Number of sources online/offline

# Force sync
sudo chronyc -a makestep

# Configuration file
sudo vi /etc/chronyd.conf

# Check logs
sudo journalctl -u chronyd -f
sudo tail -f /var/log/chrony/tracking.log

### NTP (ntpd) Quick Commands

# Install
sudo yum install ntp

# Start/Stop/Restart
sudo systemctl start ntpd
sudo systemctl stop ntpd
sudo systemctl restart ntpd
sudo systemctl enable ntpd

# Check status
ntpq -p                    # Peer list
ntpstat                    # Sync status
ntpq -c associations       # Detailed associations

# Force sync (one-time)
sudo ntpdate -u pool.ntp.org

# Configuration file
sudo vi /etc/ntp.conf

# Check logs
sudo tail -f /var/log/ntp.log

### Time-Related Commands

# View current time
date

# Set time manually (disable NTP first)
sudo timedatectl set-ntp false
sudo timedatectl set-time '2025-11-24 10:30:00'

# Enable NTP
sudo timedatectl set-ntp true

# View time settings
timedatectl

# Hardware clock
hwclock --show              # View hardware clock
sudo hwclock --systohc      # Set hardware clock from system time
sudo hwclock --hctosys      # Set system time from hardware clock

### Common Configuration Snippets

# Basic client
pool pool.ntp.org iburst maxsources 4
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

# NTP server
pool pool.ntp.org iburst maxsources 4
allow 192.168.1.0/24
local stratum 10
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync

# High accuracy
server time.nist.gov iburst minpoll 4 maxpoll 6
server time.google.com iburst minpoll 4 maxpoll 6
pool pool.ntp.org iburst maxsources 2
driftfile /var/lib/chrony/drift
makestep 0.1 1
rtcsync
log tracking measurements statistics

---

## 11. Summary

### Key Takeaways

1. **Time synchronization is critical** for:
   - Log correlation
   - Security (authentication, certificates)
   - Database integrity
   - Distributed systems
   - Compliance

2. **chronyd is preferred** over ntpd for:
   - Modern systems (RHEL 7+)
   - Virtual machines
   - Laptops
   - Faster synchronization

3. **Use multiple time sources** for:
   - Redundancy
   - Accuracy
   - Fault tolerance

4. **Monitor time synchronization**:
   - Set up alerts for drift
   - Regular audits
   - Document issues

5. **Follow best practices**:
   - Use pools
   - Enable at boot
   - Configure appropriate stepping
   - Use internal NTP for large deployments

### When to Use What

| Scenario | Recommended Solution |
|----------|---------------------|
| Modern Linux server | chronyd with public pools |
| Legacy RHEL 6 | ntpd with public servers |
| Virtual machines | chronyd (handles VM time jumps) |
| Laptops | chronyd (handles suspend/resume) |
| 50+ servers | Internal NTP servers |
| High accuracy needs | Stratum 1/2 sources, GPS clock |
| Air-gapped network | Internal NTP with GPS |
| Cloud (AWS/Azure/GCP) | Cloud provider time service |
| Financial/Healthcare | Authenticated NTP, monitoring |

### Common Issues & Quick Fixes

| Problem | Quick Fix |
|---------|-----------|
| Not syncing | Check firewall, allow NTP (UDP 123) |
| High offset | Force step: chronyc -a makestep |
| No sources | Check DNS, network connectivity |
| Service won't start | Check config syntax, view logs |
| Time jumping | Disable VM host time sync |
| Conflict with ntpd | Disable ntpd, use chronyd |
| Authentication failure | Remove key from public server config |
| High CPU usage | Reduce polling frequency, limit sources |

---

## Author Information
Guide based on content by: Imran Afzal
Website: www.utclisolutions.com

For more Linux tutorials and DevOps guides, visit the website!

---

## Additional Resources

### Official Documentation
- Chrony Project: https://chrony.tuxfamily.org/
- NTP Project: https://www.ntp.org/
- RHEL Time Sync: https://access.redhat.com/documentation/

### Public NTP Pools
- NTP Pool Project: https://www.pool.ntp.org/
- Google Public NTP: time.google.com
- Cloudflare Time: time.cloudflare.com
- NIST Time Servers: https://tf.nist.gov/tf-cgi/servers.cgi

### Testing Tools
- NTP Pool Monitor: https://www.pool.ntp.org/scores/
- Time.is: https://time.is/ (check your system time)

---

END OF GUIDE
